/*
 * Copyright (c) 2007-2014 Kaazing Corporation. All rights reserved.
 * 
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

YUI.add("map-model",function(a){"use strict";var b=a.Lang,c="mapModel";a.MapModel=a.Base.create(c,a.Model,[],{MAPMODEL_ADD_EVENT:c+":add",MAPMODEL_REMOVE_EVENT:c+":remove",MAPMODEL_UPDATE_KEY_EVENT:c+":updatekey",initializer:function(){var a=this;a.publish(a.MAPMODEL_ADD_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),a.publish(a.MAPMODEL_REMOVE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),a.publish(a.MAPMODEL_UPDATE_KEY_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),a.items={}},putItem:function(a,b){return this.removeItem(a),this.items[a]=b,b&&b.addTarget(this),this.fire(this.MAPMODEL_ADD_EVENT,{item:b}),b},removeItem:function(a){var b=this.items;if(b.hasOwnProperty(a)){var c=b[a];c&&c.removeTarget(this),delete b[a],this.fire(this.MAPMODEL_REMOVE_EVENT,{item:c})}},getItem:function(a){return this.items[a]},hasKey:function(a){return this.items.hasOwnProperty(a)},updateKey:function(a,b){var c=this.items;if(this.hasKey(b)&&this.removeItem(b),this.hasKey(a)){var d=c[a];delete c[a],c[b]=d,this.fire(this.MAPMODEL_UPDATE_KEY_EVENT,{oldKey:a,newKey:b})}},size:function(){var a=this.items,b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},keys:function(){var a=this.items,b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},values:function(){var a=this.items,b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}},{ATTRS:{}})},"0.99",{requires:["model"]}),YUI.add("cluster-model",function(a){"use strict";var b=a.Lang,c="clusterModel";a.ClusterModel=a.Base.create(c,a.Model,[],{UPDATE_AVAILABLE_EVENT:c+":updateAvailable",initializer:function(){this.get("gatewayModels").addTarget(this),this.publish(this.UPDATE_AVAILABLE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.on(a.GatewayModel.prototype.UPDATE_AVAILABLE_EVENT,this.onUpdateAvailable,this)},hasAttribute:function(b){return a.ClusterConfigModel.ATTRS.hasOwnProperty(b)},start:function(a){return this.createGatewayModel("",a,!0)},logout:function(){CC.console.log("### starting cluster logout"),this.set("loggingOut",!0);var a=this.getGateways();a&&a.forEach(function(a){a.disconnect(),a.destroyGateway()}),CC.console.log("### finishing cluster logout")},onUpdateAvailable:function(a){var b=a.newVersion,c=this.get("updateVersion");b&&b!==c&&(this.set("updateVersion",b),this.fire(this.UPDATE_AVAILABLE_EVENT,{newVersion:b}))},createGatewayModel:function(b,c,d){var e=new a.GatewayModel({clusterModel:this,loginProcessor:this.get("loginProcessor"),connectionUrl:c,instanceKey:b,canChangeUrl:d});return this.get("gatewayModels").putItem(b,e),e},findGatewayModelByInstanceKey:function(a){for(var b=this.get("gatewayModels").values(),c=0;c<b.length;c++){var d=b[c];if(d.get("instanceKey")===a)return d}return null},setFirstGatewayInstanceKey:function(a){var b=this.get("gatewayModels");b.updateKey("",a)},loginCompleted:function(a){this.set("isCluster",a.isCluster());var b=a.get("gatewayConfig");this.set("versionInfo",b.get("versionInfo")),this.set("loggedIn",!0)},destroyGateway:function(a){var b=a.get("instanceKey");this.get("gatewayModels").removeItem(b),a.destroyGateway()},processClusterStateData:function(a,b,c,d){var e=this,f={};for(var g in a)if(a.hasOwnProperty(g)){var h=null;if(c&&c.hasOwnProperty(g))for(var i=c[g],j=0;j<i.length;j++){var k=i[j];if(k.startsWith("ws://"))h=k;else if(k.startsWith("wss://")){h=k;break}}f[g]=h}var l=this.getGateways();l.forEach(function(a){var b=a.get("instanceKey");f.hasOwnProperty(b)?delete f[b]:a.shutDown(d)});for(var g in f)f.hasOwnProperty(g)&&this.createGatewayModel(g,f[g])},processMembershipChange:function(a){var b=a.instanceKey,c=a.eventType,d=this.findGatewayModelByInstanceKey(b);"join"===c?d||(d=this.createGatewayModel(b,""),CC.console.log("Processing JOIN created gateway model for instance key "+b)):d&&d.processLeave(a.readTime)},processManagementServiceChange:function(a){var b=a.instanceKey,c=this.findGatewayModelByInstanceKey(b);c||(c=this.createGatewayModel(b,"")),"add"==a.eventType?c.processAddManagementService(a.accepts,a.readTime):c.processRemoveManagementService(a.accepts,a.readTime)},getNumGateways:function(){return this.get("gatewayModels").size()},getGateways:function(){var a=this.get("gatewayModels");return a.size()>0?a.values():null},getSortedGateways:function(){var a=this.getGateways();return a&&0!=a.length?(a.sort(function(a,b){var c=compareStrings(a.get("connectionUrl"),b.get("connectionUrl"));return 0!=c?c:compareNumbers(a.get("stopTime"),b.get("stopTime"),!0,0)}),a):null},getAvailableGateways:function(){var a=this.getGateways();if(!a||0==a.length)return null;for(var b=a.length-1;b>=0;b--)a[b].isAvailable()||a.splice(b,1);return a},getUsableGateways:function(){var a=this.getGateways();if(!a||0==a.length)return null;for(var b=a.length-1;b>=0;b--)a[b].isUsable()||a.splice(b,1);return a},getMembersList:function(){var a=this.getGateways(),b=[];if(a)for(var c=0;c<a.length;c++)b[c]=a[c].get("gatewayLabel");return b.sort(function(a,b){return compareStrings(a.toLowerCase(),b.toLowerCase())}),b}},{ATTRS:{startTime:{valueFn:function(){return new Date}},isCluster:{value:!1},versionInfo:{value:null},gatewayModels:{valueFn:function(){var b=new a.MapModel({model:a.GatewayModel});return b.modelName="GatewayModel",b}},loginProcessor:{value:null},loggedIn:{value:!1},loggingOut:{value:!1},defaultCredentials:{value:null},numQuarantined:{getter:function(){return 0}},updateVersion:{getter:function(){var a=this.value;if(!a&&"undefined"!=typeof Storage){var b=localStorage.getItem("updateVersion");b&&(a=b,this.value=a)}return a},setter:function(a,b){a&&""!==a&&(this.value=a,"undefined"!=typeof Storage&&localStorage.setItem("updateVersion",a))},value:""},numRunning:{getter:function(){for(var a=0,b=this.getGateways(),c=0;c<b.length;c++){var d=b[c];d.get("stopTime")||a++}return a}}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("gateway-model",function(a){"use strict";var b=a.Lang,c="gatewayModel",d={UNINITIALIZED:0,DISCONNECTED:10,DISCONNECTING:20,CONNECTING:30,CONNECTED:50,AVAILABLE:100};a.GatewayModel=a.Base.create(c,a.Model,[],{GATEWAY_AVAILABLE_EVENT:c+":gatewayAvailable",GATEWAY_UNAVAILABLE_EVENT:c+":gatewayUnavailable",ADD_SERVICE_EVENT:c+":addService",REMOVE_SERVICE_EVENT:c+":removeService",UPDATE_AVAILABLE_EVENT:c+":updateAvailable",START_CONNECT_TIMER_LIST:[100,1e3,5e3,1e4,3e4,6e4],initializer:function(){var b=this;this.set("createTime",Date.now()),this.publish(this.GATEWAY_AVAILABLE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.GATEWAY_UNAVAILABLE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.ADD_SERVICE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.REMOVE_SERVICE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.UPDATE_AVAILABLE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.get("serviceModels").addTarget(this),this.on(a.MapModel.prototype.MAPMODEL_ADD_EVENT,this.onServiceModelAdd,this),this.on(a.MapModel.prototype.MAPMODEL_REMOVE_EVENT,this.onServiceModelRemove,this);var c=this.get("connectionUrl");c?this.startFirstConnect(c):invokeLater(function(){b.setGatewayState(d.AVAILABLE)},0)},hasAttribute:function(b){return a.GatewayModel.ATTRS.hasOwnProperty(b)},destroyGateway:function(){this.set("clusterModel",null),this.set("destroyed",!0),this.destroy()},startFirstConnect:function(a){var b=this;this.setGatewayState(d.DISCONNECTED),this.set("connectionUrl",a),invokeLater(function(){b.doConnect()},10)},doConnect:function(){var a=this,b=this.get("clusterModel");this.setGatewayState(d.CONNECTING);var c=this.get("credentials");c||(c=b.get("defaultCredentials")),c?(this.set("credentials",c),this.doConnect2(function(b){a.onClose(b)})):this.get("loginProcessor").requestLoginLock(a,function(b,c,d){a.set("connectionUrl",b),a.set("credentials",a.encodeCredentials(c,d)),a.doConnect2(function(e){a.handleBadCredentials(b,c,d)})},a.get("canChangeUrl"))},doConnect2:function(a){var b=this,c=this.get("mngtApi");c&&(c.disconnect(),c.setChallengeHandler(null),c.setOpenListener(null),c.setExceptionListener(null),c.setCloseListener(null));var d=new MngtAPI_SNMP;d._snmp._gatewayModel=this,c=new MngtAPI(d),this.set("mngtApi",c),c.setOpenListener(function(a){b.clearLoginLock();var c=b.get("clusterModel");c.get("defaultCredentials")||c.set("defaultCredentials",b.get("credentials"));var d=b.get("mngtApi");d.getChallengeHandler().resetTries(),d.setExceptionListener(function(a){b.onError(a)}),d.setCloseListener(function(a){b.onClose(a)}),b.onOpen(a)}),c.setExceptionListener(function(a){alert("Exception during connection processing for "+b.getDebugIdStr())}),c.setCloseListener(function(c){CC.console.debug("mngtApi.closeListener callback for gateway ["+b.get("connectionUrl")+", key = "+b.get("instanceKey")+"]"),a(c)});var e=this.makeChallengeHandler(this,this.get("credentials"));c.setChallengeHandler(e),c.connect(this.get("connectionUrl"))},handleBadCredentials:function(a,b,c){var d=this.get("loginProcessor");d.processLogin(!0,b,c)},encodeCredentials:function(a,b){var c=a+":"+b;return btoa(unescape(encodeURIComponent(c)))},makeChallengeHandler:function(a,b){return{gatewayModel:a,credentials:b,tryNumber:0,canHandle:function(a){return null!=a&&"Basic"===a.authenticationScheme&&a.location.endsWith("/snmp")},resetTries:function(){this.tryNumber=0},handle:function(b,c){var d=this;if(CC.console.debug("challengeHandler.handle for gateway ["+this.gatewayModel.get("connectionUrl")+"], instanceKey ["+this.gatewayModel.get("instanceKey")+"]"),a.isAuthenticated()){CC.console.debug("revalidating");var e=0}else{if(this.tryNumber>0)return void c(null);this.tryNumber++}var f=null;null!==b.location&&(f=new Kaazing.Gateway.ChallengeResponse("Basic "+this.credentials,null)),c(f)},updateCredentials:function(a){this.credentials=a}}},clearStartConnectTimer:function(){var a=this.get("startConnectTimerId");a&&(window.clearTimeout(a),this.set("startConnectTimerId",null))},resetStartConnectIndex:function(){this.set("startConnectIndex",0)},getStartConnectWaitTime:function(){var a=this.get("startConnectIndex");return a>0&&a--,this.START_CONNECT_TIMER_LIST[a]},disconnect:function(){this.isOpen()&&this.get("mngtApi").disconnect()},clearLoginLock:function(){this.get("loginProcessor").clearLoginLock(this)},onError:function(a){CC.console.error("onError for "+this.getDebugIdStr()),this.onClose(null)},onClose:function(a){var b=this;CC.console.debug("standard onClose for gateway ["+this.get("connectionUrl")+", key = "+this.get("instanceKey")+"]"),this.set("authenticated",!1);var c=this.get("clusterModel");if(this.get("stopTime"))return void CC.console.debug("dead instance "+this.get("instanceKey"));if(!c||c.get("loggingOut"))return void CC.console.debug("logging out "+this.get("instanceKey"));this.setGatewayState(d.DISCONNECTED);var e=this.get("startConnectIndex");e<this.START_CONNECT_TIMER_LIST.length-1&&this.set("startConnectIndex",e+1),CC.console.log("Setting doConnect for "+this.START_CONNECT_TIMER_LIST[e]+"ms from now for instance "+this.get("instanceKey")),this.set("startConnectTimerId",invokeLater(function(){b.doConnect()},this.START_CONNECT_TIMER_LIST[e]))},onOpen:function(a){var b=this;this.set("authenticated",!0),this.clearStartConnectTimer(),this.resetStartConnectIndex(),CC.console.debug("### Successfully logged into management service for "+this.getDebugIdStr()),this.setGatewayState(d.CONNECTED),CC.console.log("## onOpen, after setting gatewayState to CONNECTED"),this.get("mngtApi").getClusterState(function(a){invokeLater(function(){b.onOpen1(a)},0)})},onOpen1:function(a){var b=this,c=this.get("clusterModel"),d=a.instanceKey,e=this.get("instanceKey"),f=this.get("mngtApi");if(""!==e&&e!==d)return void(this.get("stopTime")?(CC.console.warn("Somehow in onOpen1 for gateway instance "+this.get("instanceKey")+" ("+this.getDebugIdStr()+") that has already been stopped. Disconnecting this gateway instance."),this.disconnect()):(this.shutDown(a.readTime),c.findGatewayModelByInstanceKey(d)?CC.console.error("Somehow in onOpen1 for gateway instance "+e+" ("+this.get("connectionUrl")+") that is not marked as stopped, but a new instance key already exists for this connection URL. Disconnecting this gateway instance and marking it as stopped."):c.createGatewayModel(d,this.get("connectionUrl"))));""===e&&(this.set("instanceKey",d),c.setFirstGatewayInstanceKey(d));var g=a.hostAndPID;if(void 0!==g&&null!==g){var h=g.split("@");g=h[1]+" : "+h[0]}else g="";this.set("hostAndPID",g),this.set("startTime",a.startTime),this.set("upTime",a.upTime),(!a.mngtServiceMap||isEmptyObject(a.mngtServiceMap))&&(a.mngtServiceMap={},a.mngtServiceMap[this.get("instanceKey")]=[this.get("connectionUrl")]),invokeLater(function(){c.processClusterStateData(a.clusterMembers,a.balancerMap,a.mngtServiceMap,a.readTime)},0),f.startNotifications(function(a){b.notificationCallback(a)}),invokeLater(function(){b.onOpen2()},0)},onOpen2:function(){var b=this;if(this.get("summaryDataDefinitions"))invokeLater(function(){b.onOpen3()},0);else{var c=this.get("mngtApi");c.getSummaryDataDefinitions(function(c){b.set("summaryDataDefinitions",c);var d=new a.GatewayDynamicDataModel({gatewayModel:b});b.set("dynamicDataModel",d),d.addTarget(b);var e=new a.SystemModel({gatewayModel:b});b.set("systemModel",e),e.addTarget(b);var f=new a.CpuListModel({gatewayModel:b});b.set("cpuListModel",f),f.addTarget(b);var g=new a.NicListModel({gatewayModel:b});b.set("nicListModel",g),g.addTarget(b);var h=new a.JvmModel({gatewayModel:b});b.set("jvmModel",h),h.addTarget(b),invokeLater(function(){b.onOpen3()},0)})}},onOpen3:function(){var b=this;this.get("gatewayConfig")?invokeLater(function(){b.onOpen4()},0):this.get("mngtApi").getGatewayConfiguration(function(c){c.gatewayModel=b;var d=new a.GatewayConfigModel(c);b.set("gatewayConfig",d);for(var e=b.get("serviceModels"),f=b.get("startTime"),g=d.get("serviceConfigs"),h=0;h<g.length;h++){var i=g[h];if(!i.isManagement()){var j=i.get("serviceId"),k=new a.ServiceModel({gatewayModel:b,serviceId:j,startTime:f});e.putItem(j,k)}}invokeLater(function(){b.onOpen4()},0)})},onOpen4:function(){var a=this;this.get("mngtApi").getGateway(function(b){a.get("dynamicDataModel").load(b),invokeLater(function(){a.onOpen5()},0)})},onOpen5:function(){var a=this;this.get("mngtApi").getSystemStats(function(b){a.get("systemModel").load(b),invokeLater(function(){a.onOpen6()},0)})},onOpen6:function(){var a=this;this.get("mngtApi").getCpuListStats(function(b){a.get("cpuListModel").load(b),invokeLater(function(){a.onOpen7()},0)})},onOpen7:function(){var a=this;this.get("mngtApi").getNicListStats(function(b){a.get("nicListModel").load(b),invokeLater(function(){a.onOpen8()},0)})},onOpen8:function(){var a=this;this.get("mngtApi").getJVMStats(function(b){a.get("jvmModel").load(b),invokeLater(function(){a.onOpen9()},0)})},onOpen9:function(){var a=this;a.get("mngtApi").getServices(function(b){var c=a.get("serviceModels");b.forEach(function(a){c.getItem(a.serviceId).load(a)}),invokeLater(function(){a.onOpen10()},0)})},onOpen10:function(){var a=this,b=function(c){if(c&&c.length>0){var d=c.shift();a.get("mngtApi").setServiceNotifications(d.get("serviceId"),1,function(){b(c)})}else invokeLater(function(){a.onOpen11()},0)};b(a.getServices())},onOpen11:function(){var a=this;this.get("mngtApi").getGatewaySessions(function(b){var c,d,e,f,g;CC.console.debug("GetGatewaySessions for "+a.getDebugIdStr()+"\n   returned "+b.length+" current sessions"),e=b&&b.length>0?b[0].readTime:Date.now(),g={};for(var h=0;h<b.length;h++)d=b[h],c=g[""+d.serviceId],c||(c={},g[""+d.serviceId]=c),c[""+d.sessionId]=d;f=a.getServices(),f.forEach(function(a){c=g[""+a.get("serviceId")],a.updateSessionData(c,e)}),invokeLater(function(){a.onOpen12()},0)})},onOpen12:function(){this.processQueuedNotifications(),this.set("loginCompleted",!0),this.setGatewayState(d.AVAILABLE),this.get("clusterModel").loginCompleted(this),this.get("dynamicDataModel").addTarget(this),this.on(a.GatewayDynamicDataModel.prototype.UPDATE_EVENT,this.onUpdateDataModel,this)},shutDown:function(a){if(!this.get("stopTime")){CC.console.log("### Marking gateway instance at ["+this.get("connectionUrl")+" with instanceKey ["+this.get("instanceKey")+"] as shut down, at stop time "+a),this.set("stopTime",a),this.disconnect();var b=this.get("dynamicDataModel");b&&b.shutDown(a),this.clearLoginLock(),this.clearStartConnectTimer(),this.resetStartConnectIndex()}},notificationCallback:function(a){if(!this.get("stopTime")){var b=a.type;b===CC.Constants.NotificationType.MEMBERSHIP_CHANGE?this.get("clusterModel").processMembershipChange(a):b===CC.Constants.NotificationType.MANAGEMENT_SERVICE_CHANGE?this.get("clusterModel").processManagementServiceChange(a):b===CC.Constants.NotificationType.CONNECTION_LIMIT_CHANGE?this.get("clusterModel").processConnectionLimitChange(a):b===CC.Constants.NotificationType.BALANCER_MAP_CHANGE?this.processBalancerMapChange(a):(a.gatewayModel=this,this.isAvailable()?this.processNotification(a):this.pushNotification(a))}},pushNotification:function(a){this.get("notificationQueue").push(a)},processLeave:function(a){CC.console.log("### processLeave for gateway "+this.getDebugIdStr()),this.shutDown(a)},processAddManagementService:function(a,b){var c=this.get("connectionUrl"),d=this.get("instanceKey");if(c)return void CC.console.log(this.getDebugIdStr()+" ignoring addManagementService for instanceKey "+d+" because connectionUrl is already set: "+c);if(!a)return void CC.console.error(this.getDebugIdStr()+" adding management service for instanceKey "+d+" but it has no accepts!");c=null;for(var e=0;e<a.length;e++){var f=a[e];if(f.startsWith("wss://")){c=f;break}f.startsWith("ws://")&&(c=f)}return c?(CC.console.info(this.getDebugIdStr()+" Adding management service for instance key "+d+", connectionUrl "+c),this.set("canChangeUrl",!1),void this.startFirstConnect(c)):void CC.console.warn(this.getDebugIdStr()+" Adding management service for instanceKey "+d+" but it has no WS:// or WSS:// accepts!")},processRemoveManagementService:function(a,b){},processBalancerMapChange:function(a){},processNotification:function(a){var b=a.type;switch(b){case CC.Constants.NotificationType.GATEWAY_SUMMARY:this.get("dynamicDataModel").processNotification(a);break;case CC.Constants.NotificationType.SYSTEM_SUMMARY:this.get("systemModel").processNotification(a);break;case CC.Constants.NotificationType.CPU_LIST_SUMMARY:this.get("cpuListModel").processNotification(a);break;case CC.Constants.NotificationType.NIC_LIST_SUMMARY:this.get("nicListModel").processNotification(a);break;case CC.Constants.NotificationType.JVM_SUMMARY:this.get("jvmModel").processNotification(a);break;default:var c=this.getService(a.serviceId);c?c.processNotification(a):CC.console.error("#### Processing a service-or-session notification for:\n   "+this.getDebugIdStr()+",\n   service ID "+a.serviceId+",\n   session ID "+a.sessionId+",\n   ### SERVICE WAS NOT FOUND")}},processQueuedNotifications:function(){var a=this,b=this.get("notificationQueue"),c=b.length;if(CC.console.debug("Processing "+c+" queued notifications for "+a.getDebugIdStr()+":"),c>0){for(;b.length>0;){var d=b.shift();a.processNotification(d)}CC.console.debug("Done processing queued notifications for "+this.getDebugIdStr())}},isConnecting:function(){return this.get("gatewayState")===d.CONNECTING},isOpen:function(){var a=this.get("mngtApi");return null!==a&&a.isOpen()},isDisconnecting:function(){return this.get("gatewayState")===d.DISCONNECTING},isAvailable:function(){return this.get("gatewayState")===d.AVAILABLE},isAuthenticated:function(){return this.get("authenticated")},isUsable:function(){return this.get("loginCompleted")&&!this.get("stopTime")?!0:!1},setGatewayState:function(a){var b=this.get("gatewayState");b!==a&&(CC.console.info("Marking gateway at ["+this.get("connectionUrl")+"], instanceKey ["+this.get("instanceKey")+"] as "+this.gatewayStateString(a)),this.set("gatewayState",a),a===d.AVAILABLE?this.fire(this.GATEWAY_AVAILABLE_EVENT,{gatewayModel:this}):b===d.AVAILABLE&&this.fire(this.GATEWAY_UNAVAILABLE_EVENT,{gatewayModel:this}))},gatewayStateString:function(a){switch(a){case d.UNINITIALIZED:return"UNINITIALIZED";case d.DISCONNECTED:return"DISCONNECTED";case d.DISCONNECTING:return"DISCONNECTING";case d.CONNECTING:return"CONNECTING";case d.CONNECTED:return"CONNECTED";case d.AVAILABLE:return"AVAILABLE";default:return"UNKNOWN"}},isCluster:function(){var a=this.get("gatewayConfig");if(!a)return!1;var b=a.get("clusterConfig");return void 0!==b&&null!==b},isClusterPeer:function(){return this.isCluster()},getUniqueId:function(){return this.get("gatewayLabel")},onServiceModelAdd:function(a){a.halt(!0);var b=a.item;"serviceModel"===b.name?(CC.console.debug("GatewayModel:onServiceModelAdd for service ID "+b.get("serviceId")),this.fire(this.ADD_SERVICE_EVENT,{serviceModel:b})):CC.console.debug("GatewayModel:onServiceModelAdd - ignoring mapModel:add event for item.name = "+b.name)},onServiceModelRemove:function(a){a.halt(!0);var b=a.item;"serviceModel"===b.name?(CC.console.debug("GatewayModel:onServiceModelRemove for service ID "+b.get("serviceId")),this.fire(this.REMOVE_SERVICE_EVENT,{serviceModel:b})):CC.console.debug("GatewayModel:onServiceModelRemove - ignoring mapModel:remove event for item.name = "+b.name)},onUpdateDataModel:function(a){this.fire(this.UPDATE_AVAILABLE_EVENT,{newVersion:a.data[this.summaryAttributeIndex("gateway","latestUpdateableGatewayVersion")]})},getService:function(a){return this.get("serviceModels").getItem(a)},getServices:function(){var a=this.get("serviceModels").values();return a.length>0?a:null},getMembersList:function(){var a=this.getServices(),b=[];if(a)for(var c=0;c<a.length;c++)b[c]=a[c].get("serviceLabel");return b.sort(function(a,b){return compareStrings(a.toLowerCase(),b.toLowerCase())}),b},getLatestAcrossServices:function(a){var b=[],c=this.getServices();return c&&c.forEach(function(c){b.push(c.get(a))}),b},summaryAttributeIndex:function(a,b){var c=this.get("summaryDataDefinitions"),d=c[a];return d?d.fields.indexOf(b):-1},getSummaryDataDefinition:function(a){var b=this.get("summaryDataDefinitions"),c=b[a];return c},getDebugIdStr:function(){return"gateway ("+this.get("gatewayLabel")+")"},getDynamicDataValue:function(a){var b=this.get("dynamicDataModel");return b?b.getValue(a):null},getSystemDataValue:function(a){var b=this.get("systemModel");return b?b.getValue(a):null},isManaged:function(){return this.get("connectionUrl")?!0:!1},dump:function(){CC.console.debug("GatewayModel for GW "+this.getDebugIdStr());var a=2;dumpAttr(this,"gatewayState",a),dumpAttr(this,"connectionUrl",a),dumpAttr(this,"gatewayConfig",a),dumpAttr(this,"hostAndPID",a),dumpAttr(this,"startTime",a),dumpAttr(this,"instanceKey",a),dumpAttr(this,"upTime",a)}},{ATTRS:{clusterModel:{value:null},loginProcessor:{value:null},credentials:{value:null},authenticated:{value:!1},instanceKey:{value:""},createTime:{value:null},canChangeUrl:{value:!1},gatewayState:{value:d.UNINITIALIZED},loginCompleted:{value:!1},connectionUrl:{value:null},mngtApi:{value:null},notificationQueue:{value:[]},startConnectIndex:{value:0},startConnectTimerId:{value:null},gatewayConfig:{value:null},summaryDataDefinitions:{value:null},dynamicDataModel:{value:null},systemModel:{value:null},cpuListModel:{value:null},nicListModel:{value:null},jvmModel:{value:null},serviceModels:{valueFn:function(){var b=new a.MapModel({model:a.ServiceModel});return b.modelName="ServiceModel",b}},hostAndPID:{value:null},upTime:{value:null},startTime:{value:null},stopTime:{value:null},lastSeenVersion:{value:""},gatewayLabel:{getter:function(a,b){var c=this.get("connectionUrl")||this.get("instanceKey"),d=c.indexOf("//");return d>=0&&(c=c.substring(d+2)),d=c.indexOf("/"),d>=0&&(c=c.substring(0,d)),c}},totalCurrentSessions:{getter:function(a,b){var c=this.getLatestAcrossServices("totalCurrentSessions"),d=c.reduce(function(a,b,c,d){return a+(null===b?0:b)},0);return d}},totalBytesReceived:{getter:function(a,b){var c=this.getLatestAcrossServices("totalBytesReceived"),d=c.reduce(function(a,b,c,d){return a+(null===b?0:b)},0);return d}},totalBytesSent:{getter:function(a,b){var c=this.getLatestAcrossServices("totalBytesSent"),d=c.reduce(function(a,b,c,d){return a+(null===b?0:b)},0);return d}},readTime:{getter:function(a,b){var c=this.getDynamicDataValue("readTime");return c?c:this.get("createTime")}},osName:{getter:function(a,b){return this.getSystemDataValue(b)}},uptimeSeconds:{getter:function(a,b){return this.getSystemDataValue(b)}},totalFreeMemory:{getter:function(a,b){return this.getSystemDataValue(b)}},totalUsedMemory:{getter:function(a,b){return this.getSystemDataValue(b)}},totalMemory:{getter:function(a,b){return this.getSystemDataValue(b)}},totalFreeSwap:{getter:function(a,b){return this.getSystemDataValue(b)}},totalUsedSwap:{getter:function(a,b){return this.getSystemDataValue(b)}},totalSwap:{getter:function(a,b){return this.getSystemDataValue(b)}},freeMemoryPercentage:{getter:function(a,b){return this.getSystemDataValue(b)}},usedMemoryPercentage:{getter:function(a,b){return this.getSystemDataValue(b)}},freeSwapPercentage:{getter:function(a,b){return this.getSystemDataValue(b)}},usedSwapPercentage:{getter:function(a,b){return this.getSystemDataValue(b)}},cpuPercentage:{getter:function(a,b){return this.getSystemDataValue(b)}}}})},"0.99",{requires:["model","cluster-model","service-model","session-model","gateway-dynamic-data-model","gateway-cluster-data-model","jvm-model","system-model","cpu-list-model","nic-list-model"]}),YUI.add("service-model",function(a){"use strict";var b=a.Lang,c="serviceModel";a.ServiceModel=a.Base.create(c,a.Model,[],{ADD_SESSION_EVENT:c+":addSession",REMOVE_SESSION_EVENT:c+":removeSession",initializer:function(){var b=this;this.publish(this.ADD_SESSION_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.REMOVE_SESSION_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}});var c=new a.ServiceDynamicDataModel({serviceModel:this});this.set("dynamicDataModel",c),c.addTarget(this);var d=this.get("sessionModels");d.addTarget(this),this.on(a.MapModel.prototype.MAPMODEL_ADD_EVENT,this.onSessionAdd,this),this.on(a.MapModel.prototype.MAPMODEL_REMOVE_EVENT,this.onSessionRemove,this);var e=this.get("gatewayModel");e.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this)},hasAttribute:function(b){return a.ServiceModel.ATTRS.hasOwnProperty(b)},load:function(a){this.get("dynamicDataModel").load(a)},processNotification:function(a){var b=a.type;switch(b){case CC.Constants.NotificationType.SERVICE_SUMMARY:this.get("dynamicDataModel").processNotification(a);break;case CC.Constants.NotificationType.SESSION_OPEN:this.processSessionOpen(a);break;case CC.Constants.NotificationType.SESSION_CLOSE:this.processSessionClose(a);break;case CC.Constants.NotificationType.CURRENT_SESSION_COUNT:break;case CC.Constants.NotificationType.TOTAL_SESSION_COUNT:break;default:this.processSessionNotification(a)}},processSessionOpen:function(b){for(var c=b.sessionId,d=new a.SessionModel({serviceModel:this,serviceId:this.get("serviceId"),sessionId:c,sessionOpen:1,enableNotifications:0,startTime:b.startTime,localAddress:b.localAddress,remoteAddress:b.remoteAddress,principals:b.principals,sessionTypeName:b.sessionTypeName,sessionDirection:b.sessionDirection,extensions:b.extensions,protocolVersion:b.protocolVersion}),e=this.get("gatewayModel").getSummaryDataDefinition("session"),f=e.fields.length-1,g=[],h=0;f>h;h++)g[h]=0;d.load({summaryData:g});var i=this.get("sessionModels");i.putItem(c,d)},processSessionClose:function(a){var b=a.sessionId,c=a.readTime,d=this.getSession(b);d&&d.close(c)},processSessionNotification:function(a){var b=this.getSession(a.sessionId);if(b)b.processNotification(a);else var c=this.getServiceConfig()},onSessionAdd:function(a){a.halt(!0);var b=a.item;"sessionModel"===b.name&&this.fire(this.ADD_SESSION_EVENT,{sessionModel:b})},onSessionRemove:function(a){a.halt(!0);var b=a.item;"sessionModel"===b.name?(CC.console.debug("ServiceModel:onSessionRemove for session ID "+b.get("sessionId")),CC.console.debug("### ServiceModel: firing "+this.REMOVE_SESSION_EVENT),this.fire(this.REMOVE_SESSION_EVENT,{sessionModel:b})):CC.console.debug("ServiceModel:onSessionRemove - ignoring mapModel:remove event for item.name = "+b.name)},afterStopTimeChange:function(a){this.get("stopTime")||this.set("stopTime",a.newVal)},updateSessionData:function(a,b){var c=this.getSessions();if(c&&c.forEach(function(c){var d=""+c.get("sessionId"),e=a&&a[d];e?(c.load(e),delete a[d]):c.close(b)}),a)for(var d in a)a.hasOwnProperty(d)&&this.storeGatewaySession(a[d])},storeGatewaySession:function(b){var c=this,d=b.sessionId,e=c.get("sessionModels"),f=e.getItem(d);f?f.load(b):(f=new a.SessionModel({serviceModel:this,serviceId:b.serviceId,sessionId:d,sessionOpen:b.sessionOpen,enableNotifications:b.enableNotifications,startTime:b.startTime,localAddress:b.localAddress,remoteAddress:b.remoteAddress,principals:b.principals?parseJSON(b.principals):null,sessionTypeName:b.sessionTypeName,sessionDirection:b.sessionDirection}),f.load(b),e.putItem(d,f))},getSession:function(a){return this.get("sessionModels").getItem(a)},getSessions:function(){var a=this.get("sessionModels").values();return a.length>0?a:null},dumpSessionModels:function(){CC.console.debug(this.getDebugIdStr());var a=this.get("sessionModels").values();if(a.length>0)for(var b=0;b<a.length;b++){var c=a[b];CC.console.debug("   Session id: "+c.get("sessionId")+", "+(0===c.get("sessionOpen")?"CLOSED":"OPEN"))}else CC.console.debug("   Has no sessions")},getDebugIdStr:function(){var a=this.get("serviceId"),b=this.get("gatewayModel"),c=b.get("gatewayConfig"),d=c.getServiceConfig(a);return b.getDebugIdStr()+",\n   service (ID: "+a+", name: '"+d.get("name")+"', type: '"+d.get("type")+"')"},getServiceConfig:function(){return this.get("gatewayModel").get("gatewayConfig").getServiceConfig(this.get("serviceId"))},isBalanced:function(){var a=this.getServiceConfig();return null!==a&&a.isBalanced()},getDynamicDataValue:function(a){return this.get("dynamicDataModel").getValue(a)},dump:function(){CC.console.debug("ServiceModel for gateway "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"serviceId",a),dumpValue("serviceConfig",this.get("gatewayModel").get("gatewayConfig").getServiceConfig(this.get("serviceId"))),dumpSessionModels()}},{ATTRS:{gatewayModel:{value:null},dynamicDataModel:{value:null},serviceId:{value:null},sessionModels:{valueFn:function(){var b=new a.MapModel({model:a.SessionModel});return b.modelName="SessionModel",b}},gatewayLabel:{getter:function(a,b){return this.get("gatewayModel").get("gatewayLabel")}},startTime:{value:null},stopTime:{value:null},serviceLabel:{getter:function(){var a=this.getServiceConfig(),b=a.get("name");if(b&&""!=b.trim())return b.trim();var c=a.get("type"),d=this.get("serviceId");return"Id "+d+" ("+c+")"}},state:{getter:function(a,b){return this.getDynamicDataValue("state")}},serviceConnected:{getter:function(a,b){return this.getDynamicDataValue("serviceConnected")}},totalBytesReceived:{getter:function(a,b){return this.getDynamicDataValue("totalBytesReceived")}},totalBytesReceivedThroughput:{getter:function(a,b){return this.getDynamicDataValue("totalBytesReceivedThroughput")}},totalBytesSent:{getter:function(a,b){return this.getDynamicDataValue("totalBytesSent")}},totalBytesSentThroughput:{getter:function(a,b){return this.getDynamicDataValue("totalBytesSentThroughput")
}},totalCurrentSessions:{getter:function(a,b){var c=this.getDynamicDataValue("totalCurrentSessions");return c}},totalCurrentNativeSessions:{getter:function(a,b){return this.getDynamicDataValue("totalCurrentNativeSessions")}},totalCurrentEmulatedSessions:{getter:function(a,b){return this.getDynamicDataValue("totalCurrentEmulatedSessions")}},totalCumulativeSessions:{getter:function(a,b){return this.getDynamicDataValue("totalCumulativeSessions")}},totalCumulativeNativeSessions:{getter:function(a,b){return this.getDynamicDataValue("totalCumulativeNativeSessions")}},totalCumulativeEmulatedSessions:{getter:function(a,b){return this.getDynamicDataValue("totalCumulativeEmulatedSessions")}},totalExceptionCount:{getter:function(a,b){return this.getDynamicDataValue("totalExceptionCount")}},latestException:{getter:function(a,b){return this.getDynamicDataValue("latestException")}},latestExceptionTime:{getter:function(a,b){return this.getDynamicDataValue("latestExceptionTime")}},lastSuccessfulConnectTime:{getter:function(a,b){return this.getDynamicDataValue("lastSuccessfulConnectTime")}},lastFailedConnectTime:{getter:function(a,b){return this.getDynamicDataValue("lastFailedConnectTime")}},lastHeartbeatPingResult:{getter:function(a,b){return this.getDynamicDataValue("lastHeartbeatPingResult")}},lastHeartbeatPingTimestamp:{getter:function(a,b){return this.getDynamicDataValue("lastHeartbeatPingTimestamp")}},heartbeatPingCount:{getter:function(a,b){return this.getDynamicDataValue("heartbeatPingCount")}},heartbeatPingSuccesses:{getter:function(a,b){return this.getDynamicDataValue("heartbeatPingSuccesses")}},heartbeatPingFailures:{getter:function(a,b){return this.getDynamicDataValue("heartbeatPingFailures")}},heartbeatRunning:{getter:function(a,b){return this.getDynamicDataValue("heartbeatRunning")}},enableNotifications:{getter:function(a,b){return this.getDynamicDataValue("enableNotifications")}},loggedInSessions:{getter:function(a,b){return this.getDynamicDataValue("loggedInSessions")}},readTime:{getter:function(a,b){return this.getDynamicDataValue("readTime")}}}})},"0.99",{requires:["model","gateway-model","session-model","service-dynamic-data-model"]}),YUI.add("session-model",function(a){"use strict";var b=a.Lang,c="sessionModel";a.SessionModel=a.Base.create(c,a.Model,[],{CLOSE_SESSION_EVENT:c+":closeSession",initializer:function(){this.publish(this.CLOSE_SESSION_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.formatRemoteAddress();var b=new a.SessionDynamicDataModel({sessionModel:this});this.set("dynamicDataModel",b),b.addTarget(this);var c=this.get("serviceModel");c.after("serviceModel:stopTimeChange",this.afterStopTimeChange,this)},formatRemoteAddress:function(){var a=this.get("remoteAddress");if(a&&a.length>0){a.startsWith("[")&&(a=a.substring(1,a.length-1));var b=a.indexOf("?");b>0&&(a=a.substring(0,b))}else a="";this.set("remoteAddress",a)},afterStopTimeChange:function(a){this.get("stopTime")||this.set("stopTime",a.newVal)},formatStartTime:function(){},hasAttribute:function(b){return a.SessionModel.ATTRS.hasOwnProperty(b)},load:function(a){this.get("dynamicDataModel").load(a)},close:function(a){this.set("sessionOpen",0),this.set("stopTime",a),this.fire(this.CLOSE_SESSION_EVENT,{sessionModel:this})},startClose:function(){var a=this.get("serviceModel");if(a){var b=a.get("gatewayModel");if(b){var c=b.get("mngtApi");c.closeSession(a.get("serviceId"),this.get("sessionId"))}}},processNotification:function(a){var b=a.type;switch(b){case CC.Constants.NotificationType.SESSION_SUMMARY:this.get("dynamicDataModel").processNotification(a)}},getUptime:function(){var a=this.get("startTime"),b=this.get("stopTime");return b||(b=this.get("readTime")),b||(b=(new Date).getTime()),b-a},getGatewayModel:function(){var a=this.get("serviceModel");return a?a.get("gatewayModel"):null},getDebugIdStr:function(){return this.get("serviceModel").getDebugIdStr()+",\n   session (ID: "+this.get("sessionId")+")"},getDynamicDataValue:function(a){return this.get("dynamicDataModel").getValue(a)}},{ATTRS:{serviceModel:{value:null},dynamicDataModel:{value:null},serviceId:{value:null},sessionId:{value:null},sessionOpen:{value:null},enableNotifications:{value:null},startTime:{value:null},stopTime:{value:null},localAddress:{value:null},remoteAddress:{value:null},principals:{value:null},sessionTypeName:{value:null},sessionDirection:{value:null},extensions:{value:null},protocolVersion:{value:null},mark:{value:!1},action:{getter:function(a,b){var c=this.get("serviceModel"),d=c.get("gatewayModel");return'<button type="button" class="goButton"instanceKey="'+d.get("instanceKey")+'" serviceId="'+c.get("serviceId")+'" sessionId="'+this.get("sessionId")+'" ></button>'}},gatewayLabel:{getter:function(a,b){var c=this.get("serviceModel");return c.get("gatewayLabel")}},serviceLabel:{getter:function(a,b){var c=this.get("serviceModel");return c.get("serviceLabel")}},uptime:{getter:function(a,b){return this.getUptime()}},readBytes:{getter:function(a,b){return this.getDynamicDataValue(b)}},readBytesThroughput:{getter:function(a,b){return this.getDynamicDataValue(b)}},writtenBytes:{getter:function(a,b){return this.getDynamicDataValue(b)}},writtenBytesThroughput:{getter:function(a,b){return this.getDynamicDataValue(b)}},readTime:{getter:function(a,b){return this.getDynamicDataValue(b)}},state:{getter:function(a,b){var c=this.get("sessionOpen");return 1===c?"Open":"Closed"}}}})},"0.99",{requires:["model","gateway-model","service-model","session-dynamic-data-model"]}),YUI.add("cluster-config-model",function(a){"use strict";var b=a.Lang,c="clusterConfigModel";a.ClusterConfigModel=a.Base.create(c,a.Model,[],{hasAttribute:function(b){return a.ClusterConfigModel.ATTRS.hasOwnProperty(b)},initializer:function(){},dump:function(){CC.console.debug("ClusterConfig for GW "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"name",a),dumpAttr(this,"accepts",a),dumpAttr(this,"connects",a),dumpAttr(this,"connectOptions",a)}},{ATTRS:{gatewayModel:{value:null},name:{value:null},accepts:{value:null},connects:{value:null},connectOptions:{value:null}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("cpu-list-model",function(a){"use strict";var b=a.Lang,c="cpuListModel";a.CpuListModel=a.Base.create(c,a.Model,[],{dataDefinition:null,UPDATE_EVENT:c+":update",initializer:function(){var a=this.get("gatewayModel").getSummaryDataDefinition("cpuList");this.dataDefinition=a,this.publish(this.UPDATE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}})},hasAttribute:function(a){return"numCpus"==a?!0:this._getAttributeIndex(a)>=0},getValue:function(a,b,c){if("numCpus"==b){var d=this.get("numCpus");return c?[CC.Constants.CONSTANT_TIME,d]:d}var e=this._getAttributeIndex(b);if(0>e)return void 0;var f=this.get("data");if(!f)return null;var g=f[a][e];return"function"==typeOf(g)&&(g=g()),c?[this.getReadTime(),g]:g},getReadTime:function(){var a=this.get("data");return a&&0!=a.length?a[a.length-1]:0},load:function(a){a&&(this.set("numCpus",a.numCpus),this.loadSummaryData(a.summaryData))},loadSummaryData:function(a){if(a&&a.length>0)for(var b=this.getReadTime(),c=this.get("numCpus"),d=0;d<a.length;d++){for(var e=a[d],f=e.cpuData,g=e.readTime,h=0;h<f.length;h++)f[h].push(g);g>b&&(b=g,this.set("data",f)),this.fire(this.UPDATE_EVENT,{model:this,data:f})}},processNotification:function(a){this.loadSummaryData(a.value)},_getAttributeIndex:function(a){var b=this.dataDefinition.fields.indexOf(a);return b}},{ATTRS:{gatewayModel:{value:null},numCpus:{value:null},data:{value:null}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("gateway-config-model",function(a){"use strict";var b=a.Lang,c="gatewayConfigModel";a.GatewayConfigModel=a.Base.create(c,a.Model,[],{hasAttribute:function(b){return a.GatewayConfigModel.ATTRS.hasOwnProperty(b)},initializer:function(){var b=this.get("gatewayModel"),c=this.get("clusterConfig");c&&(c.gatewayModel=b,this.set("clusterConfig",new a.ClusterConfigModel(c)));var d=this.get("licensesConfig");d&&(d.gatewayModel=b,this.set("licensesConfig",new a.LicensesConfigModel(d)));var e=this.get("networkConfig");e&&(e.gatewayModel=b,this.set("networkConfig",new a.NetworkConfigModel(e)));var f=this.get("securityConfig");f&&(f.gatewayModel=b,this.set("securityConfig",new a.SecurityConfigModel(f)),f=this.get("securityConfig"));var g=this.get("serviceDefaultsConfig");g&&(g.gatewayModel=b,this.set("serviceDefaultsConfig",new a.ServiceDefaultsConfigModel(g)));var h=this.get("serviceConfigs");if(h)if(0===h.length)this.set("serviceConfigs",null);else{for(var i=f.get("realmConfigs"),j=0;j<h.length;j++){var k=h[j];k.gatewayModel=b,h[j]=new a.ServiceConfigModel(k);var l=i?i[h[j].get("realm")]:null;h[j].set("realm",l),l&&l.addServiceConfig(h[j])}this.set("serviceConfigs",h)}},getServiceConfig:function(a){var b=this.get("serviceConfigs");if(b)for(var c=0;c<b.length;c++){var d=b[c];if(d.get("serviceId")===a)return d}return null},getRealmConfig:function(a){var b=this.get("securityConfig");return b?b.getRealmConfig(a):null},dump:function(){CC.console.debug("GatewayConfig for GW "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"productTitle",a),dumpAttr(this,"productVersionBuild",a),dumpAttr(this,"productEdition",a),dumpAttr(this,"clusterConfig",a),dumpAttr(this,"licensesConfig",a),dumpAttr(this,"networkConfig",a),dumpAttr(this,"securityConfig",a),dumpAttr(this,"serviceDefaultsConfig",a),dumpAttr(this,"serviceConfigs",a),dumpAttr(this,"readTime",a)}},{ATTRS:{gatewayModel:{value:null},productTitle:{value:null},productVersionBuild:{value:null},productEdition:{value:null},clusterConfig:{value:null},licensesConfig:{value:null},networkConfig:{value:null},securityConfig:{value:null},serviceDefaultsConfig:{value:null},serviceConfigs:{value:null},readTime:{value:null}}})},"0.99",{requires:["model","cluster-config-model","licenses-config-model","network-config-model","security-config-model","service-config-model","service-defaults-config-model","gateway-model"]}),YUI.add("gateway-dynamic-data-model",function(a){"use strict";var b=a.Lang,c="gatewayDynamicDataModel";a.GatewayDynamicDataModel=a.Base.create(c,a.Model,[],{dataDefinition:null,UPDATE_EVENT:c+":update",readTimeIndex:-1,initializer:function(){var a=this.get("gatewayModel").getSummaryDataDefinition("gateway");this.dataDefinition=a,this.readTimeIndex=this._getAttributeIndex("readTime"),this.publish(this.UPDATE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}})},hasAttribute:function(a){return this._getAttributeIndex(a)>=0},getValue:function(a,b){var c=this._getAttributeIndex(a);if(0>c)return void 0;var d=this.get("data");if(!d)return null;var e=d[c];return"function"==typeOf(e)&&(e=e()),b?[this.getReadTime(),e]:e},getReadTime:function(){var a=this.get("data");return a[a.length-1]},load:function(a){var b=a.summaryData;b.push(a.readTime),this.loadSummaryData(b)},loadSummaryData:function(a){var b=this.get("data");b&&b[this.readTimeIndex]===a[this.readTimeIndex]||(this.set("data",a),this.fire(this.UPDATE_EVENT,{model:this,data:a}))},processNotification:function(a){var b=a.value,c=a.readTime;b.push(c),this.loadSummaryData(b)},shutDown:function(a){var b=this.get("data");if(!b||b[this.readTimeIndex]!==a){if(b)b=b.slice(),b[this._getAttributeIndex("totalCurrentSessions")]=0;else{b=[];for(var c=this.dataDefinition.fields.length,d=0;c>d;d++)b[d]=0}b[this.readTimeIndex]=a,this.loadSummaryData(b)}},_getAttributeIndex:function(a){var b=this.dataDefinition.fields.indexOf(a);return b}},{ATTRS:{gatewayModel:{value:null},data:{value:null}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("jvm-model",function(a){"use strict";var b=a.Lang,c="jvmModel";a.JvmModel=a.Base.create(c,a.Model,[],{dataDefinition:null,UPDATE_EVENT:c+":update",initializer:function(){var a=this.get("gatewayModel").getSummaryDataDefinition("jvm");this.dataDefinition=a,this.publish(this.UPDATE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}})},hasAttribute:function(a){return this._getAttributeIndex(a)>=0},getValue:function(a,b){var c=this._getAttributeIndex(a);if(0>c)return void 0;var d=this.get("data");if(!d)return null;var e=d[c];return"function"==typeOf(e)&&(e=e()),b?[this.getReadTime(),e]:e},getReadTime:function(){var a=this.get("data");return a&&0!=a.length?a[a.length-1]:0},load:function(a){this.loadSummaryData(a.summaryData)},loadSummaryData:function(a){if(a&&a.length>0)for(var b=this.getReadTime(),c=0;c<a.length;c++){var d=a[c],e=d.jvmData,f=d.readTime;e.push(f),f>b&&(b=f,this.set("data",e)),this.fire(this.UPDATE_EVENT,{model:this,data:e})}},processNotification:function(a){this.loadSummaryData(a.value)},_getAttributeIndex:function(a){var b=this.dataDefinition.fields.indexOf(a);return b}},{ATTRS:{gatewayModel:{value:null},data:{value:null}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("list-model",function(a){"use strict";var b=a.Lang,c="listModel";a.ListModel=a.Base.create(c,a.Model,[],{LISTMODEL_ADD_EVENT:"listModel:add",LISTMODEL_REMOVE_EVENT:"listModel:remove",initializer:function(){var a=this;a.publish(a.LISTMODEL_ADD_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),a.publish(a.LISTMODEL_REMOVE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),a.items=[]},add:function(a){return this.items.push(a),this.fire(this.LISTMODEL_ADD_EVENT,{item:a}),a},remove:function(a){var b=this.items,c=b.indexOf(a);c>=0&&(b.splice(c,1),this.fire(this.LISTMODEL_REMOVE_EVENT,{item:a}))},item:function(a){return this.items[a]},size:function(){return this.items.length},values:function(){var a=this.items,b=a.slice(0);return b},filter:function(a){var b=this.items,c=[];return b&&b.forEach(function(b){a(b)&&c.push(b)}),c}},{ATTRS:{}})},"0.99",{requires:["model"]}),YUI.add("network-config-model",function(a){"use strict";var b=a.Lang,c="networkConfigModel";a.NetworkConfigModel=a.Base.create(c,a.Model,[],{hasAttribute:function(b){return a.NetworkConfigModel.ATTRS.hasOwnProperty(b)},initializer:function(){},dump:function(){CC.console.debug("NetworkConfig for GW "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"addressMappings",a)}},{ATTRS:{gatewayModel:{value:null},addressMappings:{value:null}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("nic-list-model",function(a){"use strict";var b=a.Lang,c="nicListModel";a.NicListModel=a.Base.create(c,a.Model,[],{dataDefinition:null,UPDATE_EVENT:c+":update",initializer:function(){var a=this.get("gatewayModel").getSummaryDataDefinition("nicList");this.dataDefinition=a,this.publish(this.UPDATE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}})},hasAttribute:function(a){return"netInterfaceNames"==a?!0:this._getAttributeIndex(a)>=0},getValue:function(a,b,c){if("netInterfaceNames"==b){var d=this.get("netInterfaceNames");return c?[CC.Constants.CONSTANT_TIME,d]:d}var e=this._getAttributeIndex(b);if(0>e)return void 0;var f=this.get("data");if(!f)return null;var g=f[a][e];return"function"==typeOf(g)&&(g=g()),c?[this.getReadTime(),g]:g},getReadTime:function(){var a=this.get("data");return a&&0!=a.length?a[a.length-1]:0},load:function(a){this.set("netInterfaceNames",a.netInterfaceNames),this.loadSummaryData(a.summaryData)},loadSummaryData:function(a){if(a&&a.length>0)for(var b=this.getReadTime(),c=this.get("netInterfaceNames"),d=0;d<a.length;d++){for(var e=a[d],f=e.nicData,g=e.readTime,h=0;h<c.length;h++)f[h].push(g);g>b&&(b=g,this.set("data",f)),this.fire(this.UPDATE_EVENT,{model:this,data:f})}},processNotification:function(a){this.loadSummaryData(a.value)},_getAttributeIndex:function(a){var b=this.dataDefinition.fields.indexOf(a);return b}},{ATTRS:{gatewayModel:{value:null},netInterfaceNames:{value:null},data:{value:null}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("realm-config-model",function(a){"use strict";var b=a.Lang,c="realmConfigModel";a.RealmConfigModel=a.Base.create(c,a.Model,[],{hasAttribute:function(b){return a.RealmConfigModel.ATTRS.hasOwnProperty(b)},initializer:function(){var a=this.get("loginModules");if(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.options;d&&delete d.GATEWAY_CONFIG_DIRECTORY}this.set("loginModules",a)}},dump:function(){CC.console.debug("SecurityConfig for GW "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"name",a),dumpAttr(this,"description",a),dumpAttr(this,"httpChallengeScheme",a),dumpAttr(this,"authorizationMode",a),dumpAttr(this,"sessionTimeout",a),dumpAttr(this,"userPrincipalClasses",a),dumpAttr(this,"httpCookieNames",a),dumpAttr(this,"httpHeaders",a),dumpAttr(this,"httpQueryParams",a),dumpAttr(this,"loginModules",a)},equals:function(a){return a?this===a?!0:equalModelStrings(a.get("name"),this.get("name"))&&equalModelStrings(a.get("description"),this.get("description"))&&equalModelStrings(a.get("httpChallengeScheme"),this.get("httpChallengeScheme"))&&equalModelStrings(a.get("authorizationMode"),this.get("authorizationMode"))&&equalModelNumbers(a.get("sessionTimeout"),this.get("sessionTimeout"))&&equalModelArrays(a.get("userPrincipalClasses"),this.get("userPrincipalClasses"))&&equalModelArrays(a.get("httpCookieNames"),this.get("httpCookieNames"))&&equalModelArrays(a.get("httpHeaders"),this.get("httpHeaders"))&&equalModelArrays(a.get("httpQueryParams"),this.get("httpQueryParams"))&&equalModelArrays(a.get("loginModules"),this.get("loginModules"))?!0:!1:!1},sortCompare:function(a){var b=this.get("name"),c=a.get("name");return b=b.toLowerCase(),c=c.toLowerCase(),c>b?-1:b>c?1:0},addServiceConfig:function(a){this.get("serviceConfigs").push(a)}},{ATTRS:{gatewayModel:{value:null},name:{value:null},description:{value:null},httpChallengeScheme:{value:null},authorizationMode:{value:null},sessionTimeout:{value:null},userPrincipalClasses:{value:null},httpCookieNames:{value:null},httpHeaders:{value:null},httpQueryParams:{value:null},loginModules:{value:null},serviceConfigs:{value:[]}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("security-config-model",function(a){"use strict";var b=a.Lang,c="securityConfigModel";a.SecurityConfigModel=a.Base.create(c,a.Model,[],{hasAttribute:function(b){return a.SecurityConfigModel.ATTRS.hasOwnProperty(b)},initializer:function(){var b=this.get("realmConfigs");if(b)if(0===b.length)this.set("realmConfigs",null);else{for(var c=this.get("gatewayModel"),d={},e=0;e<b.length;e++){var f=b[e];f.gatewayModel=c,f=new a.RealmConfigModel(f),d[f.get("name")]=f}this.set("realmConfigs",d)}},equalsKeystoreInfo:function(a){return a?this===a?!0:equalModelStrings(a.get("keystoreType"),this.get("keystoreType"))?!0:!1:!1},sortCompareKeystore:function(a){if(!a)return-1;var b;return b=compareStrings(this.get("keystoreType"),a.get("keystoreType")),0!=b?b:0},equalsTruststoreInfo:function(a){return a?this===a?!0:equalModelStrings(a.get("truststoreType"),this.get("truststoreType"))?!0:!1:!1},sortCompareTruststore:function(a){if(!a)return-1;var b;return b=compareStrings(this.get("truststoreType"),a.get("truststoreType")),0!=b?b:0},getRealmConfig:function(a){var b=this.get("realmConfigs");return b?b[a]:null},dump:function(){CC.console.debug("SecurityConfig for GW "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"keystoreType",a),dumpAttr(this,"keystoreCertificateInfo",a),dumpAttr(this,"truststoreType",a),dumpAttr(this,"truststoreCertificateInfo",a),dumpAttr(this,"realmConfigs",a)}},{ATTRS:{gatewayModel:{value:null},keystoreType:{value:null},keystoreCertificateInfo:{value:null},truststoreType:{value:null},truststoreCertificateInfo:{value:null},realmConfigs:{value:null}}})},"0.99",{requires:["model","gateway-model","realm-config-model"]}),YUI.add("service-config-model",function(a){"use strict";var b=a.Lang,c="serviceConfigModel",d=function(){var a=0;return function(){return a++}}();a.ServiceConfigModel=a.Base.create(c,a.Model,[],{SERVICE_TYPE_VALUES:{broadcast:10,echo:10,"stomp.proxy":10,"stomp.jms":10,"stomp.interceptor":10,directory:20,balancer:19,session:20,keyring:20,"http.proxy":30,proxy:30,"management.jmx":100,"$management.jmx$":100,"management.snmp":101,"$management.snmp$":101},hasAttribute:function(b){return a.ServiceConfigModel.ATTRS.hasOwnProperty(b)},initializer:function(){this.set("clientServiceConfigId",d())},equals:function(a){return a?this===a?!0:equalModelStrings(a.get("name"),this.get("name"))&&equalModelStrings(a.get("type"),this.get("type"))&&equalModelStrings(a.get("description"),this.get("description"))&&equalModelObjects(a.get("crossSiteConstraints"),this.get("crossSiteConstraints"))&&equalModelObjects(a.get("properties"),this.get("properties"))&&equalModelArrays(a.get("requiredRoles"),this.get("requiredRoles"))&&equalModelObjects(a.get("mimeMappings"),this.get("mimeMappings"))&&this.equalRealms(a)&&equalModelObjects(a.get("acceptOptions"),this.get("acceptOptions"))&&equalModelObjects(a.get("connectOptions"),this.get("connectOptions"))&&equalModelArrays(a.get("balances"),this.get("balances"))&&(this.isBalanced()||equalModelStrings(a.get("accepts"),this.get("accepts")))&&equalModelStrings(a.get("connects"),this.get("connects"))?!0:!1:!1},equalRealms:function(a){var b=this.get("realm"),c=a.get("realm");if(b){if(!b.equals(c))return!1}else if(c)return!1;return!0},equalConnectOptions:function(a){var b=this.get("connectOptions"),c=a.get("connectOptions");if(b){if(!thisOptions.equals(c))return!1}else if(c)return!1;return!0},sortCompare:function(a){var b=this.SERVICE_TYPE_VALUES[this.get("type")],c=this.SERVICE_TYPE_VALUES[a.get("type")];if(c>b)return-1;if(b>c)return 1;var d=this.get("name"),e=a.get("name");return d?e?(d=d.toLowerCase(),e=e.toLowerCase(),e>d?-1:d===e?0:1):-1:e?1:0},isManagement:function(){var a=this.get("type");return a.startsWith("$management.")||a.startsWith("management.")?!0:!1},isBalanced:function(){var a=this.get("balances");return a&&a.length>0},dump:function(){CC.console.debug("ServiceConfig for GW "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"name",a),dumpAttr(this,"type",a),dumpAttr(this,"description",a),dumpAttr(this,"accepts",a),dumpAttr(this,"acceptOptions",a),dumpAttr(this,"balances",a),dumpAttr(this,"connects",a),dumpAttr(this,"connectOptions",a),dumpAttr(this,"crossSiteConstraints",a),dumpAttr(this,"properties",a),dumpAttr(this,"requiredRoles",a),dumpAttr(this,"realm",a),dumpAttr(this,"mimeMappings",a)}},{ATTRS:{gatewayModel:{value:null},serviceId:{value:null},type:{value:null},name:{value:null},description:{value:null},accepts:{value:null},acceptOptions:{value:null},balances:{value:null},connects:{value:null},connectOptions:{value:null},crossSiteConstraints:{value:null},properties:{value:null},requiredRoles:{value:null},realm:{value:null},mimeMappings:{value:null},label:{getter:function(){var a=this.get("name");return a||(a="Type: "+this.get("type")),a}}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("service-defaults-config-model",function(a){"use strict";var b=a.Lang,c="serviceDefaultsConfigModel";a.ServiceDefaultsConfigModel=a.Base.create(c,a.Model,[],{hasAttribute:function(b){return a.ServiceDefaultsConfigModel.ATTRS.hasOwnProperty(b)},initializer:function(){},dump:function(){CC.console.debug("ServiceDefaultsConfig for GW "+this.get("gatewayModel").getDebugIdStr());var a=2;dumpAttr(this,"acceptOptions",a),dumpAttr(this,"mimeMappings",a)}},{ATTRS:{gatewayModel:{value:null},acceptOptions:{value:null},mimeMappings:{value:null}}})},"0.99",{requires:["model","gateway-model"]}),YUI.add("service-dynamic-data-model",function(a){"use strict";var b=a.Lang,c="serviceDynamicDataModel";a.ServiceDynamicDataModel=a.Base.create(c,a.Model,[],{dataDefinition:null,UPDATE_EVENT:c+":update",readTimeIndex:-1,initializer:function(){var a=this.get("serviceModel").get("gatewayModel").getSummaryDataDefinition("service"),b=a.fields;b.indexOf("totalBytesSentThroughput")<0&&b.push("totalBytesSentThroughput","totalBytesReceivedThroughput",b.pop()),this.dataDefinition=a,this.readTimeIndex=this._getAttributeIndex("readTime"),this.publish(this.UPDATE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}})},hasAttribute:function(a){return this._getAttributeIndex(a)>=0},getValue:function(a,b){var c=this._getAttributeIndex(a);if(0>c)return void 0;var d=this.get("data");if(!d)return null;var e=d[c];return"function"==typeOf(e)&&(e=e()),b?[this.getReadTime(),e]:e},getReadTime:function(){var a=this.get("data");return a[a.length-1]},load:function(a){var b=a.summaryData,c=a.readTime;b[this._getAttributeIndex("totalBytesSentThroughput")]=b[this._getAttributeIndex("totalBytesSent")].toFixed(2),b[this._getAttributeIndex("totalBytesReceivedThroughput")]=b[this._getAttributeIndex("totalBytesReceived")].toFixed(2),b[this._getAttributeIndex("readTime")]=a.readTime,this.loadSummaryData(b)},loadSummaryData:function(a){var b=this.get("data");b&&b[this.readTimeIndex]===a[this.readTimeIndex]||(this.set("data",a),this.fire(this.UPDATE_EVENT,{model:this,data:a}))},processNotification:function(a){var b=a.value,c=a.readTime;b[this._getAttributeIndex("totalBytesSentThroughput")]=this.computeThroughputAttr(b,"totalBytesSent",c),b[this._getAttributeIndex("totalBytesReceivedThroughput")]=this.computeThroughputAttr(b,"totalBytesReceived",c),b[this._getAttributeIndex("readTime")]=c,this.loadSummaryData(b)},_getAttributeIndex:function(a){var b=this.dataDefinition.fields.indexOf(a);return b},_setValue:function(a,b){var c=this._getAttributeIndex(a);this.get("data")[c]=b},computeThroughputAttr:function(a,b,c){var d=this.getValue(b),e=this.getValue("readTime"),f=this._getAttributeIndex(b),g=a[f],h;return h=e===c?g:(g-d)/(c-e)*1e3,h.toFixed(2)}},{ATTRS:{serviceModel:{value:null},data:{value:null}}})},"0.99",{requires:["model","service-model"]}),YUI.add("session-dynamic-data-model",function(a){"use strict";var b=a.Lang,c="sessionDynamicDataModel";a.SessionDynamicDataModel=a.Base.create(c,a.Model,[],{dataDefinition:null,UPDATE_EVENT:c+":update",readTimeIndex:-1,initializer:function(){var a=this.get("sessionModel").get("serviceModel").get("gatewayModel").getSummaryDataDefinition("session");this.dataDefinition=a,this.readTimeIndex=this._getAttributeIndex("readTime"),this.publish(this.UPDATE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}})},hasAttribute:function(a){return this._getAttributeIndex(a)>=0},getValue:function(a,b){var c=this._getAttributeIndex(a);if(0>c)return void 0;var d=this.get("data");if(!d)return null;var e=d[c];return"function"==typeOf(e)&&(e=e()),b?[this.getReadTime(),e]:e},getReadTime:function(){var a=this.get("data");return a[a.length-1]},load:function(a){var b=a.summaryData,c=a.readTime;b.push(c),this.loadSummaryData(b)},loadSummaryData:function(a){var b=this.get("data");b&&b[this.readTimeIndex]===a[this.readTimeIndex]||(this.set("data",a),this.fire(this.UPDATE_EVENT,{model:this,data:a}))},processNotification:function(a){var b=a.value,c=a.readTime,d=this._getAttributeIndex("readBytesThroughput");b[d]=b[d].toFixed(2),d=this._getAttributeIndex("writtenBytesThroughput"),b[d]=b[d].toFixed(2),b[this._getAttributeIndex("readTime")]=c,this.loadSummaryData(b)},_getAttributeIndex:function(a){return this.dataDefinition.fields.indexOf(a)},_setValue:function(a,b){var c=this._getAttributeIndex(a);this.get("data")[c]=b}},{ATTRS:{sessionModel:{value:null},data:{value:null}}})},"0.99",{requires:["model","session-model"]}),YUI.add("system-model",function(a){"use strict";var b=a.Lang,c="systemModel";a.SystemModel=a.Base.create(c,a.Model,[],{dataDefinition:null,UPDATE_EVENT:c+":update",initializer:function(){var a=this.get("gatewayModel").getSummaryDataDefinition("system");this.dataDefinition=a,this.publish(this.UPDATE_EVENT,{emitFacade:!0,broadcast:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}})},hasAttribute:function(a){return this._getAttributeIndex(a)>=0},getValue:function(a,b){var c=this._getAttributeIndex(a);if(0>c)return void 0;var d=this.get("data");if(!d)return null;var e=d[c];return"function"==typeOf(e)&&(e=e()),b?[this.getReadTime(),e]:e},getReadTime:function(){var a=this.get("data");return a&&0!=a.length?a[a.length-1]:0},load:function(a){this.loadSummaryData(a.summaryData)},loadSummaryData:function(a){if(a&&a.length>0)for(var b=this.getReadTime(),c=0;c<a.length;c++){var d=a[c],e=d.systemData,f=d.readTime;e.push(f),f>b&&(b=f,this.set("data",e)),this.fire(this.UPDATE_EVENT,{model:this,data:e})}},processNotification:function(a){this.loadSummaryData(a.value)},_getAttributeIndex:function(a){var b=this.dataDefinition.fields.indexOf(a);return b}},{ATTRS:{gatewayModel:{value:null},data:{value:null}}})},"0.99",{requires:["model","gateway-model"]});