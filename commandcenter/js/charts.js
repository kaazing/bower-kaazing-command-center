/*
 * Copyright (c) 2007-2014 Kaazing Corporation. All rights reserved.
 * 
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

YUI.add("cpu-all-perc-chart",function(a){"use strict";var b=a.Lang,c="cpuAllPercChart";a.CpuAllPercChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.CpuListModel.prototype.UPDATE_EVENT,b.onCpuListUpdate,b)},onCpuListUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=a.data,i=h.length;if(0!=i){var j=f[g];if(!j){j=[];for(var k=0;k<h.length;k++)j.push([]);f[g]=j,c=!0}var l=this.get("combinedIndex"),m=this.get("readTimeIndex");null==l&&(m=e.summaryAttributeIndex("cpuList","readTime"),l=e.summaryAttributeIndex("cpuList","combined"),this.set("readTimeIndex",m),this.set("combinedIndex",l));for(var n=this.get("yDomain"),o=this.get("valuesMultiplier"),p,q={domainMin:n[0],domainMax:n[1],valuesMultiplier:o},r=a.data[0][m],s=0;i>s;s++)p=h[s][l],q=this.computeDomainBounds(p,q.domainMin,q.domainMax,q.valuesMultiplier),insertChartValue(j[s],r,p),b.isTimeVisible(r)&&(c=!0);(q.domainMin!==n[0]||q.domainMax!==n[1]||q.valuesMultiplier!==o)&&(this.set("yDomain",[q.domainMin,q.domainMax]),this.set("valuesMultiplier",q.valuesMultiplier),c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()}},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)if(c.hasOwnProperty(d)){var e=a.findGatewayModelByInstanceKey(d);if(this.isShowGateway(e))for(var f=e.get("cpuListModel"),g=f.get("numCpus"),h=0;g>h;h++)b.push([d,h])}return b},getDataItemValues:function(a){var b=a[0],c=a[1],d=this.get("dataItemValues"),e=d[b];return e?e[c]:[]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=minMaxAverageMultipleSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a[0]);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){var c=a[0]===b[0]&&a[1]===b[1];return c}},{ATTRS:{title:{value:null},valueType:{value:"percentage"},showUnits:{value:!1},dataItemValues:{value:{}},combinedIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("cpu-avg-perc-chart",function(a){"use strict";var b=a.Lang,c="cpuAvgPercChart";a.CpuAvgPercChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.CpuListModel.prototype.UPDATE_EVENT,b.onCpuListUpdate,b)},onCpuListUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=a.data,i=f[g];i||(i=[],f[g]=i,c=!0);var j=this.get("combinedIndex"),k=this.get("readTimeIndex");null==j&&(k=e.summaryAttributeIndex("cpuList","readTime"),j=e.summaryAttributeIndex("cpuList","combined"),this.set("readTimeIndex",k),this.set("combinedIndex",j));for(var l=h.length,m=0,n=0;l>n;n++)m+=h[n][j];l>0&&(m/=l);var o=a.data[0][k],p=this.get("yDomain"),q=this.get("valuesMultiplier"),r=this.computeDomainBounds(m,p[0],p[1],q);(r.domainMin!==p[0]||r.domainMax!==p[1]||r.valuesMultiplier!==q)&&(this.set("yDomain",[r.domainMin,r.domainMax]),this.set("valuesMultiplier",r.valuesMultiplier),c=!0),insertChartValue(i,o,m),b.isTimeVisible(o)&&(c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)c.hasOwnProperty(d)&&this.isShowGateway(a.findGatewayModelByInstanceKey(d))&&b.push(d);return b},getDataItemValues:function(a){var b=this.get("dataItemValues")[a];return b?b:[]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=minMaxAverageSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){return a===b}},{ATTRS:{title:{value:null},valueType:{value:"percentage"},showUnits:{value:!1},dataItemValues:{value:{}},combinedIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("current-sessions-chart",function(a){"use strict";var b=a.Lang,c="currentSessionsChart";a.CurrentSessionsChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.GatewayDynamicDataModel.prototype.UPDATE_EVENT,b.onGatewayUpdate,b)},onGatewayUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=f[g];h||(h=[],f[g]=h,c=!0);var i=this.get("totalCurrentSessionsIndex"),j=this.get("readTimeIndex");null==i&&(j=e.summaryAttributeIndex("gateway","readTime"),i=e.summaryAttributeIndex("gateway","totalCurrentSessions"),this.set("readTimeIndex",j),this.set("totalCurrentSessionsIndex",i));var k=a.data[j],l=a.data[i],m=this.get("yDomain"),n=this.get("valuesMultiplier"),o=this.computeDomainBounds(l,m[0],m[1],n);(o.domainMin!==m[0]||o.domainMax!==m[1]||o.valuesMultiplier!==n)&&(this.set("yDomain",[o.domainMin,o.domainMax]),this.set("valuesMultiplier",o.valuesMultiplier),c=!0),insertChartValue(h,k,l),b.isTimeVisible(k)&&(c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)if(c.hasOwnProperty(d)){var e=a.findGatewayModelByInstanceKey(d);this.isShowGateway(e)&&b.push(d)}return b},getDataItemValues:function(a){var b=a,c=this.get("dataItemValues"),d=c[b];return d?d:[]},extendLastValue:function(a,b,c){var d=this.get("model"),e=d.findGatewayModelByInstanceKey(a),f=e.get("stopTime");return f&&c>f?[f,b[1]]:[c,b[1]]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=totalSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){return a===b}},{ATTRS:{title:{value:null},valueType:{value:"number"},interpolation:{value:"step-after"},extendLastValue:{value:!0},dataItemValues:{value:{}},totalCurrentSessionsIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("dashboard-chart",function(a){"use strict";var b=a.Lang,c="dashboardChart",d=!1,e=.5,f=18,g=200,h="../images/expand.png",i="../images/expand.png",j="../images/close.png",k={number:{initDomain:[0,10],maxVals:[0,1,5,10,25,50,100,250,500,1e3],minVals:[0,-1,-5,-10,-25,-50,-100,-250,-500,-1e3],valMultiplierSize:1e3,unitsFn:numberUnits},percentage:{initDomain:[0,100],maxVals:[0,1,5,10,25,50,100,250,500,1e3],minVals:[0,-1,-5,-10,-25,-50,-100,-250,-500,-1e3],valMultiplierSize:1e3,unitsFn:numberUnits},bytes:{initDomain:[0,1024],maxVals:[0,1,5,10,25,50,100,250,500,1e3],minVals:[0,-1,-5,-10,-25,-50,-100,-250,-500,-1e3],valMultiplierSize:1024,unitsFn:byteUnits},byteRate:{initDomain:[0,1024],maxVals:[0,1,5,10,25,50,100,250,500,1e3],minVals:[0,-1,-5,-10,-25,-50,-100,-250,-500,-1e3],valMultiplierSize:1024,unitsFn:byteRateUnits},numberRate:{initDomain:[0,10],maxVals:[0,1,5,10,25,50,100,250,500,1e3],minVals:[0,-1,-5,-10,-25,-50,-100,-250,-500,-1e3],valMultiplierSize:1e3,unitsFn:numberRateUnits},other:{initDomain:[0,1],maxVals:[0,1,5,10,25,50,100,250,500,1e3],minVals:[0,-1,-5,-10,-25,-50,-100,-250,-500,-1e3],valMultiplierSize:1e3,unitsFn:numberUnits}};a.DashboardChart=a.Base.create(c,a.KaazingView,[],{initializer:function(){var b=this;d="Firefox"===BrowserDetect.browser;var c=this.get("container"),e=createDIV(c,"dashboardChartContent");this.set("chartContent",e),this.setupChart(e),this.setupTitle(e),this.adjustTitle(),this.setupSummary(e),this.adjustSummary(),this.setupDrag(c);var f=this.get("dashboard");this.addSubscription(f.on(a.DashboardView.prototype.MODEL_CHANGE_EVENT,this.onModelChange,b)),this.addSubscription(f.on(a.DashboardView.prototype.BOUNDS_CHANGE_EVENT,this.onBoundsChange,b)),this.addSubscription(f.on(a.DashboardView.prototype.ADD_CHART_EVENT,this.onAddChart,b)),this.addSubscription(f.on(a.DashboardView.prototype.DELETE_CHART_EVENT,this.onDeleteChart,b)),this.addSubscription(f.on(a.DashboardView.prototype.RESIZE_EVENT,this.onResize,b)),this.addSubscription(f.on(a.DashboardView.prototype.TOGGLE_CHART_SIZE_EVENT,this.onToggleChartSize,b)),this.addSubscription(f.on(a.DashboardView.prototype.SHOW_GATEWAY_CHANGE_EVENT,this.onShowGatewayChange,b))},onModelChange:function(a){this.drawChart()},afterConnectionUrlChange:function(a){},onBoundsChange:function(a){this.drawChart()},onAddChart:function(a){this.unmaximize(),this.drawChart()},onDeleteChart:function(a){this.unmaximize(),this.drawChart()},onResize:function(a){this.drawChart()},onToggleChartSize:function(a){var b=a.maximizedChart;b?b===this?this.maximize():this.hide():this.unmaximize(),this.drawChart()},onShowGatewayChange:function(){this.drawChart()},setupChart:function(a){var b=createDIV(a,"chartArea");this.set("chartArea",b),this.setupCanvas(b),this.get("container").addClass("hidden"),this.setupYDomain(),this.setupPanZoom()},setupCanvas:function(a){var b=createCANVAS(a,"canvas").set("id","canvas_"+this.get("chartId")).getDOMNode(),c=this.get("dashboard"),d=c.get("chartAreaSize");b.width=d[0],b.height=d[1],this.set("canvas",b);var e=b.getContext("2d");this.set("context",e)},adjustChartSize:function(){var a=this.get("dashboard"),b=a.get("chartContainerSize"),c=this.get("container");c.setStyle("width",b[0]+"%"),c.setStyle("height",b[1]+"%");var d=this.get("canvas"),e=a.get("chartAreaSize");d.width=e[0],d.height=e[1]},setupYDomain:function(){var a=this.getValueTypeInfo("initDomain").slice(0);this.set("yDomain",a)},setupPanZoom:function(){var a=this,b=this.get("canvas"),c=this.get("dashboard");b.addEventListener(d?"DOMMouseScroll":"mousewheel",function(b){a.handleMouseWheel(b)},!1);var e=function(b){b.stopPropagation(),b.preventDefault(),a.handlePan(b)};b.addEventListener("mousedown",function(c){var d=a.getMousePos(c);a.inChartBody(d)&&(a.set("panMousePos",{x:d.x,y:d.y}),b.addEventListener("mousemove",e,!1),a.get("dashboard").startPanningOrZooming(),c.stopPropagation(),c.preventDefault())},!1),b.addEventListener("mouseup",function(c){a.set("panMousePos",null),b.removeEventListener("mousemove",e,!1),a.get("dashboard").endPanningOrZooming(),c.stopPropagation(),c.preventDefault()},!1)},handlePan:function(a){var b=this.get("panMousePos"),c=this.getMousePos(a),d=c.x-b.x;this.set("panMousePos",{x:c.x,y:c.y}),0!==d&&this.get("dashboard").translateByPixels(-d)},handleMouseWheel:function(a){var b=this.getWheelDelta(a);this.get("dashboard").scale(b)},getWheelDelta:function(a){var b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));return b},getMousePos:function(a){var b=this.get("canvas").getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}},inChartBody:function(a){var b=this.get("dashboard"),c=b.get("chartMargin"),d=b.get("chartSize"),e=a.x>=c.left&&a.x<=c.left+d[0]&&a.y>=c.top&&a.y<=c.top+d[1];return e},clearContext:function(){var a=this.get("canvas");a.width=a.width},setupDrag:function(b){var c=new a.DD.Drag({node:b}).addHandle(".titleDiv");c.set("data",{chart:this}),this.set("drag",c);var d=new a.DD.Drop({node:b});d.set("data",{chart:this}),this.set("drop",d)},setupTitle:function(a){var b=this,c=createDIV(a,"titleDiv");this.set("titleDiv",c);var d=createSPAN(c,"","titleSpan"),e=createIMG(c,j,"closeBox");e.setAttribute("alt","Close"),e.on("click",function(){b.get("dashboard").handleDeleteChart(b)});var f=createIMG(c,this.get("maximized")?i:h,"toggleChartSizeBox");f.on("click",function(){b.get("dashboard").handleToggleChartSize(b)}),f.setAttribute("alt","Maximize/unmaximize")},adjustTitle:function(){var a=this.get("showUnits"),b=this.get("titleDiv"),c=this.get("title");if(a!==!1){var d=this.getValueTypeInfo("unitsFn"),e=this.get("valuesMultiplier");(a||e>1)&&(c=c+" ("+d(e)+")")}var f=b.one("span");f.set("text",c)},setupSummary:function(a){var b=createDIV(a,"summaryDiv");this.set("summaryDiv",b)},adjustSummary:function(){var a=this.get("summaryDiv");a.setHTML(this.computeSummaryHtml())},drawChart:function(){var a=this.get("dashboard");if(a.isActiveView()&&!this.isHidden()){var b=Date.now();this.adjustChartSize();var c=this.get("context"),d=a.get("chartMargin"),e=a.get("chartSize");this.clearContext(),this.adjustTitle(),this.drawYAxisAndGrid(c,d,e[0],e[1]),this.drawXAxisAndGrid(c,d,e[0],e[1]),this.drawData(c,d,e[0],e[1]),this.adjustSummary()}},drawYAxisAndGrid:function(a,b,c,d){a.save(),a.translate(b.left,b.top+d),a.beginPath(),a.lineWidth=1,a.strokeStyle="#000000",a.moveTo(0+e,0+e),a.lineTo(0+e,-d+e),a.stroke(),a.save(),a.beginPath();for(var f=this.get("yDomain"),g=[2,5,10,20],h=null,i=d,j=f[1]-f[0],k=g.length-1;k>=0;k--){var l=g[k];if(Math.round(i/l)>=20&&Math.round(j/l)>=1){h=l;break}}null==h&&(h=g[0]);var m=this.get("tickSize"),n=(f[1]-f[0])/h,o=-(d/h);a.font="normal 100% arial",a.textAlign="right",a.textBaseline="middle",a.strokeStyle="#444444";for(var k=0;h>=k;k++){var p=Math.round(k*o),q=Math.round(k*n);a.moveTo(0+e,p+e),a.lineTo(-m+e,p+e),a.strokeText(""+q,-12+e,p+e)}a.stroke(),a.restore(),a.save(),a.beginPath(),a.strokeStyle="#C8C8C8";for(var k=0;h>=k;k++){var p=Math.round(k*o);a.moveTo(0+e,p+e),a.lineTo(c+e,p+e)}a.stroke(),a.restore(),a.restore()},drawXAxisAndGrid:function(a,b,c,d){var h=this,i=this.get("dashboard");a.save(),a.translate(b.left,b.top+d),a.beginPath(),a.lineWidth=1,a.strokeStyle="#000000",a.moveTo(0+e,0+e),a.lineTo(c+e,0+e),a.stroke();for(var j=i.get("xDomain"),k=i.get("xDomainClip"),l=i.get("xRange"),m=i.get("xTicks"),n=this.get("tickSize"),o=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5],p=o.length,q=j[0],r=j[1],s=Math.floor((l[1]-l[0])/c*m),t=(r-q)/s,u,v=0;p>v;v++)if(t<o[v]||v==p-1){u=v;break}var w=(l[1]-l[0])*o[u]/(j[1]-j[0]);if(f>w)for(;f>w&&p-1>u;)u++,w=(l[1]-l[0])*o[u]/(j[1]-j[0]);else if(w>g)for(;w>g&&u>0;)u--,w=(l[1]-l[0])*o[u]/(j[1]-j[0]);t=o[u];var x=k[0]%t,y=0==x?k[0]:k[0]-x+t;m=Math.floor((k[1]-k[0])/t)+1,a.save(),a.beginPath(),a.font="normal 100% arial",a.textAlign="center",a.textBaseline="middle",a.strokeStyle="#666666";for(var z=[],A=[scaleX(k[0],j,l),scaleX(k[1],j,l)],v=0;m>v;v++){var B=y+v*t,C=scaleX(B,j,l);if(C>=A[0]&&C<=A[1]){C-=A[0],z.push(C);var D=new Date(B),E=0==D.getSeconds()?addZero(D.getHours())+":"+addZero(D.getMinutes()):":"+addZero(D.getSeconds());a.moveTo(C+e,0+e),a.lineTo(C+e,n+e),a.strokeText(E,C+e,13+e)}}a.stroke(),a.restore(),a.save(),a.beginPath(),a.strokeStyle="#C8C8C8";for(var v=0;v<z.length;v++){var C=z[v];a.moveTo(C+e,0+e),a.lineTo(C+e,-d+e)}a.stroke(),a.restore(),a.restore()},drawData:function(a,b,c,d){var f=this,g=this.getDataItems(),h=g.length;if(0!=h){var i=this.get("dashboard"),j=i.get("lastDisplayableTime"),k=i.get("xDomain"),l=i.get("xRange"),m=i.get("xDomainClip"),n=m[0];if(!(n>j))for(var o=Math.min(m[1],j),p=i.get("yRange"),q=this.get("yDomain"),r=scaleX(n,k,l),s=this.get("extendLastValue"),t=this.get("interpolation"),u=0;h>u;u++){var v=g[u],w=this.getDataItemValues(v),x=w.length;if(0!==x){var y=w[0][0];if(!(y>o)&&(y=w[x-1][0],!(n>y)||s)){var z,A,B;for(B=0;x>B&&!(w[B][0]>=n);B++);for(z=B>0?B-1:B,B=z;x>B&&!(w[B][0]>o);B++);var C=this.getDataItemColor(v),D=this.getDataItemLineStyle(v);A=B==x?B-1:B,a.save(),a.translate(b.left,b.top+d),a.beginPath(),a.rect(0,0,c,-d),a.clip(),a.beginPath(),a.lineWidth=1,a.strokeStyle=C;for(var E=this.get("valuesMultiplier"),F,G,H,I,J,B=z;A>=B;B++)H=w[B],F=scaleX(H[0],k,l)-r,G=scaleY(H[1],q,E,p),B==z?a.moveTo(F+e,G+e):"step-before"===t?(G!=J&&this.lineTo(a,D,I,J,I,G),this.lineTo(a,D,I,G,F,G)):"step-after"===t?(this.lineTo(a,D,I,J,F,J),F!=I&&this.lineTo(a,D,F,J,F,G)):this.lineTo(a,D,I,J,F,G),I=F,J=G;if(s&&w[A][0]<o){var K=this.extendLastValue(v,w[A],o);F=scaleX(K[0],k,l)-r,G=scaleY(K[1],q,E,p),this.lineTo(a,D,I,J,F,G)}a.stroke(),a.restore()}}}}},extendLastValue:function(a,b,c){return[c,b[1]]},lineTo:function(a,b,c,d,f,g){b==CC.Constants.LineStyle.DASHED?a.dashedLine(c+e,d+e,f+e,g+e,[4,2]):a.lineTo(f+e,g+e)},getDataItems:function(){return[]},computeSummaryHtml:function(){return""},getDataItemValues:function(a){return[]},destroy:function(b){this.deleteSubscriptions();var c=this.get("container");removeAllChildren(c),this.set("canvas",null),this.set("context",null),this.set("yDomain",null),this.set("titleDiv",null),this.set("chartArea",null),this.set("summaryDiv",null),this.set("dashboard",null);var d=this.get("drag");d&&(d.set("data",null),this.set("drag",null),d.destroy());var e=this.get("drop");e&&(e.set("data",null),this.set("drop",null),e.destroy()),a.DashboardChart.superclass.destroy.call(this,b)},isShowGateway:function(a){var b=this.get("dashboard").isShowGateway(a.get("connectionUrl"));return b},computeDomainBounds:function(a,b,c,d){var e=b*d,f=c*d,g=!1;if(e>a&&(e=a,g=!0),a>f&&(f=a,g=!0),g){var h=this.getValueTypeInfo("valMultiplierSize");d=1;for(var i=Math.max(Math.abs(e),Math.abs(f));i>h;)d*=h,i/=h;b=this.niceMin(e/d),c=this.niceMax(f/d)}return{domainMin:b,domainMax:c,valuesMultiplier:d}},niceMin:function(a){for(var b=this.getValueTypeInfo("minVals"),c=0;c<b.length;c++)if(a>=b[c])return b[c];return b[b.length-1]},niceMax:function(a){for(var b=this.getValueTypeInfo("maxVals"),c=0;c<b.length;c++)if(a<=b[c])return b[c];return b[b.length-1]},isHidden:function(){var a=this.get("container");return a.hasClass("hidden")},hide:function(){var a=this.get("container");return a.addClass("hidden"),this},unhide:function(){var a=this.get("container");return a.removeClass("hidden"),this},maximize:function(){this.unhide();var a=this.get("container"),b=a.one(".toggleChartSizeBox");b.setAttribute("src",i),this.set("maximized",!0)},unmaximize:function(){this.unhide();var a=this.get("container"),b=a.one(".toggleChartSizeBox");b.setAttribute("src",h),this.set("maximized",!1)},isMaximized:function(){return this.get("maximized")},isNormal:function(){return!this.isHidden()&&!this.isMaximized()},getValueTypeInfo:function(a){var b=k[this.get("valueType")];return b||(b=k.other),b[a]},getDataItemColor:function(a){return this.get("dashboard").getColor(a)},getDataItemLineStyle:function(a){return CC.Constants.LineStyle.SOLID},addSubscription:function(a){this.get("subscriptions").push(a)},deleteSubscriptions:function(){var a=this.get("subscriptions");a.forEach(function(a){a.detach()})},dumpVals:function(a){if(a&&a.length>0){for(var b=0;b<a.length;b++)CC.console.debug("["+a[b][0]+", "+a[b][1]+"]");CC.console.debug("#########"),CC.console.debug(" ")}}},{ATTRS:{container:{value:null},titleDiv:{value:null},chartArea:{value:null},summaryDiv:{value:null},dashboard:{value:null},title:{value:null},valueType:{value:null},showUnits:{value:null},interpolation:{value:"linear"},extendLastValue:{value:!1},canvas:{value:null},context:{value:null},yDomain:{value:null},yTicks:{value:5},tickSize:{value:6},valuesMultiplier:{value:1},chartId:{value:null},maximized:{value:!1},panMousePos:{value:null},subscriptions:{value:[]}}})},"0.99",{requires:["kaazing-view","cluster-model","gateway-model","dashboard-view"]}),YUI.add("jvm-heap-chart",function(a){"use strict";var b=a.Lang,c="jvmHeapChart";a.JvmHeapChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.JvmModel.prototype.UPDATE_EVENT,b.onJvmUpdate,b)},onJvmUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=f[g];h||(h=[],f[g]=h,c=!0);var i=this.get("memHeapUsedIndex"),j=this.get("readTimeIndex");null==i&&(j=e.summaryAttributeIndex("jvm","readTime"),i=e.summaryAttributeIndex("jvm","memHeapUsed"),this.set("readTimeIndex",j),this.set("memHeapUsedIndex",i));var k=a.data[j],l=a.data[i],m=this.get("yDomain"),n=this.get("valuesMultiplier"),o=this.computeDomainBounds(l,m[0],m[1],n);(o.domainMin!==m[0]||o.domainMax!==m[1]||o.valuesMultiplier!==n)&&(this.set("yDomain",[o.domainMin,o.domainMax]),this.set("valuesMultiplier",o.valuesMultiplier),c=!0),insertChartValue(h,k,l),b.isTimeVisible(k)&&(c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)c.hasOwnProperty(d)&&this.isShowGateway(a.findGatewayModelByInstanceKey(d))&&b.push(d);return b},getDataItemValues:function(a){var b=this.get("dataItemValues")[a];return b?b:[]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=minMaxAverageSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){return a===b}},{ATTRS:{title:{value:null},valueType:{value:"bytes"},showUnits:{value:!0},dataItemValues:{value:{}},memHeapUsedIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("nic-read-thpt-combined-chart",function(a){"use strict";var b=a.Lang,c="nicReadThptCombinedChart";a.NicReadThptCombinedChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.NicListModel.prototype.UPDATE_EVENT,b.onNicListUpdate,b)},onNicListUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=a.data,i=h.length;if(0!=i){var j=f[g];j||(j=[],f[g]=j,c=!0);var k=this.get("rxBytesPerSecondIndex"),l=this.get("readTimeIndex");null==k&&(l=e.summaryAttributeIndex("nicList","readTime"),k=e.summaryAttributeIndex("nicList","rxBytesPerSecond"),this.set("readTimeIndex",l),this.set("rxBytesPerSecondIndex",k));for(var m=0,n=0;i>n;n++)m+=h[n][k];i>0&&(m/=i);var o=a.data[0][l],p=this.get("yDomain"),q=this.get("valuesMultiplier"),r=this.computeDomainBounds(m,p[0],p[1],q);(r.domainMin!==p[0]||r.domainMax!==p[1]||r.valuesMultiplier!==q)&&(this.set("yDomain",[r.domainMin,r.domainMax]),this.set("valuesMultiplier",r.valuesMultiplier),c=!0),insertChartValue(j,o,m),b.isTimeVisible(o)&&(c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()}},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)c.hasOwnProperty(d)&&this.isShowGateway(a.findGatewayModelByInstanceKey(d))&&b.push(d);return b},getDataItemValues:function(a){var b=this.get("dataItemValues")[a];return b?b:[]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=minMaxAverageSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){return a===b}},{ATTRS:{title:{value:null},valueType:{value:"byteRate"},showUnits:{value:!0},dataItemValues:{value:{}},rxBytesPerSecondIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("nic-read-thpt-indiv-chart",function(a){"use strict";var b=a.Lang,c="nicReadThptIndivChart";a.NicReadThptIndivChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.NicListModel.prototype.UPDATE_EVENT,b.onNicListUpdate,b)},onNicListUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=a.data,i=h.length;if(0!=i){var j=f[g];if(!j){j=[];for(var k=0;k<h.length;k++)j.push([]);f[g]=j,c=!0}var l=this.get("rxBytesPerSecondIndex"),m=this.get("readTimeIndex");null==l&&(m=e.summaryAttributeIndex("nicList","readTime"),l=e.summaryAttributeIndex("nicList","rxBytesPerSecond"),this.set("readTimeIndex",m),this.set("rxBytesPerSecondIndex",l));for(var n=this.get("yDomain"),o=this.get("valuesMultiplier"),p,q={domainMin:n[0],domainMax:n[1],valuesMultiplier:o},r=a.data[0][m],s=0;i>s;s++)p=h[s][l],q=this.computeDomainBounds(p,q.domainMin,q.domainMax,q.valuesMultiplier),insertChartValue(j[s],r,p),b.isTimeVisible(r)&&(c=!0);(q.domainMin!==n[0]||q.domainMax!==n[1]||q.valuesMultiplier!==o)&&(this.set("yDomain",[q.domainMin,q.domainMax]),this.set("valuesMultiplier",q.valuesMultiplier),c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()}},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)if(c.hasOwnProperty(d)){var e=a.findGatewayModelByInstanceKey(d);if(this.isShowGateway(e))for(var f=e.get("nicListModel"),g=f.get("netInterfaceNames"),h=0;h<g.length;h++)b.push([d,h])}return b},getDataItemValues:function(a){var b=a[0],c=a[1],d=this.get("dataItemValues"),e=d[b];return e?e[c]:[]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=minMaxAverageMultipleSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a[0]);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){var c=a[0]===b[0]&&a[1]===b[1];return c}},{ATTRS:{title:{value:null},valueType:{value:"byteRate"},showUnits:{value:!0},dataItemValues:{value:{}},rxBytesPerSecondIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("nic-rw-thpt-combined-chart",function(a){"use strict";var b=a.Lang,c="nicRWThptCombinedChart";a.NicRWThptCombinedChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.NicListModel.prototype.UPDATE_EVENT,b.onNicListUpdate,b)},onNicListUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=a.data,i=h.length;if(0!=i){var j=f[g];j||(j={read:[],write:[]},f[g]=j,c=!0);var k=this.get("rxBytesPerSecondIndex"),l=this.get("txBytesPerSecondIndex"),m=this.get("readTimeIndex");null==k&&(m=e.summaryAttributeIndex("nicList","readTime"),k=e.summaryAttributeIndex("nicList","rxBytesPerSecond"),l=e.summaryAttributeIndex("nicList","txBytesPerSecond"),this.set("readTimeIndex",m),this.set("rxBytesPerSecondIndex",k),this.set("txBytesPerSecondIndex",l));for(var n=0,o=0,p=0;i>p;p++)n+=h[p][k],o+=h[p][l];i>0&&(n/=i,o/=i);var q=a.data[0][m],r=this.get("yDomain"),s=this.get("valuesMultiplier"),t=this.computeDomainBounds(n,r[0],r[1],s);t=this.computeDomainBounds(o,t.domainMin,t.domainMax,t.valuesMultiplier),(t.domainMin!==r[0]||t.domainMax!==r[1]||t.valuesMultiplier!==s)&&(this.set("yDomain",[t.domainMin,t.domainMax]),this.set("valuesMultiplier",t.valuesMultiplier),c=!0),insertChartValue(j.read,q,n),insertChartValue(j.write,q,o),b.isTimeVisible(q)&&(c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()}},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)c.hasOwnProperty(d)&&this.isShowGateway(a.findGatewayModelByInstanceKey(d))&&b.push([d,"read"],[d,"write"]);return b},getDataItemLineStyle:function(a){return"read"==a[1]?CC.Constants.LineStyle.DASHED:CC.Constants.LineStyle.SOLID},getDataItemValues:function(a){var b=a[0],c=a[1],d=this.get("dataItemValues"),e=d[b];return e?e[c]:[]},computeSummaryHtml:function(){var a=0,b=this.get("dataItemValues"),c=this.get("valuesMultiplier"),d=this.get("dashboard").get("xDomainClip")[1],e={min:0,max:0,total:0,avg:0},f={min:0,max:0,total:0,avg:0};if(b){for(var g in b)b.hasOwnProperty(g)&&(a++,this.computeTotals(e,b[g].read,d,c),this.computeTotals(f,b[g].write,d,c));a>0&&(e.avg=e.total/a,f.avg=f.total/a)}var h='<div class="rwThptSummary">';return h+='<div class="readThpt">R: </div><div class="readThptLine">  <svg>    <line class="readThpt" x1="3" y1="0" x2="40" y2="0"></line>  </svg></div>',h+='<div class="writeThpt">W: </div><div class="writeThptLine">  <svg>    <line class="writeThpt" x1="3" y1="0" x2="40" y2="0"></line>  </svg></div>',h+='<div class="rwThptMaxAverage">  <div class="summaryLabel">Max: </div>  <div class="summaryValue">'+Math.max(e.max,f.max).toFixed(2)+'</div>  <div class="summaryLabel">&nbsp;Avg.: </div>  <div class="summaryValue">'+((e.avg+f.avg)/2).toFixed(2)+"</div></div>",h+="</div>"},computeTotals:function(a,b,c,d){var e=!0,f;if(b.length>0){for(f=b.length-1;f>=0&&!(b[f][0]<c);f--);if(f>=0){var g=b[f][1]/d;e?(a.min=g,a.max=g,e=!1):(a.min=Math.min(a.min,g),a.max=Math.max(a.max,g)),a.total+=g}}},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a[0]);return this.get("dashboard").getColor(b.get("connectionUrl"))},getDataItemClasses:function(a){return"line "+a[1]},dataItemsEqual:function(a,b){var c=a[0]===b[0]&&a[1]===b[1];return c}},{ATTRS:{title:{value:null},valueType:{value:"byteRate"},showUnits:{value:!0},dataItemValues:{value:{}},rxBytesPerSecondIndex:{value:null},txBytesPerSecondIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("nic-write-thpt-combined-chart",function(a){"use strict";var b=a.Lang,c="nicWriteThptCombinedChart";a.NicWriteThptCombinedChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.NicListModel.prototype.UPDATE_EVENT,b.onNicListUpdate,b)},onNicListUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=a.data,i=h.length;if(0!=i){var j=f[g];j||(j=[],f[g]=j,c=!0);var k=this.get("txBytesPerSecondIndex"),l=this.get("readTimeIndex");null==k&&(l=e.summaryAttributeIndex("nicList","readTime"),k=e.summaryAttributeIndex("nicList","txBytesPerSecond"),this.set("readTimeIndex",l),this.set("txBytesPerSecondIndex",k));for(var m=0,n=0;i>n;n++)m+=h[n][k];i>0&&(m/=i);var o=a.data[0][l],p=this.get("yDomain"),q=this.get("valuesMultiplier"),r=this.computeDomainBounds(m,p[0],p[1],q);(r.domainMin!==p[0]||r.domainMax!==p[1]||r.valuesMultiplier!==q)&&(this.set("yDomain",[r.domainMin,r.domainMax]),this.set("valuesMultiplier",r.valuesMultiplier),c=!0),insertChartValue(j,o,m),b.isTimeVisible(o)&&(c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()}},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)c.hasOwnProperty(d)&&this.isShowGateway(a.findGatewayModelByInstanceKey(d))&&b.push(d);return b},getDataItemValues:function(a){var b=this.get("dataItemValues")[a];return b?b:[]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=minMaxAverageSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){return a===b}},{ATTRS:{title:{value:null},valueType:{value:"byteRate"},showUnits:{value:!0},dataItemValues:{value:{}},txBytesPerSecondIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]}),YUI.add("nic-write-thpt-indiv-chart",function(a){"use strict";var b=a.Lang,c="nicWriteThptIndivChart";a.NicWriteThptIndivChart=a.Base.create(c,a.DashboardChart,[],{initializer:function(){var b=this,c=b.get("model");c&&c.addTarget(b),b.on(a.NicListModel.prototype.UPDATE_EVENT,b.onNicListUpdate,b)},onNicListUpdate:function(a){var b=this.get("dashboard"),c=!1,d=a.model,e=d.get("gatewayModel"),f=this.get("dataItemValues"),g=e.get("instanceKey"),h=a.data,i=h.length;if(0!=i){var j=f[g];if(!j){j=[];for(var k=0;k<h.length;k++)j.push([]);f[g]=j,c=!0}var l=this.get("txBytesPerSecondIndex"),m=this.get("readTimeIndex");null==l&&(m=e.summaryAttributeIndex("nicList","readTime"),
l=e.summaryAttributeIndex("nicList","txBytesPerSecond"),this.set("readTimeIndex",m),this.set("txBytesPerSecondIndex",l));for(var n=this.get("yDomain"),o=this.get("valuesMultiplier"),p,q={domainMin:n[0],domainMax:n[1],valuesMultiplier:o},r=a.data[0][m],s=0;i>s;s++)p=h[s][l],q=this.computeDomainBounds(p,q.domainMin,q.domainMax,q.valuesMultiplier),insertChartValue(j[s],r,p),b.isTimeVisible(r)&&(c=!0);(q.domainMin!==n[0]||q.domainMax!==n[1]||q.valuesMultiplier!==o)&&(this.set("yDomain",[q.domainMin,q.domainMax]),this.set("valuesMultiplier",q.valuesMultiplier),c=!0),this.adjustTitle(),this.adjustSummary(),c&&this.drawChart()}},getDataItems:function(){var a=this.get("model"),b=[],c=this.get("dataItemValues");for(var d in c)if(c.hasOwnProperty(d)){var e=a.findGatewayModelByInstanceKey(d);if(this.isShowGateway(e))for(var f=e.get("nicListModel"),g=f.get("netInterfaceNames"),h=0;h<g.length;h++)b.push([d,h])}return b},getDataItemValues:function(a){var b=a[0],c=a[1],d=this.get("dataItemValues"),e=d[b];return e?e[c]:[]},computeSummaryHtml:function(){var a=this.get("dashboard"),b=minMaxAverageMultipleSummaryFn(this.get("dataItemValues"),this.get("valuesMultiplier"),a.get("xDomainClip")[1]);return b},getDataItemColor:function(a){var b=this.get("model").findGatewayModelByInstanceKey(a[0]);return this.get("dashboard").getColor(b.get("connectionUrl"))},dataItemsEqual:function(a,b){var c=a[0]===b[0]&&a[1]===b[1];return c}},{ATTRS:{title:{value:null},valueType:{value:"byteRate"},showUnits:{value:!0},dataItemValues:{value:{}},txBytesPerSecondIndex:{value:null},readTimeIndex:{value:null}}})},"0.99",{requires:["kaazing-view","dashboard-chart","gateway-model"]});