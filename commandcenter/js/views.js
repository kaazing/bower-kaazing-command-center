/**
 * Copyright (c) 2007-2014, Kaazing Corporation. All rights reserved.
*/
function defineJVMView(a){a.JVMView=a.Base.create("jvmView",a.View,[],{events:{"#jvmTable button":{click:"handleGraphButtonClick"},"#jvmTable input[type=button]":{click:"handleGraphButtonClick"}},initializer:function(){var a=this;a.set("container","#jvmInfo");var b=a.get("model");b&&b.addTarget(a);var c=this.get("gatewayView");c.after("modelChange",a.afterGWModelChange,a),a.after("modelChange",a.afterModelChange,a),a.after("modelList:add",a.afterAdd,a)},afterGWModelChange:function(a){if(a.newVal){var b=a.newVal;this.set("model",b.get("jvmContainer"))}else this.set("model",null)},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.render()},afterAdd:function(a){this.render()},render:function(){var a=this.get("model"),b=a?a.getInstance(-1):null,c=this.get("renderFieldMap");for(var d in c){var e=b?b.get(c[d]):"";replaceTextValue("#"+d,e)}return this},handleGraphButtonClick:function(a){var b=a.target.get("id"),c=b.substring(3,b.indexOf("Button"));c=c.substring(0,1).toLowerCase()+c.substring(1);var d=this.get("gatewayView"),e=d.get("graphView");e.setTarget({modelList:this.get("model").getInstanceList(),graphAttributeName:c})}},{ATTRS:{gatewayView:{value:null},renderFieldMap:{value:{jvmGatewayIdValue:"gatewayId",jvmClassesLoadedValue:"classesLoaded",jvmTotalClassesLoadedValue:"totalClassesLoaded",jvmTotalClassesUnloadedValue:"totalClassesUnloaded",jvmThreadingLiveThreadsValue:"threadingLiveThreads",jvmThreadingPeakThreadsValue:"threadingPeakThreads",jvmThreadingTotalThreadsValue:"threadingTotalThreads",jvmMemHeapInitSizeValue:"memHeapInitSize",jvmMemHeapUsedValue:"memHeapUsed",jvmMemHeapCommittedValue:"memHeapCommitted",jvmMemHeapMaxSizeValue:"memHeapMaxSize",jvmMemNonHeapInitSizeValue:"memNonHeapInitSize",jvmMemNonHeapUsedValue:"memNonHeapUsed",jvmMemNonHeapCommittedValue:"memNonHeapCommitted",jvmMemNonHeapMaxSizeValue:"memNonHeapMaxSize"}}}})}YUI.add("cluster-realm-config-view",function(a){"use strict";var b=a.Lang,c="clusterRealmConfigView";a.ClusterRealmConfigView=a.Base.create(c,a.View,[],{initializer:function(){var a=this.get("modelList");a.addTarget(this),this.addRealmConfig(a.item(0)),this.after("modelListChange",this.afterModelChange,this),this.after("showUrlsChange",this.afterShowUrlsChange,this)},addRealmConfig:function(a){var b=this.get("modelList");return b.item(0).equals(a)?(b.add(a),this.addServiceConfigs(a),!0):!1},containsRealmConfig:function(a){var b=this.get("modelList");return b.indexOf(a)>=0},removeRealmConfig:function(a){var b=this.get("modelList");b.remove(a),this.removeServiceConfigs(a)},isEmpty:function(){var a=this.get("modelList");return 0===a.size()},addServiceConfigs:function(b){var c=b.get("serviceConfigs");if(c)for(var d=this.get("clusterServiceConfigViews"),e=null,f=0;f<c.length;f++){for(var g=c[f],h=!1,i=0;i<d.length;i++)if(e=d[i],e.addServiceConfig(g)){h=!0;break}if(!h){var j=new a.ModelList({model:a.ServiceConfigModel});j.add(g),e=new a.ClusterServiceConfigView({modelList:j,clusterModel:this.get("clusterModel"),showUrls:this.get("showUrls"),app:this.get("app")}),d.push(e)}}},removeServiceConfigs:function(a){var b=a.get("serviceConfigs");if(b)for(var c=this.get("clusterServiceConfigViews"),d=null,e=0;e<b.length;e++)for(var f=b[e],g=0;g<c.length;g++)if(d=c[g],d.containsServiceConfig(f)){d.removeServiceConfig(f),d.isEmpty()&&(arrayRemove(c,d),d.destroy());break}},calculateWarnings:function(){for(var a=this.get("clusterServiceConfigViews"),b=0;b<a.length;b++)a[b].calculateWarnings()},destructor:function(){this.destroySubviews()},afterModelListChange:function(a){this.destroySubviews();var b=$this.get("container");removeAllChildren(b),a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.initializeSubviews()},afterShowUrlsChange:function(a){for(var b=this.get("clusterServiceConfigViews"),c=0;c<b.length;c++)b[c].set("showUrls",this.get("showUrls"))},render:function(){var b=this,c=a.one(a.config.doc.createDocumentFragment()),d=this.get("modelList"),e=d.item(0),f=createDIV(c,"graphicRealm"),g=createDIV(f,"graphicRealmTitleDiv"),h=createIMG(g,"../images/castle3.png","graphicRealmImage"),i=createSPAN(g,"Realm: ","graphicRealmTitle"),j=createLINK(g,"javascript:void(0);","graphicRealmTitleName").set("text",e.get("name"));j.on("click",function(a){return function(c){b.get("app").save("/config/security/realms?connectionUrl="+a.get("gatewayModel").get("connectionUrl")+"&realm="+a.get("name"))}}(e));var k=this.get("clusterServiceConfigViews"),l=k.length;if(0===l)var m=createDIV(f,"graphicNoServiceRealm").set("text","No services refer to this realm");else{var n=k.slice();n.sort(function(a,b){var c=a.get("modelList").item(0),d=b.get("modelList").item(0);return c.sortCompare(d)});for(var o=0;l>o;o++){var p=n[o];f.append(p.render().get("container"))}}return this.get("container").setHTML(c),this},sortCompare:function(a){var b=this.get("modelList").item(0),c=a.get("modelList").item(0);return b.sortCompare(c)},destroySubviews:function(){var a=this.get("clusterServiceConfigViews"),b;for(b=0;b<a.length;b++){var c=a[b];c.destroy()}this.set("clusterServiceConfigViews",[])}},{ATTRS:{container:{value:null},app:{value:null},clusterModel:{value:null},modelList:{value:null},clusterServiceConfigViews:{value:[]},showUrls:{value:!1}}})},"0.99",{requires:["view","cluster-model","gateway-model","realm-config-model"]}),YUI.add("cluster-service-config-view",function(a){"use strict";var b=a.Lang,c="clusterServiceConfigView";a.ClusterServiceConfigView=a.Base.create(c,a.View,[],{initializer:function(){var b=this,c=b.get("modelList");c.addTarget(b),b.after("showUrlsChange",b.afterShowUrlsChange,b);var d=new a.GatewayServiceConfigView({model:c.item(0),showUrls:this.get("showUrls"),app:this.get("app")});d.addTarget(this),this.set("serviceConfigView",d)},addServiceConfig:function(a){var b=this.get("modelList");return b.item(0).equals(a)?(b.add(a),!0):!1},containsServiceConfig:function(a){var b=this.get("modelList");return b.indexOf(a)>=0},removeServiceConfig:function(a){var b=this.get("modelList");b.remove(a)},isEmpty:function(){var a=this.get("modelList");return 0===a.size()},destructor:function(){this.get("serviceConfigView").destroy(),this.set("serviceConfigView",null)},afterShowUrlsChange:function(a){this.get("serviceConfigView").set("showUrls",this.get("showUrls"))},calculateWarnings:function(){var a=this.getNumRelevantGateways(),b=this.get("modelList").size();if(this.get("serviceConfigView").set("warning",b===a?null:"This service is configured in only "+b+" of "+a+" cluster members"),b>a)var c=0},getNumRelevantGateways:function(){var a=this.get("clusterModel").getGateways(),b=0;return a&&a.forEach(function(a){a.get("stopTime")||(!a.isManaged()||a.isUsable())&&b++}),b},render:function(){var b=a.one(a.config.doc.createDocumentFragment()),c=this.get("serviceConfigView"),d=c.render().get("container");return b.append(d),this.get("container").setHTML(b),this},sortCompare:function(a){var b=this.get("modelList").item(0),c=a.get("modelList").item(0);return b.sortCompare(c)}},{ATTRS:{container:{value:null},app:{value:null},clusterModel:{value:null},modelList:{value:null},serviceConfigView:{value:null},showUrls:{value:!1}}})},"0.99",{requires:["view","cluster-model"]}),YUI.add("config-overview-view",function(a){"use strict";var b=a.Lang,c="configOverviewView",d="Hide URLs",e="Show URLs";a.ConfigOverviewView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this},doDisplaySetup:function(){this.setupToolbar(),a.one("#legend").removeClass("hidden"),this.get("firstTime")&&(this.after("showUrlsChange",this.afterShowUrlsChange,this),this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this),this.initializeSubviews(),this.set("firstTime",!1))},setupToolbar:function(){var a=this.get("toolbar"),b=this.get("showUrls"),c=createBUTTON(a,e,"toolbarButton").set("id","configOverviewShowUrls"),f=c.getStyle("width");c.setHTML("<span>"+(b?d:e)+"</span>"),c.setStyle("width",f),c.on("click",this.toggleShowUrls,this)},initializeSubviews:function(){var a=this.get("model"),b=a.getGateways();if(b&&b.length>0)for(var c=0;c<b.length;c++)this.addGatewayInstance(b[c])},destructor:function(){this.destroySubviews()},afterModelChange:function(a){this.destroySubviews(),a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.initializeSubviews(),this.render()},onGatewayAvailable:function(a){this.addGatewayInstance(a.gatewayModel)},afterStopTimeChange:function(a){this.removeGatewayInstance(a.target)},addGatewayInstance:function(b){var c=this.get("model");if(b.isUsable()){var d=b.get("gatewayConfig"),e=d.get("securityConfig"),f=e&&e.get("realmConfigs"),g,h,i;if(f){var j=this.get("clusterRealmConfigViews"),k=null;for(var l in f)if(f.hasOwnProperty(l)){var m=f[l],n=!1;for(g=0;g<j.length;g++)if(k=j[g],k.addRealmConfig(m)){n=!0;break}if(!n){var o=new a.ModelList({model:a.RealmConfigModel});o.add(m),k=new a.ClusterRealmConfigView({clusterModel:c,modelList:o,showUrls:this.get("showUrls"),app:this.get("app")});var p=!1;for(g=0;g<j.length;g++){var q=j[g];if(k.sortCompare(q)<0){j.splice(g,0,k),p=!0;break}}p||j.push(k)}}}var r=d.get("serviceConfigs"),s=[],t,u;for(g=0;g<r.length;g++)t=r[g],u=t.get("realm"),u||s.push(t);var v=s.length;if(v>0){var w=this.get("clusterNoRealmServiceConfigViews"),x=null;for(g=0;v>g;g++){t=s[g];var n=!1;for(h=0;h<w.length;h++){var y=w[h];if(y.addServiceConfig(t)){n=!0;break}}if(!n){var o=new a.ModelList({model:a.ServiceConfigModel});o.add(t),x=new a.ClusterServiceConfigView({clusterModel:c,modelList:o,showUrls:this.get("showUrls"),app:this.get("app")});var p=!1;for(h=0;h<w.length;h++){var z=w[h],A=x.sortCompare(z);if(0>A){w.splice(h,0,x),p=!0;break}}p||w.push(x)}}}}this.calculateWarnings(),this.render()},removeGatewayInstance:function(a){var b=this.get("model"),c=a.get("gatewayConfig");if(c){var d=c.get("securityConfig"),e=d&&d.get("realmConfigs"),f,g,h;if(e){var i=this.get("clusterRealmConfigViews");for(var j in e)if(e.hasOwnProperty(j)){var k=e[j];for(f=0;f<i.length;f++){var l=i[f];if(l.containsRealmConfig(k)){l.removeRealmConfig(k),l.isEmpty()&&(arrayRemove(i,l),l.destroy());break}}}}var m=c.get("serviceConfigs"),n=this.get("clusterNoRealmServiceConfigViews");for(f=0;f<m.length;f++){var o=m[f];if(!o.get("realm"))for(g=0;g<n.length;g++){var p=n[g];if(p.containsServiceConfig(o)){p.removeServiceConfig(o),p.isEmpty()&&(arrayRemove(n,p),p.destroy());break}}}}this.calculateWarnings(),this.render()},calculateWarnings:function(){for(var a=this.get("clusterRealmConfigViews"),b=0;b<a.length;b++)a[b].calculateWarnings();for(var c=this.get("clusterNoRealmServiceConfigViews"),b=0;b<c.length;b++)c[b].calculateWarnings()},afterShowUrlsChange:function(a){for(var b=this.get("showUrls"),c=this.get("clusterRealmConfigViews"),d=0;d<c.length;d++)c[d].set("showUrls",b);for(var e=this.get("clusterNoRealmServiceConfigViews"),d=0;d<e.length;d++)e[d].set("showUrls",b)},render:function(){for(var b=this.get("container").one("#configOverviewRealmData"),c=a.one(a.config.doc.createDocumentFragment()),d=this.get("clusterRealmConfigViews"),e=0;e<d.length;e++)c.append(d[e].render().get("container"));b.setHTML(c);var f=this.get("container").one("#configOverviewNoRealmData");c=a.one(a.config.doc.createDocumentFragment());for(var g=this.get("clusterNoRealmServiceConfigViews"),e=0;e<g.length;e++)c.append(g[e].render().get("container"));return f.setHTML(c),this},toggleShowUrls:function(a){var b=!this.get("showUrls");this.set("showUrls",b),a.target.setHTML("<span>"+(b?d:e)+"</span>")},destroySubviews:function(){var a=this.get("clusterRealmConfigViews"),b;for(b=0;b<a.length;b++){var c=a[b];c.destroy()}this.set("clusterRealmConfigViews",[]);var d=this.get("clusterNoRealmServiceConfigViews");for(b=0;b<d.length;b++){var e=d[b];e.destroy()}this.set("clusterNoRealmServiceConfigViews",[])}},{ATTRS:{container:{valueFn:function(){return a.one("#configOverviewContainer")}},title:{value:"Configuration : Overview"},clusterRealmConfigViews:{value:[]},clusterNoRealmServiceConfigViews:{value:[]},showUrls:{value:!0},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","cluster-model"]}),YUI.add("config-security-keystore-view",function(a){"use strict";var b=a.Lang,c="configSecurityKeystoreView",d=["alias","issuer","notValidBefore","notValidAfter","subject","subjectAlternativeNames","pathConstraint","selfSigned","signatureAlgorithm"],e=["Alias","Issuer","Not Valid Before","Not Valid After","Subject","Subject Alternative Names","Certificate Authority?","Self Signed?","Signature Algorithm"];a.ConfigSecurityKeystoreView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this},doDisplaySetup:function(){this.get("firstTime")&&(this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this),this.set("firstTime",!1)),this.updateClusterKeystores(),this.render()},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.updateClusterKeystores(),this.render()},onGatewayAvailable:function(a){this.updateClusterKeystores(),this.render()},afterStopTimeChange:function(a){this.updateClusterKeystores(),this.render()},updateClusterKeystores:function(){var a=this.buildKeystoreList();this.set("clusterSecurityConfigs",a)},buildKeystoreList:function(){var a=[],b,c,d=this.get("model").getUsableGateways();if(d&&d.length>0){for(b=0;b<d.length;b++){var e=d[b],f=e.get("gatewayConfig"),g=f.get("securityConfig");if(g){var h=!1;for(c=0;c<a.length;c++){var i=a[c];if(g.equalsKeystoreInfo(i[0])){h=!0,i.push(g);break}}h||a.push([g])}}a.sort(function(a,b){var c=a[0],d=b[0];return c.sortCompareKeystore(d)})}return a},render:function(){return this.isActiveView()&&(removeAllChildren(this.get("container").one("#configSecurityKeystoreData")),this.renderData()),this},renderData:function(){var b=this,c=this.get("container"),f=c.one("#configSecurityKeystoreData"),g=this.get("clusterSecurityConfigs");if(removeAllChildren(f),g&&0!=g.length){for(var h=a.one(a.config.doc.createDocumentFragment()),i=0;i<g.length;i++){for(var j=createDIV(h,"configSecuritySection"),k=g[i],l=k[0],m=createH(j,3).setHTML("Keystore"),n=createTABLE(j),o=[],p,q=0;q<k.length;q++)l=k[q],p=l.get("gatewayModel"),-1==o.indexOf(p)&&o.push(p);var r=o.map(function(a,b,c){return a.get("gatewayLabel")}).sort().join(", ");this.possiblyCreateDetailTableRow(n,"Defined In:",r),this.possiblyCreateDetailTableRow(n,"Type:",l.get("keystoreType"));var s=l.get("keystoreCertificateInfo");if(s&&s.length>0){var t=a.one(a.config.doc.createDocumentFragment()),u=createDIV(t),v=s.map(function(a,b,c){return this.extractCertInfo(a)},b);v.sort(function(a,b){var c=a[d[0]],e=b[d[0]];return e>c?-1:c>e?1:0});for(var q=0;q<v.length;q++){var w=createTABLE(t,"configDataTable");w.set("id","configSecurityCertificateTable");for(var x=v[q],y=0;y<d.length;y++){var z=null,A=d[y],B=e[y],C=x[A];if(0==y)z="configSecurityCertificateAlias";else if("issuer"===A)null!==C&&void 0!=C&&(C=C.split(",").join("<BR>")),z="configSecurityCertificateIssuer";else if("subject"===A){if(null!==C&&void 0!=C){C=C.split(",");for(var D=0;D<C.length;D++)C[D].startsWith("CN=")&&(C[D]="<b>"+C[D]+"</b>");C=C.join("<BR>")}z="configSecurityCertificateSubject"}else if("subjectAlternativeNames"===A)C||(C="&nbsp;");else if(!C||"notValidBefore"!==A&&"notValidAfter"!==A)"pathConstraint"===A?C=-1===C?"NO":x.issuer&&x.issuer===x.subject?"Root CA":"Intermediate CA":"selfSigned"===A&&(C=x.issuer&&x.issuer===x.subject?"Yes":"No");else{var E=new Date(C);C=E.toUTCString()}this.possiblyCreateCertificateRow(w,B,C,z)}}this.possiblyCreateDetailTableRow(n,"Certificates:",t)}}return f.setHTML(h),this}},possiblyCreateDetailTableRow:function(a,b,c){if(!isEmptyValue(c)){var d=createTR(a),e=createTD(d,"configSecurityDetailLabel").set("text",b);e=createTD(d,"securityDataValue").setHTML(c)}},extractCertInfo:function(a){var b={};for(var c in a)d.indexOf(c)>=0&&(b[c]=a[c]);return b},possiblyCreateCertificateRow:function(a,b,c,d){if(!isEmptyValue(c)){var e=createTR(a),f=createTD(e,"securityDataValue").set("text",b).addClass("configSecurityCertificateLabel");f=createTD(e,"securityDataValue").setHTML(c),d&&f.addClass(d)}}},{ATTRS:{container:{valueFn:function(){return a.one("#configSecurityKeystoreViewContainer")}},title:{value:"Configuration : Security : Keystores"},clusterSecurityConfigs:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","security-config-model"]}),YUI.add("config-security-realms-view",function(a){"use strict";var b=a.Lang,c="configSecurityRealmsView";a.ConfigSecurityRealmsView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this},doDisplaySetup:function(){this.get("firstTime")&&(this.after("selectedRealmConfigChange",this.afterSelectedRealmConfigChange,this),this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this),this.updateClusterRealmConfigs(),this.set("firstTime",!1)),this.render()},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.updateClusterRealmConfigs(),this.render()},onGatewayAvailable:function(a){this.updateClusterRealmConfigs(),this.render()},afterStopTimeChange:function(a){this.updateClusterRealmConfigs(),this.render()},afterSelectedRealmConfigChange:function(a){this.render()},updateClusterRealmConfigs:function(){var a=this.buildRealmConfigList();this.set("clusterRealmConfigs",a)},buildRealmConfigList:function(){var a=[],b,c,d,e=this.get("model").getUsableGateways();if(e&&e.length>0){for(b=0;b<e.length;b++){var f=e[b],g=f.get("gatewayConfig"),h=g.get("securityConfig");if(h){var i=h.get("realmConfigs");if(i)for(d in i)if(i.hasOwnProperty(d)){var j=i[d],k=!1;for(c=0;c<a.length;c++){var l=a[c];if(j.equals(l[0])){k=!0,l.push(j);break}}k||a.push([j])}}}a.sort(function(a,b){var c=a[0],d=b[0];return c.sortCompare(d)})}return a},render:function(){return this.isActiveView()&&(removeAllChildren(this.get("container").one("#configSecurityRealmsData")),this.renderToolbar(),this.renderData()),this},renderToolbar:function(){var a=this,b=this.get("clusterRealmConfigs"),c=this.get("toolbar");removeAllChildren(c);var d=createSELECT(c,"toolbarSelect"),e=createOPTION(d,null,"Select a realm...").set("selected",!1);if(b&&b.length>0){b.sort(function(a,b){var c=a[0].get("name").toLowerCase(),d=b[0].get("name").toLowerCase();return c==d?0:d>c?-1:1});for(var f=this.get("selectedRealmConfig"),g=0;g<b.length;g++){var h=b[g],i=h[0],j=i.get("name");e=createOPTION(d,null,j),i.equals(f)&&e.set("selected",!0)}d.after("change",function(b){var c=b.target,d=c.get("selectedIndex");if(0>=d)return void(null!==a.get("selectedRealmConfig")&&a.set("selectedRealmConfig",null));var e=null,f=a.get("clusterRealmConfigs");if(f&&f.length>=d){var g=f[d-1];g.length>0&&(e=g[0])}a.get("selectedRealmConfig")!==e&&a.set("selectedRealmConfig",e)})}else null!==this.get("selectedRealmConfig")&&this.set("selectedRealmConfig",null)},renderData:function(){var b=this.get("container"),c=b.one("#configSecurityRealmsData");removeAllChildren(c);var d=this.get("selectedRealmConfig");if(d){for(var e=this,f=a.one(a.config.doc.createDocumentFragment()),g=createDIV(f,"configSecuritySection"),h=createH(g,3).setHTML('Realm: <SPAN class="configSecurityRealmName">'+d.get("name")+"</SPAN>"),i=createTABLE(g,"configSecurityRealmTable"),j=this.get("clusterRealmConfigs"),k,l=0;l<j.length&&(k=j[l],!(k.indexOf(d)>=0));l++);for(var m=[],l=0;l<k.length;l++){var n=k[l],o=n.get("serviceConfigs");if(o)for(var p=0;p<o.length;p++){for(var q=o[p],r=!1,s=0;s<m.length;s++){var t=m[s];if(q.equals(t[0])){t.push(q);break}}r||m.push([q])}}var u="";if(m.length>0){m.sort(function(a,b){var c=a[0].get("label").toLowerCase(),d=b[0].get("label").toLowerCase();return d>c?-1:c===d?0:1});for(var l=0;l<m.length;l++){var q=m[l][0];l>0&&(u+=", "),u+='<A href="javascript:void(0);" class="serviceLink" index="'+l+'">'+q.get("label")+"</A>"}}i.delegate("click",e.handleServiceLink,".serviceLink",e,m);for(var v=[],w,p=0;p<k.length;p++)w=k[p].get("gatewayModel"),-1==v.indexOf(w)&&v.push(w);var x=v.map(function(a,b,c){return a.get("gatewayLabel")}).sort().join(", ");this.possiblyCreateDetailTableRow(i,"Defined In:",x),this.possiblyCreateDetailTableRow(i,"Used In Services:",u),this.possiblyCreateDetailTableRow(i,"Description:",d.get("description")),this.possiblyCreateDetailTableRow(i,"Authorization Mode:",d.get("authorizationMode")),this.possiblyCreateDetailTableRow(i,"HTTP Challenge Scheme:",d.get("httpChallengeScheme")),this.possiblyCreateDetailTableRow(i,"Session Timeout:",d.get("sessionTimeout"));var y=d.get("httpCookieNames"),z=y?y.sort().join(",<br>"):"";this.possiblyCreateDetailTableRow(i,"HTTP Cookie Names:",z);var A=d.get("httpHeaders"),B=A?A.sort().join(",<br>"):"";this.possiblyCreateDetailTableRow(i,"HTTP Headers:",B);var C=d.get("httpQueryParams"),D=C?C.sort().join(",<br>"):"";this.possiblyCreateDetailTableRow(i,"HTTP Query Parameters:",D);var E=d.get("userPrincipalClasses"),F=E?E.sort().join("<br>"):"";this.possiblyCreateDetailTableRow(i,"User Principal Classes:",F);var G=d.get("loginModules");if(G&&G.length>0){var H=a.one(a.config.doc.createDocumentFragment()),I=createTABLE(H,"configDataTable");I.set("id","configSecurityLoginModuleTable");var J=createTR(I),K=createTH(J,"configSecurityLoginModuleType").set("text","Type");K=createTH(J,"configSecurityLoginModuleSuccess").set("text","Success"),K=createTH(J).set("text","Options");for(var p=0;p<G.length;p++){var L="",M=G[p],N=M.type;N.startsWith("org.kaazing.gateway.security.auth.")&&(N=N.substring(N.lastIndexOf(".")+1),N.endsWith("LoginModule")&&(N=N.substring(0,N.indexOf("LoginModule")),N=N.toLowerCase()));var O=M.options,P="";if(O&&!isEmptyObject(O))for(var Q in O)O.hasOwnProperty(Q)&&(""!==P&&(P+="<br>"),P+="<b>"+Q+": </b>"+O[Q]);this.createLoginModuleRow(I,N,M.success,P)}this.possiblyCreateDetailTableRow(i,"Login Modules:",H)}return c.setHTML(f),this}},possiblyCreateDetailTableRow:function(b,c,d){if(!isEmptyValue(d)){var e=createTR(b),f=createTD(e,"configSecurityDetailLabel").setHTML(a.Escape.html(c));f=createTD(e,"securityDataValue").setHTML(d)}},createLoginModuleRow:function(a,b,c,d){var e=createTR(a),f=createTD(e,"securityDataValue").set("text",b).addClass("configSecurityLoginModuleType");f=createTD(e,"securityDataValue").set("text",c).addClass("configSecurityLoginModuleSuccess"),f=createTD(e,"securityDataValue").setHTML(d)},handleServiceLink:function(a,b){var c=a.target,d=c.getAttribute("index"),e=b[d],f=e[0],g=f.get("gatewayModel"),h=g.get("connectionUrl"),i=f.get("serviceId");a.halt(!0),this.get("app").save("/config/services?connectionUrl="+h+"&serviceId="+i)}},{ATTRS:{container:{valueFn:function(){return a.one("#configSecurityRealmsViewContainer")}},title:{value:"Configuration : Security : Realms"},toolbar:{value:null},clusterRealmConfigs:{value:null},selectedRealmConfig:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","security-config-model"]}),YUI.add("config-security-truststore-view",function(a){"use strict";var b=a.Lang,c="configSecurityTruststoreView",d=["alias","issuer","notValidBefore","notValidAfter","subject","subjectAlternativeNames","pathConstraint","selfSigned","signatureAlgorithm"],e=["Alias","Issuer","Not Valid Before","Not Valid After","Subject","Subject Alternative Names","Certificate Authority?","Self Signed?","Signature Algorithm"];a.ConfigSecurityTruststoreView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this},doDisplaySetup:function(){this.get("firstTime")&&(this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this),this.updateClusterTruststores(),this.set("firstTime",!1)),this.render()},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.updateClusterTruststores(),this.render()},onGatewayAvailable:function(a){this.updateClusterTruststores(),this.render()},afterStopTimeChange:function(a){this.updateClusterTruststores(),this.render()},updateClusterTruststores:function(){var a=this.buildTruststoreList();this.set("clusterSecurityConfigs",a)},buildTruststoreList:function(){var a=[],b,c,d=this.get("model").getUsableGateways();if(d&&d.length>0){for(b=0;b<d.length;b++){var e=d[b],f=e.get("gatewayConfig"),g=f.get("securityConfig");if(g){var h=!1;for(c=0;c<a.length;c++){var i=a[c];if(g.equalsTruststoreInfo(i[0])){h=!0,i.push(g);break}}h||a.push([g])}}a.sort(function(a,b){var c=a[0],d=b[0];return c.sortCompareTruststore(d)})}return a},render:function(){return this.isActiveView()&&(removeAllChildren(this.get("container").one("#configSecurityTruststoreData")),this.renderData()),this},renderData:function(){var b=this,c=this.get("container"),f=c.one("#configSecurityTruststoreData"),g=this.get("clusterSecurityConfigs");if(removeAllChildren(f),g&&0!=g.length){for(var h=a.one(a.config.doc.createDocumentFragment()),i=0;i<g.length;i++){for(var j=createDIV(h,"configSecuritySection"),k=g[i],l=k[0],m=createH(j,3).setHTML("Truststore"),n=createTABLE(j),o=[],p,q=0;q<k.length;q++)l=k[q],p=l.get("gatewayModel"),-1==o.indexOf(p)&&o.push(p);var r=o.map(function(a,b,c){return a.get("gatewayLabel")}).sort().join(", ");this.possiblyCreateDetailTableRow(n,"Defined In:",r),this.possiblyCreateDetailTableRow(n,"Type:",l.get("truststoreType"));var s=l.get("truststoreCertificateInfo");if(s&&s.length>0){var t=a.one(a.config.doc.createDocumentFragment()),u=createDIV(t),v=s.map(function(a,b,c){return this.extractCertInfo(a)},b);v.sort(function(a,b){var c=a[d[0]],e=b[d[0]];return e>c?-1:c>e?1:0});for(var q=0;q<v.length;q++){var w=createTABLE(t,"configDataTable");w.set("id","configSecurityCertificateTable");for(var x=v[q],y=0;y<d.length;y++){var z=null,A=d[y],B=e[y],C=x[A];if(0==y)z="configSecurityCertificateAlias";else if("issuer"===A)null!==C&&void 0!=C&&(C=C.split(",").join("<BR>")),z="configSecurityCertificateIssuer";else if("subject"===A){if(null!==C&&void 0!=C){C=C.split(",");for(var D=0;D<C.length;D++)C[D].startsWith("CN=")&&(C[D]="<b>"+C[D]+"</b>");C=C.join("<BR>")}z="configSecurityCertificateSubject"}else if("subjectAlternativeNames"===A)C||(C="&nbsp;");else if(!C||"notValidBefore"!==A&&"notValidAfter"!==A)"pathConstraint"===A?C=-1===C?"NO":x.issuer&&x.issuer===x.subject?"Root CA":"Intermediate CA":"selfSigned"===A&&(C=x.issuer&&x.issuer===x.subject?"Yes":"No");else{var E=new Date(C);C=E.toUTCString()}this.possiblyCreateCertificateRow(w,B,C,z)}}this.possiblyCreateDetailTableRow(n,"Certificates:",t)}}f.setHTML(h);var F=f.all(".configDataTable");if(F){var G=0;F.each(function(a){var b=parseInt(a.getStyle("width"));b>G&&(G=b)}),G>800&&(G=800),F.each(function(a){a.setStyle("width",G)})}return this}},possiblyCreateDetailTableRow:function(a,b,c){if(!isEmptyValue(c)){var d=createTR(a),e=createTD(d,"configSecurityDetailLabel").set("text",b);e=createTD(d,"securityDataValue").setHTML(c)}},extractCertInfo:function(a){var b={};for(var c in a)d.indexOf(c)>=0&&(b[c]=a[c]);return b},possiblyCreateCertificateRow:function(a,b,c,d){if(!isEmptyValue(c)){var e=createTR(a),f=createTD(e,"securityDataValue").set("text",b).addClass("configSecurityCertificateLabel");f=createTD(e,"securityDataValue").setHTML(c),d&&f.addClass(d)}}},{ATTRS:{container:{valueFn:function(){return a.one("#configSecurityTruststoreViewContainer")}},title:{value:"Configuration : Security : Truststores"},clusterSecurityConfigs:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","security-config-model"]}),YUI.add("config-service-defaults-view",function(a){"use strict";var b=a.Lang,c="configServiceDefaultsView";a.ConfigServiceDefaultsView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this},doDisplaySetup:function(){if(this.get("firstTime")&&(this.after("selectedGatewayChange",this.afterSelectedGatewayChange,this),this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this),this.set("firstTime",!1)),this.isCluster())this.renderSelector();else{var b=this.get("model").getUsableGateways();this.set("selectedGateway",b[0].get("instanceKey"))}},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.render()},onGatewayAvailable:function(a){var b=a.gatewayModel;this.isCluster()?this.render():this.set("selectedGateway",b.get("instanceKey"))},afterStopTimeChange:function(a){var b=a.target;b.get("instanceKey")===this.get("selectedGateway")?this.set("selectedGateway",null):this.render()},afterSelectedGatewayChange:function(a){this.render()},render:function(){return this.isActiveView()&&(removeAllChildren(this.get("container").one("#configServiceDefaultsData")),this.renderSelector(),this.renderData()),this},renderSelector:function(){var a=this;if(this.isActiveView()){var b=this.get("toolbar"),c=b.one("#configServiceDefaultsGatewaySelector");if(!this.isCluster())return void(c&&b.remove(c,!0));var d=this.get("selectedGateway"),e=this.get("model").getUsableGateways();e&&e.sort(function(a,b){return compareStrings(a.get("gatewayLabel").toLowerCase(),b.get("gatewayLabel").toLowerCase())}),c?(c.on("change",null),removeAllChildren(c)):c=createSELECT(b).set("id","configServiceDefaultsGatewaySelector");var f=createOPTION(c,null,"Select a Cluster Member...").set("selected",!1);if(!e)return void this.set("selectedGateway",null);for(var g=0;g<e.length;g++){var h=e[g],i=h.get("gatewayLabel"),j=h.get("instanceKey");f=createOPTION(c,null,i,j),j===d&&f.set("selected",!0)}c.on("change",function(b){var c=b.target,d=c.get("selectedIndex");if(0>=d)return void a.set("selectedGateway",null);var e=c.get("options").item(d).get("value");a.set("selectedGateway",e)})}},renderData:function(){var a=this.get("container"),b=this.get("selectedGateway");if(b){var c=this.get("model").findGatewayModelByInstanceKey(b),d=c&&c.get("gatewayConfig"),e=d&&d.get("serviceDefaultsConfig"),f=e&&e.get("acceptOptions");
this.renderAcceptOptions(a,f);var g=e&&e.get("mimeMappings");this.renderMimeMappings(a,g);var h=void 0!==d&&null!==d&&(void 0===f||null===f||isEmptyObject(f))&&(void 0===g||null===g||isEmptyObject(g));return this.renderNoDataMessage(a,h),this}},renderNoDataMessage:function(a,b){var c=a.one("#configServiceDefaultsData"),d=c.one("#configServiceDefaultsNoDataSection");if(!d){var e=this.isCluster()?"No service defaults have been specified for this cluster member.":"No service defaults have been specified for this gateway.";d=createDIV(c,"configServiceDefaultsSection").set("id","configServiceDefaultsNoDataSection").set("text",e)}b?d.removeClass("hidden"):d.addClass("hidden")},renderAcceptOptions:function(b,c){var d=b.one("#configServiceDefaultsData"),e=d.one("#configServiceDefaultsAcceptOptionsSection");if(!e){e=createDIV(d,"configServiceDefaultsSection").set("id","configServiceDefaultsAcceptOptionsSection");var f=createH(e,3).set("text","Accept Options"),g=createTABLE(e,"configDataTable").set("id","configServiceDefaultsAcceptOptions")}var h=d.one("#configServiceDefaultsAcceptOptions");if(removeAllChildren(h),!c||isEmptyObject(c))return void e.addClass("hidden");e.removeClass("hidden");for(var i,j,k=getSortedKeys(c),l=0;l<k.length;l++){var m=k[l],n=c[m],o=typeOf(n);if("array"===o){for(var p="",q=0;q<n.length;q++)q>0&&(p+="<br>"),p+=a.Escape.html(n[q]);n=p}else n=a.Escape.html(n);i=createTR(h),j=createTD(i,"configServiceDefaultsDataLabel").set("text",m),j=createTD(i,"serviceDefaultsDataValue").setHTML(n)}},renderMimeMappings:function(a,b){var c=a.one("#configServiceDefaultsData"),d=c.one("#configServiceDefaultsMimeMappingsSection");if(!d){d=createDIV(c,"configServiceDefaultsSection").set("id","configServiceDefaultsMimeMappingsSection");var e=createH(d,3).set("text","MIME Mappings"),f=createTABLE(d,"configDataTable").set("id","configServiceDefaultsMimeMappings")}var g=c.one("#configServiceDefaultsMimeMappings");if(removeAllChildren(g),void 0===b||null===b||isEmptyObject(b))return void d.addClass("hidden");d.removeClass("hidden");var h,i,j,k;j=createTHEAD(g),k=createTH(j,"configServiceDefaultsDataLabel").set("text","Extension"),k=createTH(j,"configServiceDefaultsDataLabel").set("text","MIME Type");for(var l=getSortedKeys(b),m=0;m<l.length;m++){var n=l[m],o=b[n];h=createTR(g),i=createTD(h,"configServiceDefaultsDataLabel").set("text",n),i=createTD(h,"serviceDefaultsDataValue").set("text",o)}}},{ATTRS:{container:{valueFn:function(){return a.one("#configServiceDefaultsContainer")}},title:{value:"Configuration : Service Defaults"},selectedGateway:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","service-defaults-config-model"]}),YUI.add("config-services-view",function(a){"use strict";var b=a.Lang,c="configServicesView";a.ConfigServicesView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this},doDisplaySetup:function(){this.get("firstTime")&&(this.after("selectedServiceConfigChange",this.afterSelectedServiceConfigChange,this),this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this),this.updateClusterServiceConfigs(),this.set("firstTime",!1)),this.render()},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.updateClusterServiceConfigs(),this.render()},onGatewayAvailable:function(a){this.updateClusterServiceConfigs(),this.render()},afterStopTimeChange:function(a){this.updateClusterServiceConfigs(),this.render()},afterSelectedServiceConfigChange:function(a){this.render()},updateClusterServiceConfigs:function(){var a=this.buildServiceConfigList();this.set("clusterServiceConfigs",a)},buildServiceConfigList:function(){var a=[],b,c,d,e=this.get("model").getUsableGateways();if(e&&e.length>0){for(b=0;b<e.length;b++){var f=e[b],g=f.get("gatewayConfig"),h=g.get("serviceConfigs");h&&h.forEach(function(b){var c=!1;for(d=0;d<a.length;d++){var e=a[d];if(b.equals(e[0])){c=!0,e.push(b);break}}c||a.push([b])})}a.sort(function(a,b){var c=a[0],d=b[0];return c.sortCompare(d)})}return a},render:function(){return this.isActiveView()&&(removeAllChildren(this.get("container").one("#configServicesData")),this.renderToolbar(),this.renderData()),this},renderToolbar:function(){var a=this,b=this.get("clusterServiceConfigs"),c=this.get("toolbar");removeAllChildren(c);var d=createSELECT(c,"toolbarSelect"),e=createOPTION(d,null,"Select a service...").set("selected",!1);if(b&&b.length>0){b.sort(function(a,b){var c=a[0].get("label").toLowerCase(),d=b[0].get("label").toLowerCase();return c==d?0:d>c?-1:1});for(var f=this.get("selectedServiceConfig"),g=0;g<b.length;g++){var h=b[g],i=h[0],j=i.get("label");e=createOPTION(d,null,j),i.equals(f)&&e.set("selected",!0)}d.after("change",function(b){var c=b.target,d=c.get("selectedIndex");if(0>=d)return void(null!==a.get("selectedServiceConfig")&&a.set("selectedServiceConfig",null));var e=null,f=a.get("clusterServiceConfigs");if(f&&f.length>=d){var g=f[d-1];g.length>0&&(e=g[0])}a.get("selectedServiceConfig")!==e&&a.set("selectedServiceConfig",e)})}else null!==this.get("selectedServiceConfig")&&this.set("selectedServiceConfig",null)},renderData:function(){var b=this.get("container"),c=b.one("#configServicesData");removeAllChildren(c);var d=this.get("selectedServiceConfig");if(d){var e=a.one(a.config.doc.createDocumentFragment());return e.append(this.renderDetails(d)),e.append(this.renderAcceptData(d)),e.append(this.renderCrossSiteConstraints(d)),e.append(this.renderConnectData(d)),e.append(this.renderProperties(d)),e.append(this.renderAuthorizationConstraints(d)),e.append(this.renderMimeMappings(d)),c.append(e),this}},renderDetails:function(b){for(var c=this,d=a.one(a.config.doc.createDocumentFragment()),e=createDIV(d,"configServicesSection"),f=createH(e,3).setHTML('Service: <SPAN class="configServicesServiceName">'+b.get("label")+"</SPAN>"),g=createTABLE(e),h=this.get("clusterServiceConfigs"),i,j=0;j<h.length&&(i=h[j],!i[0].equals(b));j++);for(var k=[],l,j=0;j<i.length;j++)l=i[j].get("gatewayModel"),-1==k.indexOf(l)&&k.push(l);var m=k.map(function(a,b,c){return a.get("gatewayLabel")}).sort().join(", "),n=createTR(g),o=createTD(n,"configServicesDetailLabel").set("text","Defined In:");o=createTD(n,"servicesDataValue").setHTML(this.createValueHtml(m)),n=createTR(g),o=createTD(n,"configServicesDetailLabel").set("text","Type:"),o=createTD(n,"servicesDataValue").setHTML(this.createValueHtml(b.get("type"))),n=createTR(g),o=createTD(n,"configServicesDetailLabel").set("text","Security Realm:");var p=b.get("realm");if(o=createTD(n,"servicesDataValue"),p){var l=b.get("gatewayModel"),q=createLINK(o,"javascript:void(0)").setHTML(this.createValueHtml(p.get("name")));q.on("click",function(a,b){return function(d){d.halt(!0),c.get("app").save("/config/security/realms?connectionUrl="+a+"&realm="+b)}}(l.get("connectionUrl"),p.get("name")))}else o.setHTML(this.createValueHtml("<none>"));return d},renderAcceptData:function(b){var c=this,d=b&&b.get("accepts"),e=b&&b.get("acceptOptions"),f=!isEmptyValue(d),g=!isEmptyValue(e);if(f||g){var h=a.one(a.config.doc.createDocumentFragment()),i=createDIV(h,"configServicesSection"),j=createH(i,3).set("text","Accepts");if(f){var k=createDIV(i);j=createH(k,4).set("text","URLs");for(var l=createTABLE(k,"configDataTable"),m=0;m<d.length;m++)var n=createTR(l),o=createTD(n,"servicesDataValue").setHTML(this.createValueHtml(d[m]))}if(g){var p=createDIV(i);j=createH(p,4).set("text","Options");for(var l=createTABLE(p,"configDataTable"),q=getSortedKeys(e),m=0;m<q.length;m++){var r=q[m],s=e[r],t=typeOf(s),u;if("array"===t)u=s.map(function(a,b,d){return c.createValueHtml(a)}).join("<BR>");else if("object"===t){var v=[];for(var w in s)s.hasOwnProperty(w)&&v.push(w);0===v.length?u="":(v.sort(),u=v.map(function(a,b,d){return"<b>"+c.createValueHtml(a)+":</b> "+c.createValueHtml(s[a])}).join("<BR>"))}else u=this.createValueHtml(s);var n=createTR(l),o=createTD(n,"configServicesDataLabel").set("text",r);o=createTD(n,"servicesDataValue").setHTML(u)}}return h}},renderConnectData:function(b){var c=b&&b.get("connects"),d=b&&b.get("connectOptions"),e=!isEmptyValue(c),f=!isEmptyValue(d);if(e||f){var g=a.one(a.config.doc.createDocumentFragment()),h=createDIV(g,"configServicesSection"),i=createH(h,3).set("text","Connect");if(e){var j=createDIV(h);i=createH(j,4).set("text","URLs");for(var k=createTABLE(j,"configDataTable"),l=0;l<c.length;l++)var m=createTR(k),n=createTD(m,"servicesDataValue").setHTML(this.createValueHtml(c[l]))}if(f){var o=createDIV(h);i=createH(o,4).set("text","Options");for(var k=createTABLE(o,"configDataTable"),p=getSortedKeys(d),l=0;l<p.length;l++){var q=p[l],r=d[q];m=createTR(k),n=createTD(m,"configServicesDataLabel").set("text",q),n=createTD(m,"servicesDataValue").setHTML(this.createValueHtml(r))}}return g}},renderProperties:function(b){var c=b&&b.get("properties");if(!isEmptyValue(c)){for(var d=a.one(a.config.doc.createDocumentFragment()),e=createDIV(d,"configServicesSection"),f=createH(e,3).set("text","Properties"),g=createTABLE(e,"configDataTable"),h=getSortedKeys(c),i=0;i<h.length;i++){var j=h[i],k=c[j];"array"!==typeOf(k)&&(k=[k]);for(var l=0;l<k.length;l++){var m=createTR(g),n=createTD(m,"configServicesDataLabel").set("text",j);n=createTD(m,"servicesDataValue").setHTML(this.createValueHtml(k[l]))}}return d}},renderCrossSiteConstraints:function(b){var c=b&&b.get("crossSiteConstraints");if(!isEmptyValue(c)){var d=a.one(a.config.doc.createDocumentFragment()),e=createDIV(d,"configServicesSection"),f=createH(e,3).set("text","Cross-Site Constraints"),g=createTABLE(e,"configDataTable"),h,i,j,k;k=createTHEAD(g),j=createTH(k,"configServicesDataLabel").set("text","Origin"),j=createTH(k,"configServicesDataLabel").set("text","Methods"),j=createTH(k,"configServicesDataLabel").set("text","Headers"),j=createTH(k,"configServicesDataLabel").set("text","Maximum Age");for(var l=0;l<c.length;l++){var m="",n="",o="",p="",q=c[l];for(var r in q)"allow-origin"===r?m=q[r]:"allow-methods"===r?n=q[r]:"allow-headers"===r?o=q[r]:"maximum-age"===r&&(p=q[r]);h=createTR(g),i=createTD(h,"servicesDataValue").setHTML(this.createValueHtml(m)),i=createTD(h,"servicesDataValue").setHTML(this.createValueHtml(n)),i=createTD(h,"servicesDataValue").setHTML(this.createValueHtml(o)),i=createTD(h,"servicesDataValue").setHTML(this.createValueHtml(p))}return d}},renderAuthorizationConstraints:function(b){var c=b&&b.get("requiredRoles");if(!isEmptyValue(c)){for(var d=a.one(a.config.doc.createDocumentFragment()),e=createDIV(d,"configServicesSection"),f=createH(e,3).set("text","Authorization Constraints"),g=createTABLE(e,"configDataTable"),h=0;h<c.length;h++){var i=c[h].trim(),j=createTR(g),k;"*"===i?(k="require-valid-user",i=""):k="required-role";var l=createTD(j,"configServicesDataLabel").set("text",k);l=createTD(j,"servicesDataValue").setHTML(this.createValueHtml(i))}return d}},renderMimeMappings:function(b){var c=b&&b.get("mimeMappings");if(!isEmptyValue(c)){var d=a.one(a.config.doc.createDocumentFragment()),e=createDIV(d,"configServicesSection"),f=createH(e,3).set("text","MIME Mappings"),g=createTABLE(e,"configDataTable"),h,i,j,k;j=createTHEAD(g),k=createTH(j,"configServicesDataLabel").set("text","Extension"),k=createTH(j,"configServicesDataLabel").set("text","MIME Type");for(var l=getSortedKeys(c),m=0;m<l.length;m++){var n=l[m],o=c[n];h=createTR(g),i=createTD(h,"configServicesDataLabel").setHTML(this.createValueHtml(n)),i=createTD(h,"servicesDataValue").setHTML(this.createValueHtml(o))}return d}},createValueHtml:function(b){var c=this,d,e=typeOf(b);if("array"===e)d=b.map(function(a,b,d){return c.createValueHtml(a)}).join("<BR>");else if("object"===e){var f=[];for(var g in b)b.hasOwnProperty(g)&&f.push(g);0===f.length?d="":(f.sort(),d=f.map(function(a,d,e){return"<b>"+c.createValueHtml(a)+":</b> "+c.createValueHtml(b[a])}).join("<BR>"))}else d=a.Escape.html(b);return d}},{ATTRS:{container:{valueFn:function(){return a.one("#configServicesViewContainer")}},title:{value:"Configuration : Services"},toolbar:{value:null},clusterServiceConfigs:{value:null},selectedServiceConfig:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","service-config-model"]}),YUI.add("dashboard-view",function(a){"use strict";var b=a.Lang,c="dashboardView",d="dashboardData",e=1.2,f=250,g=1,h="kaazingCommandCenterCharts",i=6e3,j=6e4,k=3e5,l="Scrolling",m="Default Charts",n="Connected to a cluster",o="Connected to a single gateway",p='<img src="../images/pause.png"/>',q='<img src="../images/play.png"/>',r=1,s=0,t=-1,u=!1;a.DashboardView=a.Base.create(c,a.KaazingView,[],{MODEL_CHANGE_EVENT:c+"modelChange",BOUNDS_CHANGE_EVENT:c+"boundsChange",ADD_CHART_EVENT:c+"addChart",DELETE_CHART_EVENT:c+"deleteChart",RESIZE_EVENT:c+"resize",TOGGLE_CHART_SIZE_EVENT:c+"toggleChartSize",SHOW_GATEWAY_CHANGE_EVENT:c+"showGatewayChange",initializer:function(){u=navigator.userAgent.toLowerCase().indexOf("webkit")>=0;var a=this.get("model");a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},onChartDragFn:function(){},onChartDragEnd:function(a){var b=a.target,c=b.get("data");c.hit!==!0&&a.preventDefault(),delete c.hit},onChartDropHit:function(a){var b=this.get("charts"),c=a.drag,d=c.get("data").chart,e=b.indexOf(d),f=a.drop,g=f.get("data").chart,h=b.indexOf(g);if(e!=h-1){var i=d.get("container"),j=g.get("container"),k=i.get("parentNode");k.removeChild(i),k.insertBefore(i,j),i.setStyle("left","auto"),i.setStyle("top","auto"),c.get("data").hit=!0,b.splice(e,1),b.splice(h>e?h-1:h,0,d),this.computeAndStoreChartList()}},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.fire(this.MODEL_CHANGE_EVENT,{})},afterConnectionUrlChange:function(a){this.isActiveView()&&(this.renderOverallInfo(),this.renderLegend())},onGatewayAvailable:function(a){this.isActiveView()&&(this.renderOverallInfo(),this.renderLegend())},afterStopTimeChange:function(a){this.isActiveView()&&(this.renderOverallInfo(),this.renderLegend())},afterWindowResize:function(){if(this.isActiveView()){var a=this.get("charts");if(a&&a.length>0){var b=this.getMaximizedChart();this.adjustChartSizes(b?1:a.length),this.fire(this.RESIZE_EVENT,{})}}},afterLastDisplayableTimeChange:function(a){var b=a.prevVal,c=a.newVal,d=this.get("xDomainClip");if(d&&(null==b||this.get("scrolling"))){var e=[d[0]+(c-d[1]),c];this.set("xDomainClip",e),this.fire(this.BOUNDS_CHANGE_EVENT,{type:"translate",oldXDomainClip:d,newXDomainClip:e})}},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this.cancelDisplayTimeLoop(),this},doDisplaySetup:function(){var b=this;this.setupToolbar(),this.renderOverallInfo(),this.renderLegend(),this.get("firstTime")&&(this.publish(this.MODEL_CHANGE_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.BOUNDS_CHANGE_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.ADD_CHART_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.DELETE_CHART_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.RESIZE_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.TOGGLE_CHART_SIZE_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.publish(this.SHOW_GATEWAY_CHANGE_EVENT,{emitFacade:!0,broadcast:!0,bubbles:!0,defaultFn:function(){},preventedFn:function(){},stoppedFn:function(){}}),this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this),this.after("lastDisplayableTimeChange",this.afterLastDisplayableTimeChange,this),this.after("scrollingChange",this.afterScrollingChange,this),a.after("windowresize",function(){b.afterWindowResize()}),this.after("gatewayModel:connectionUrlChange",this.afterConnectionUrlChange,this),a.DD.DDM.on("drag:drag",this.onChartDragFn,this),a.DD.DDM.on("drag:end",this.onChartDragEnd,this),a.DD.DDM.on("drag:dropmiss",this.onChartDropMiss,this),a.DD.DDM.on("drag:drophit",this.onChartDropHit,this),this.set("firstTime",!1));var c=this.get("charts");if(!c){this.setupChartTimeBounds();var d=this.getChartList();if(""!==d){null==d&&(d=this.getDefaultChartList());for(var e=!1,f=0;f<d.length;f++)if(d[f].endsWith("+")){e=!0;break}this.adjustChartSizes(e?1:d.length);var c=[];this.set("charts",c);for(var g=this.get("container").one(".dashboardCharts"),f=0;f<d.length;f++){var h=d[f],i=h.endsWith("+");i&&(h=h.substring(0,h.length-1));var j=this.getChartMetadata(h);if(j){var k=this.instantiateChart(g,j,i);c.push(k),(i||!e)&&k.unhide()}else alert("Unable to find the chart named '"+h+"'")}this.computeAndStoreChartList()}}return this.get("scrolling")?this.startDisplayTimeLoop():this.get("lastDisplayableTime")||this.updateLastDisplayableTime(),this},setupChartTimeBounds:function(){var a=this,b=this.get("model").get("startTime").getTime(),c=Date.now();this.set("xDomain",[b,Date.now()+k]),this.set("xDomainClip",[c-i-j,c-i]);var d=function(){a.extendX()};this.set("maxChartTimeTimerId",invokeLater(d,k-6e4,k))},adjustChartSizes:function(a){var b,c,d;2>a?(b=100,c=100):(b=50,d=Math.floor((a+1)/2),c=Math.floor(100/d));var e=[b,c];this.set("chartContainerSize",e);var f=this.get("container"),g=f.one(".dashboardCharts"),h=[parseInt(g.getStyle("width")),parseInt(g.getStyle("height"))],i=this.get("chartMargin"),k=4,l=47,m=1,n=[h[0]*(b/100)-2*(k+m),h[1]*(c/100)-l-2*k];this.set("chartAreaSize",n);var o=[n[0]-(i.left+i.right),n[1]-(i.top+i.bottom)];this.set("chartSize",o);var p=this.get("xDomain"),q=this.get("xRange"),r=this.get("xDomainClip");r?(q=[0,(p[1]-p[0])/(r[1]-r[0])*o[0]],this.set("xRange",q)):(q=[0,(p[1]-p[0])/j*o[0]],this.set("xRange",q),r=[p[0],p[0]+j],this.set("xDomainClip",r)),this.set("yRange",[0,-o[1]])},render:function(){var a=this.get("container"),b=a.one("#dashboardData");return removeAllChildren(b),createDIV(b,"dashboardCharts"),createDIV(b,"dashboardLegendDiv"),this},setupToolbar:function(){this.clearToolbar(),this.setupToolbarButtons(),this.setupAddChartSelector()},clearToolbar:function(){var a=this.get("toolbar");removeAllChildren(a)},setupToolbarButtons:function(){var a=this.get("toolbar"),b=createBUTTON(a,l,"toolbarButton").set("id","scrollingButton");this.set("scrollingButton",b),b.on("click",this.handleToggleScrolling,this),this.adjustScrollingButton();var c=createBUTTON(a,m,"toolbarButton").set("id","showDefaultChartsButton");c.on("click",this.handleShowDefaultCharts,this)},adjustScrollingButton:function(){var a=this.get("scrollingButton");this.get("scrolling")?(a.removeClass("paused"),a.hasClass("scrolling")||a.addClass("scrolling")):(a.removeClass("scrolling"),a.hasClass("paused")||a.addClass("paused"))},setupAddChartSelector:function(){var a=this.get("toolbar"),b=a.one(".dashboardAddChartSelectorDiv"),c;if(b)c=b.one("select");else{b=createDIV(a,"dashboardAddChartSelectorDiv");var d=createSPAN(b,"Add Chart:"),e=createSPAN(b,"");e.addClass("dashboardAddChartSelectorSpan"),c=createSELECT(e,"toolbarSelect"),c.on("change",this.handleAddChart,this)}c.get("childNodes").remove();var f=this.get("app"),g=f.getCharts(),h=createOPTION(c,null,"Select chart...","");for(var i in g)if(g.hasOwnProperty(i))var j=g[i],h=createOPTION(c,null,j[0],i)},renderOverallInfo:function(){var a=this.get("model"),b=this.get("container").one("#dashboardData"),c=b.one("#dashboardOverall");c||(c=createDIV(b).set("id","dashboardOverall")),removeAllChildren(c);var d=a.get("numRunning"),e=createDIV(c,"title");if(this.isCluster()){var f=a.get("numQuarantined"),d=a.get("numRunning"),g=f+d;e.set("text",n),e=createDIV(c,"label").set("text","Members: "),e=createDIV(c,"value").set("text",g),e=createDIV(c,"label").set("text","Quarantined: "),e=createDIV(c,"value").set("text",f),e=createDIV(c,"label").set("text","Running: "),e=createDIV(c,"value").set("text",d)}else e.set("text",o)},renderLegend:function(){var a=this,b=this.get("container"),c=b.one(".dashboardLegendDiv");removeAllChildren(c);var d=createDIV(c,"dashboardLegendLabel").set("text","Legend"),e=createDIV(c,"dashboardLegendInstructions"),f=this.get("model");f.get("isCluster")?e.set("text","Click on a cluster member below to show or hide that member's data in all charts"):e.set("text","Click on the gateway below to show or hide its data in all charts");var g=this.createImageCheckbox(c,null,"dashboardLegendSelectAll","Select All",function(b){var c=b._currentTarget;a.handleShowGatewaySelectAll(c)}),h=this.get("showGatewayList");h?0==h.length?this.updateImageCheckbox(g,s):this.updateImageCheckbox(g,t):this.updateImageCheckbox(g,r);var f=this.get("model"),i=f.getSortedGateways();if(i)for(var j=null,k=0;k<i.length;k++){var l=i[k],m=l.get("connectionUrl");if(!m)break;if(m!==j){var d=l.get("gatewayLabel"),n=this.isShowGateway(m),o=this.getColor(l.get("connectionUrl")),p=this.createImageCheckbox(c,null,"dashboardLegendGateway",d,function(b){return function(c){var d=c._currentTarget;a.handleShowGatewaySelect(d,b)}}(m));p.setStyle("color",o.toString()),this.updateImageCheckbox(p,n?r:s),j=m}}},createImageCheckbox:function(a,b,c,d,e){var f=createDIV(a,"dashboardCheckbox");b&&f.set("id",b),c&&f.addClass(c);var g=createLABEL(f);createSPAN(g,d);var h=createINPUT(g,"checkbox");return h.on("click",e,this),f},updateImageCheckbox:function(a,b){var c=a.get("children").item(0),d=c.one("input");c.removeClass("none"),c.removeClass("all"),c.removeClass("some"),setCheckboxState(d._node,b),c.addClass(0===b?"none":1===b?"all":"some")},handleShowGatewaySelect:function(b,c){var d=this.get("model"),e=a.one(b.parentNode.parentNode);this.updateImageCheckbox(e,checkboxState(b));var f=this.get("container").one(".dashboardLegendSelectAll"),g=this.get("showGatewayList"),h=d.getGateways();if(this.isShowGateway(c)){if(g)g.splice(g.indexOf(c),1);else{g=[];for(var i=0;i<h.length;i++){var j=h[i].get("connectionUrl");j&&g.indexOf(j)<0&&j!==c&&g.push(j)}}this.updateImageCheckbox(f,0==g.length?0:-1)}else{g.push(c);for(var k=!1,i=0;i<h.length;i++){var l=h[i];if(g.indexOf(l.get("connectionUrl"))<0){k=!0;break}}k||(g=null),this.updateImageCheckbox(f,g?-1:1)}this.set("showGatewayList",g),this.fire(this.SHOW_GATEWAY_CHANGE_EVENT,{})},handleShowGatewaySelectAll:function(a){var b=this,c=checkboxState(a);this.set("showGatewayList",0==c?[]:null);var d=this.get("container"),e=d.one(".dashboardLegendDiv"),f=e.all(".dashboardCheckbox");f.each(function(a){b.updateImageCheckbox(a,c)}),this.fire(this.SHOW_GATEWAY_CHANGE_EVENT,{})},handleShowDefaultCharts:function(){var a=this.get("charts");if(a){for(var b=0;b<a.length;b++)a[b].destroy({remove:!0});this.set("charts",null)}this.removeChartList(),this.render(),this.doDisplaySetup()},handleAddChart:function(a){var b=a.target,c=b.get("value");b.set("selectedIndex",0);var d=this.getChartMetadata(c);if(d){var e=this.get("charts");e||(e=[]);var f=e.length+1;this.adjustChartSizes(f);var g=this.instantiateChart(this.getChartsDiv(),d,!1);e.push(g),this.set("charts",e),this.fire(this.ADD_CHART_EVENT,{chart:g}),this.computeAndStoreChartList()}},handleDeleteChart:function(a){var b=this.get("charts"),c=b.indexOf(a);c>=0&&b.splice(c,1),a.destroy({remove:!0});var d=b.length;this.adjustChartSizes(d),this.fire(this.DELETE_CHART_EVENT),this.computeAndStoreChartList()},handleToggleChartSize:function(a){var b=this.get("charts");a.isMaximized()?(this.adjustChartSizes(b.length),this.fire(this.TOGGLE_CHART_SIZE_EVENT,{maximizedChart:null})):(this.adjustChartSizes(1),this.fire(this.TOGGLE_CHART_SIZE_EVENT,{maximizedChart:a})),this.computeAndStoreChartList()},afterScrollingChange:function(){if(this.adjustScrollingButton(),this.get("scrolling")){var a=Date.now()-i,b=this.get("xDomainClip")[1];this.startDisplayTimeLoop(),this.translateByTime(a-b)}else this.cancelDisplayTimeLoop()},handleToggleScrolling:function(){var a=this.get("scrolling");if(!a){var b=this.get("lastDisplayableTime"),c=this.get("xDomainClip"),d=[b-j,b];this.set("xDomainClip",d);var e=this.get("chartSize"),f=this.get("xDomain"),g=[0,(f[1]-f[0])/j*e[0]];this.set("xRange",g),this.fire(this.BOUNDS_CHANGE_EVENT,{type:"translate",oldXDomainClip:c,newXDomainClip:d})}this.set("scrolling",!a)},instantiateChart:function(a,b,c){var d=this.get("chartContainerSize"),e=createDIV(a,"dashboardChart").setStyle("width",d[0]+"%").setStyle("height",d[1]+"%"),f=b[0],h=b[1],i=new h({model:this.get("model"),dashboard:this,container:e,chartId:g++,title:f,maximized:c});return i},getMaximizedChart:function(){var a=this.get("charts");if(a)for(var b=0;b<a.length;b++){var c=a[b];if(c.isMaximized())return c}return null},isShowGateway:function(a){var b=this.get("showGatewayList");return!b||b.indexOf(a)>=0},startDisplayTimeLoop:function(){var a=this;this.cancelDisplayTimeLoop();var b=function(){a.updateLastDisplayableTime()};b();var c=invokeLater(b,f,f);this.set("displayLoopTimer",c)},cancelDisplayTimeLoop:function(){var a=this.get("displayLoopTimer");a&&(clearInterval(a),this.set("displayLoopTimer",null))},computeAndStoreChartList:function(){var a=this.get("charts");if(a){var b=0==a.length?"":a.map(function(a){var b=a.name;return a.isMaximized()?b+"+":b}).join(",");this.storeChartList(b)}else this.removeChartList()},storeChartList:function(a){localStorage.setItem(h,a)},getChartList:function(){var a=localStorage.getItem(h);return""==a?"":a?a.split(","):null},getChartMetadata:function(a){var b=this.get("app").getChart(a);return b},getDefaultChartList:function(){var a=this.get("app").DEFAULT_CHART_LIST;return a},removeChartList:function(){localStorage.removeItem(h)},getChartsDiv:function(){var a=this.get("container").one(".dashboardCharts");return a},getColor:function(a){var b=this.get("gatewayColors"),c=b(a);return c},updateLastDisplayableTime:function(){this.set("lastDisplayableTime",Date.now()-i)},translateByTime:function(a){var b=this.get("xDomainClip"),c=this.get("lastDisplayableTime");if(b[1]+a>c&&(a=c-b[1]),0!==a){var d=[b[0]+a,b[1]+a];this.set("xDomainClip",d),this.fire(this.BOUNDS_CHANGE_EVENT,{type:"translate",oldXDomainClip:b,newXDomainClip:d})}},translateByPixels:function(a){var b=this.get("xDomain"),c=this.get("xRange"),d=invertX(0,b,c),e=invertX(a,b,c);this.translateByTime(e-d)},scale:function(a){var b=this.get("xDomain"),c=this.get("xRange"),d=this.get("xDomainClip"),f=a>0?e:1/e,g=[c[0]*f,c[1]*f],h=d[1]-d[0],i=h/f,j=[d[0]+h/2-i/2,d[1]-h/2+i/2],k=this.get("lastDisplayableTime");j[1]>k&&(j[0]-=j[1]-k,j[1]=k),this.set("xRange",g),this.set("xDomainClip",j),this.fire(this.BOUNDS_CHANGE_EVENT,{type:"scale",scaleFactor:f,oldXRange:c,newXRange:g,oldXDomainClip:d,newXDomainClip:j})},extendX:function(){var a=this.get("xDomain"),b=this.get("xRange"),c=a[0],d=a[1],e=a[1]+k,f=(e-c)/(d-c),g=b[0],h=b[1],i=(h-g)*f+g;a[1]=e,this.set("xDomain",a),b[1]=i,this.set("xRange",b)},isTimeVisible:function(a){var b=this.get("xDomainClip");return a>=b[0]&&a<=b[1]},startPanningOrZooming:function(){this.set("scrolling",!1)},endPanningOrZooming:function(){var a=this.get("lastDisplayableTime"),b=this.get("xDomainClip");Math.abs(a-b[1])<2e3&&this.set("scrolling",!0)}},{ATTRS:{container:{valueFn:function(){return a.one("#dashboardViewContainer")}},toolbar:{value:null},title:{value:"Dashboard"},chartMargin:{value:{top:10,right:20,bottom:25,left:45}},scrolling:{value:!0},chartContainerSize:{value:null},chartAreaSize:{value:null},chartSize:{value:null},charts:{value:null},showGatewayList:{value:null},xTicks:{value:12},maxChartTimeTimerId:{value:null},xDomain:{value:null},xDomainClip:{value:null},xRange:{value:null},yRange:{value:null},lastDisplayableTime:{value:null},displayLoopTimer:{value:null},firstTime:{value:!0},gatewayColors:{valueFn:function(){var a=["#F47D31","#3A6F8F","#FF0000","#48FF48","#0000FF","#OOFFFF","#7FFFD4","#FF7F50","#006400","#DAA520","#CD5C5C","#90EE90","#3CB371","#DDA0DD","#4169E1"],b=-1,c={};return function(d){var e=c[d];return e?e:(e=a[++b],c[d]=e,e)}}}}})},"0.99",{requires:["kaazing-view","cluster-model","gateway-model","dashboard-chart"]}),YUI.add("gateway-config-view",function(a){"use strict";var b=a.Lang,c="gatewayConfigView";a.GatewayConfigView=a.Base.create(c,a.View,[],{initializer:function(){var b=this,c=this.get("model"),d=c.get("gatewayConfig"),e=this.get("realmConfigViews"),f=d.get("realmConfigs");if(f)for(var g=0;g<f.length;g++){var h=f[g];e.push(new a.GatewayRealmConfigView({model:h,app:this.get("app")}))}var i=this.get("noRealmServiceConfigViews"),j=d.get("serviceConfigs");if(j)for(var g=0;g<j.length;g++){var k=j[g];k.get("realm")||i.push(new a.GatewayServiceConfigView({model:k,app:this.get("app")}))}},destructor:function(){this.destroySubviews()},render:function(){var b=a.one(a.config.doc.createDocumentFragment()),c=this.get("modelList"),d=c.item(0),e=createDIV(b,"graphicRealm"),f=createDIV(e,"graphicRealmTitleDiv"),g=createIMG(f,"../images/castle3.png","graphicRealmImage"),h=createSPAN(f,"Realm: ","graphicRealmTitle"),i=createSPAN(f,d.get("name"),"graphicRealmTitleName"),j=this.get("clusterServiceConfigViews"),k=j.length;if(0===k)var l=createDIV(e,"graphicNoServiceRealm").set("text","No services refer to this realm");else{var m=j.slice();m.sort(function(a,b){var c=a.get("modelList").item(0),d=b.get("modelList").item(0);return c.sortCompare(d)});for(var n=0;k>n;n++){var o=m[n];e.append(o.render().get("container"))}}return this.get("container").setHTML(b),this},sortCompare:function(a){var b=this.get("modelList").item(0),c=a.get("modelList").item(0);return b.sortCompare(c)}},{ATTRS:{container:{value:null},app:{value:null},model:{value:null},realmConfigViews:{value:[]},noRealmServiceConfigViews:{value:[]}}})},"0.99",{requires:["view","gateway-config-model"]}),YUI.add("gateway-realm-config-view",function(a){"use strict";var b=a.Lang,c="gatewayRealmConfigView";a.GatewayRealmConfigView=a.Base.create(c,a.View,[],{initializer:function(){$this.after("showUrlsChange",$this.afterShowUrlsChange,$this)},afterShowUrlsChange:function(a){},render:function(){var a=this,b=a.get("container");return removeAllChildren(b),realmBox}},{ATTRS:{container:{value:null},app:{value:null},showUrls:{value:!1}}})},"0.99",{requires:["view","realm-config-model"]}),YUI.add("gateway-service-config-view",function(a){"use strict";var b=a.Lang,c="gatewayServiceConfigView";a.GatewayServiceConfigView=a.Base.create(c,a.View,[],{IMAGE_HEIGHT:24,IMAGE_SEPARATION:8,OUTER_SPACE:25,initializer:function(){var a=this;a.after("showUrlsChange",a.afterShowUrlsChange,a)},afterShowUrlsChange:function(a){this.render()},render:function(){var b=this,c=a.one(a.config.doc.createDocumentFragment()),d=this.get("model"),e=createDIV(c,"graphicServiceContainer"),f=createDIV(e,"graphicService"),g=d.get("type"),h=CC.Constants.SERVICE_DISPLAY_INFO[g],i=h.cssServiceType;i||(i="unknown-service"),f.addClass(i);var j=h.image;if(j)var k=createIMG(f,j,"graphicServiceTypeImage");var l=d.get("accepts"),m=d.get("connects"),n=d.get("balances"),o=l?l.length:0,p=m?m.length:0,q=n?n.length:0,r;r=q>0?q>p?q:p:o>p?o:p,0===r&&(r=1);var s=r*this.IMAGE_HEIGHT+(r-1)*this.IMAGE_SEPARATION+2*this.OUTER_SPACE;f.setStyle("height",""+s+"px");var t=d.get("label"),u=createLINK(f,"javascript:void(0);","graphicServiceName").setHTML(t);
u.on("click",function(a){return function(c){b.get("app").save("/config/services?connectionUrl="+a.get("gatewayModel").get("connectionUrl")+"&serviceId="+a.get("serviceId"))}}(d));var v=createDIV(f,"graphicServiceTypeName").setHTML(d.get("type"));this.renderAccepts(q>0?n:l,f),this.renderConnects(m,f);var w=this.get("warning");return w&&w.length>0&&this.renderWarning(f,w),this.get("container").setHTML(c),this},renderAccepts:function(a,b){if(a)for(var c=0;c<a.length;c++){var d=a[c],e=d.indexOf(":"),f=d.substring(0,e).toLowerCase(),g=this.OUTER_SPACE+c*(this.IMAGE_HEIGHT+this.IMAGE_SEPARATION),h=createDIV(b,"graphicServiceAcceptContainer").setStyle("top",g).setAttribute("title",d),i=CC.Constants.TLS_SSL_IMAGES[f];if(i&&(l=createIMG(h,i,"graphicServiceAcceptLock")),this.get("showUrls"))var j=createDIV(h,"graphicServiceAcceptUrl").set("text",d).addClass(f+"Protocol");var k=CC.Constants.PROTOCOL_DISPLAY_INFO[f],i=k.forwardIcon,l=createIMG(h,i,"graphicServiceAccept"),m=createDIV(h,"clear")}},renderConnects:function(a,b){if(a)for(var c=0;c<a.length;c++){var d=a[c],e=d.indexOf(":"),f=d.substring(0,e),g=this.OUTER_SPACE+c*(this.IMAGE_HEIGHT+this.IMAGE_SEPARATION),h=createDIV(b,"graphicServiceConnectContainer").setStyle("top",g).setAttribute("title",d),i=CC.Constants.PROTOCOL_DISPLAY_INFO[f],j=i.forwardIcon,k=createIMG(h,j,"graphicServiceConnect");if(this.get("showUrls"))var l=createDIV(h,"graphicServiceConnectUrl").set("text",d).addClass(f+"Protocol");j=CC.Constants.TLS_SSL_IMAGES[f],j&&(k=createIMG(h,j,"graphicServiceConnectLock"));var m=createDIV(h,"clear")}},renderWarning:function(a,b){var c=createIMG(a,CC.Constants.WARNING_IMAGE,"graphicServiceWarningIcon").setAttribute("alt","Warning").setAttribute("title",b)}},{ATTRS:{container:{value:null},app:{value:null},model:{value:null},showUrls:{value:!1},warning:{value:null}}})},"0.99",{requires:["view","service-config-model"]}),YUI.add("kaazing-view",function(a){"use strict";var b=a.Lang,c="kaazingView";a.KaazingView=a.Base.create(c,a.View,[],{isActiveView:function(){var a=this.get("app");return a.isActiveView(this)},isInDoc:function(){var a=this.get("container");return a.inDoc()},hasLoggedIn:function(){var a=this.get("app");return a.hasLoggedIn()},isCluster:function(){var a=this.get("app");return a.isCluster()}},{ATTRS:{app:{value:null},title:{value:null},toolbar:{value:null}}})},"0.99",{requires:["view","command-center"]}),YUI.add("monitor-gateways-view",function(a){"use strict";var b=a.Lang,c="monitorGatewaysView",d=0;a.MonitorGatewaysView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},doDisplaySetup:function(){if(this.get("firstTime")){this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.on(a.ServiceDynamicDataModel.prototype.UPDATE_EVENT,this.onUpdateService,this),this.after("gatewayModel:stopTimeChange",this.afterStopTimeChange,this);var b=new AndFilter;b.addFilter(new NumericFilter("stopTime","UNSET","")),this.set("filter",b),this.after("filterChange",this.afterFilterChange,this);var c=new a.ModelList({model:a.GatewayModel}),d=[{key:"hostAndPID",label:"Host&nbsp;:&nbsp;PID<br>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:70,className:"monitorGatewaysHostAndPID"},{key:"startTime",label:"Start<br>Time",sortable:!0,allowHTML:!0,emptyCellValue:"",width:70,formatter:function(a){return formatTableTime(a,"startTime")},sortFn:function(a,b,c){return compareNumbers(a.get("startTime"),b.get("startTime"),c,0)},className:"monitorGatewaysStartTime"},{key:"stopTime",label:"Stop<br>Time",sortable:!0,allowHTML:!0,emptyCellValue:"",width:70,formatter:function(a){return formatTableTime(a,"stopTime")},sortFn:function(a,b,c){return compareNumbers(a.get("stopTime"),b.get("stopTime"),c,0)},className:"monitorGatewaysStartTime"},{key:"totalCurrentSessions",label:"Current<br>Sessions",sortable:!0,allowHTML:!1,emptyCellValue:"",width:70,formatter:function(a){var b=a.record;return formatNumber(b.get("totalCurrentSessions"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalCurrentSessions"),b.get("totalCurrentSessions"),c,0)},className:"monitorGatewaysCurrentSessions"},{key:"totalBytesReceived",label:"Bytes<br>Read",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memorySizeString(b.get("totalBytesReceived"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalBytesReceived"),b.get("totalBytesReceived"),c,0)},className:"monitorGatewaysBytesReceived"},{key:"totalBytesSent",label:"Bytes<br>Written",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memorySizeString(b.get("totalBytesSent"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalBytesSent"),b.get("totalBytesSent"),c,0)},className:"monitorGatewaysBytesSent"}],e=new a.DataTable({columns:d,data:c,recordType:a.GatewayModel,editable:!1,highlightMode:"row",selectionMode:"row",selectionMulti:!1});e.set("strings.emptyMessage","No gateways meet your selected criteria"),this.set("dataTable",e),this.adjustForClusterColumn(),this.doSearch(),e.render("#monitorGatewaysResults"),this.set("firstTime",!1)}this.setupToolbar()},buildFilterFieldDefinitions:function(){var a=this,b=[["hostAndPID","Host : PID","alpha"],["startTime","Start Time","numeric"],["stopTime","Stop Time","numeric"],["totalCurrentSessions","Current Sessions","numeric"],["totalBytesReceived","Bytes Read","numeric"],["totalBytesSent","Bytes Written","numeric"]];return this.isCluster()&&b.push(["gatewayLabel","Cluster Member","alpha"]),b.sort(function(a,b){var c=a[1],d=b[1];return d>c?-1:c===d?0:1}),a.set("filterFieldDefinitions",b),b},adjustForClusterColumn:function(){var a=this.get("dataTable");if(a){var b=a.get("columns");this.isCluster()?"gatewayLabel"!==b[d].key&&(b.splice(d,0,{key:"gatewayLabel",label:"Cluster<br>Member",sortable:!0,allowHTML:!0,emptyCellValue:"",width:60,formatter:function(a){var b=a.record;return b.get("gatewayLabel")},className:"monitorGatewaysGateway"}),a.set("columns",b)):"gatewayLabel"===b[d].key&&(b.splice(d,1),a.set("columns",b))}},initContextMenu:function(b){var c=this,d=new a.ContextMenuView({container:a.Node.create('<div id="cmenuView" class="cmenu" tabindex="1"></div>'),app:this.get("app"),menuItemTemplate:'<div class="yui3-contextmenu-menuitem" data-cmenu="{menuIndex}">{menuContent}</div>',menuItems:[{label:"Shut down",value:"i",handler:c.handleShutDownGateway}],trigger:{node:b.get("srcNode").one("table .yui3-datatable-data"),target:"tr"}});d.after("selectedMenuChange",c.selectedContextMenuItem,c),d.after("contextTargetChange",function(a){var b=a.newVal,c=a.prevVal||null;c&&c.removeClass("selectTr"),b&&b.addClass("selectTr")}),d.on("contextMenuHide",function(){var a=this.get("contextTarget");a&&a.removeClass("selectTr")}),c.set("cmenu",d)},selectedContextMenuItem:function(a){var b=this.get("dataTable"),c=this.get("cmenu"),d=c.get("contextTarget"),e=d.getAttribute("data-yui3-record"),f=b.getRecord(e),g=+a.newVal.menuIndex,h=a.newVal.menuItem;h.handler&&setTimeout(function(){h.handler.call(this,f)},0)},handleShutDownGateway:function(a){alert("Shutting down a gateway is not currently implemented.")},setupToolbar:function(){var a=this.get("toolbar");this.setupFilters(a)},setupDisplayMax:function(a){var b=createLABEL(a,"Display max of "),c=this.get("maxRows"),d=createSELECT(a,"monitorMaxRowsSelect").set("id","gatewaysMaxRowsSelect");d.on("change",this.onMaxRowsChange,this);var e=createOPTION(d,null,"10","10");e=createOPTION(d,null,"50","50"),e=createOPTION(d,null,"100","100"),e=createOPTION(d,null,"500","500"),d.get("options").each(function(){var a=this.get("value");a==c&&this.set("selected","selected")}),b=createLABEL(a," rows")},setupFilters:function(a){var b=createLABEL(a,"Filter: ","filterSelector"),c=createSELECT(b,"toolbarSelect");c.on("change",this.onFilterSelectChange,this);var d=createOPTION(c,null,"Choose...","choose");d=createOPTION(c,null,"Clear all conditions","clear"),d=createOPTION(c,null,"Running Instances","running"),d=createOPTION(c,null,"Stopped Instances","stopped"),d=createOPTION(c,null,"Edit...","edit"),this.displayFilter()},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.render()},onGatewayAvailable:function(a){this.adjustForClusterColumn();var b=a.gatewayModel,c=this.get("filter");(!c||c.match(b))&&this.get("dataTable").addRow(b,null)},onUpdateService:function(a){var b=a.model,c=b.get("serviceModel"),d=c.get("gatewayModel"),e=this.get("filter"),f=this.get("dataTable"),g=!e||e.match(d),h=f.data.indexOf(d);if(g)if(h>=0){for(var i={},j=["totalCurrentSessions","totalBytesReceived","totalBytesSent"],k=0;k<j.length;k++){var l=j[k];i[l]=d.get(l)}f.modifyRow(h,i)}else f.addRow(d,null);else h>=0&&f.removeRow(d)},afterFilterChange:function(){this.displayFilter(),this.doSearch()},afterStopTimeChange:function(a){this.adjustForClusterColumn();var b=a.target,c=this.get("filter"),d=this.get("dataTable"),e=!c||c.match(b),f=d.data.indexOf(b);e?f>=0?d.modifyRow(f,{stopTime:a.newVal}):d.addRow(b,null):f>=0&&d.removeRow(b)},onMaxRowsChange:function(a){var b=parseInt(a.target.get("value"),10);this.set("maxRows",b);var c=this.get("dataTable");c.data.size()>b},onFilterSelectChange:function(a){var b=a.target.get("value");switch(b){case"choose":break;case"edit":this.doFilterDisplay(),a.target.set("selectedIndex",0);break;case"clear":var c=new AndFilter;this.set("filter",c),a.target.set("selectedIndex",0);break;case"running":var c=new AndFilter;c.addFilter(new NumericFilter("stopTime","UNSET","")),this.set("filter",c);break;case"stopped":var c=new AndFilter;c.addFilter(new NumericFilter("stopTime","SET","")),this.set("filter",c)}},render:function(){return this},doFilterDisplay:function(){var a=this,b=this.get("fieldFieldDefinitions");b||(b=this.buildFilterFieldDefinitions()),this.get("filterPanel").display(this.get("model"),this.get("filter"),b,function(b){a.set("filter",b)})},displayFilter:function(){var b=this.get("filter"),c=a.one("#monitorGatewaysCurrentFilter"),d=b?b.toString():"none";""===d&&(d="none"),c.setHTML('<span>Current Filter: </span><span class="filterValue">'+d+"</span>")},clearFilters:function(){var a=new AndFilter;this.set("filter",a)},doSearch:function(){var a=this.get("filter"),b=this.get("model"),c=b.getGateways(),d=this.get("dataTable");if(d.data.size()>0&&d.data.reset(),c)for(var e=0;e<c.length;e++){var f=c[e];(!a||a.match(f))&&d.addRow(f,null)}},findFilters:function(a){var b=this.get("filter");return b?b.findFilters(a):null}},{ATTRS:{container:{valueFn:function(){return a.one("#monitorGatewaysViewContainer")}},selectionCriterion:{value:null},title:{value:"Monitoring : Gateways"},maxRows:{value:100},dataTable:{value:null},filterFieldDefinitions:{value:null},filter:{value:null},cmenu:{value:null},filterPanel:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["view","cluster-model","gateway-model","monitor-filter-panel"]}),YUI.add("monitor-services-view",function(a){"use strict";var b=a.Lang,c="monitorServicesView",d=0;a.MonitorServicesView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},hideViewCallback:function(){return this},doDisplaySetup:function(){if(this.get("firstTime")){this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.on(a.GatewayModel.prototype.ADD_SERVICE_EVENT,this.onAddService,this),this.on(a.GatewayModel.prototype.REMOVE_SERVICE_EVENT,this.onRemoveService,this),this.on(a.ServiceDynamicDataModel.prototype.UPDATE_EVENT,this.onUpdateService,this),this.after("serviceModel:stopTimeChange",this.afterStopTimeChange,this);var b=new AndFilter;b.addFilter(new NumericFilter("stopTime","UNSET","")),this.set("filter",b),this.after("filterChange",this.afterFilterChange,this);var c=new a.ModelList({model:a.ServiceModel}),d=[{key:"serviceLabel",label:"Service<br>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:100,formatter:function(a){var b=a.record;return b.get("serviceLabel")},className:"monitorServicesService"},{key:"startTime",label:"Start<br>Time",sortable:!0,allowHTML:!0,emptyCellValue:"",width:70,formatter:function(a){return formatTableTime(a,"startTime")},sortFn:function(a,b,c){return compareNumbers(a.get("startTime"),b.get("startTime"),c,0)},className:"monitorServicesStartTime"},{key:"stopTime",label:"Stop<br>Time",sortable:!0,allowHTML:!0,emptyCellValue:"",width:70,formatter:function(a){return formatTableTime(a,"stopTime")},sortFn:function(a,b,c){return compareNumbers(a.get("stopTime"),b.get("stopTime"),c,0)},className:"monitorServicesStopTime"},{label:"Current Sessions",children:[{key:"totalCurrentSessions",label:"Total",sortable:!0,allowHTML:!0,emptyCellValue:"",width:70,formatter:function(a){var b=a.record;return formatNumber(b.get("totalCurrentSessions"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalCurrentSessions"),b.get("totalCurrentSessions"),c,0)},className:"monitorServicesTotalCurrentSessions"},{key:"totalCurrentNativeSessions",label:"Native",sortable:!0,allowHTML:!1,emptyCellValue:"",width:70,formatter:function(a){var b=a.record;return formatNumber(b.get("totalCurrentNativeSessions"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalCurrentNativeSessions"),b.get("totalCurrentNativeSessions"),c,0)},className:"monitorServicesTotalCurrentNativeSessions"},{key:"totalCurrentEmulatedSessions",label:"Emulated",sortable:!0,allowHTML:!1,emptyCellValue:"",width:70,formatter:function(a){var b=a.record;return formatNumber(b.get("totalCurrentEmulatedSessions"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalCurrentEmulatedSessions"),b.get("totalCurrentEmulatedSessions"),c,0)},className:"monitorServicesTotalCurrentEmulatedSessions"}]},{label:"Cumulative Sessions",children:[{key:"totalCumulativeSessions",label:"Total",sortable:!0,allowHTML:!1,emptyCellValue:"",width:70,formatter:function(a){var b=a.record;return formatNumber(b.get("totalCumulativeSessions"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalCumulativeSessions"),b.get("totalCumulativeSessions"),c,0)},className:"monitorServicesTotalCumulativeSessions"},{key:"totalCumulativeNativeSessions",label:"Native",sortable:!0,allowHTML:!1,emptyCellValue:"",width:70,formatter:function(a){var b=a.record;return formatNumber(b.get("totalCumulativeNativeSessions"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalCumulativeNativeSessions"),b.get("totalCumulativeNativeSessions"),c,0)},className:"monitorServicesTotalCumulativeNativeSessions"},{key:"totalCumulativeEmulatedSessions",label:"Emulated",sortable:!0,allowHTML:!1,emptyCellValue:"",width:70,formatter:function(a){var b=a.record;return formatNumber(b.get("totalCumulativeEmulatedSessions"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalCumulativeEmulatedSessions"),b.get("totalCumulativeEmulatedSessions"),c,0)},className:"monitorServicesTotalCumulativeEmulatedSessions"}]},{key:"totalBytesReceived",label:"Bytes<br>Read",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memorySizeString(b.get("totalBytesReceived"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalBytesReceived"),b.get("totalBytesReceived"),c,0)},className:"monitorServicesTotalBytesReceived"},{key:"totalBytesReceivedThroughput",label:"Bytes Read<br>Throughput",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memoryThroughputString(b.get("totalBytesReceivedThroughput"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalBytesReceivedThroughput"),b.get("totalBytesReceivedThroughput"),c,0)},className:"monitorServicesTotalBytesReceivedThroughput"},{key:"totalBytesSent",label:"Bytes<br>Written",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memorySizeString(b.get("totalBytesSent"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalBytesSent"),b.get("totalBytesSent"),c,0)},className:"monitorServicesTotalBytesSent"},{key:"totalBytesSentThroughput",label:"Bytes Written<br>Throughput",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memoryThroughputString(b.get("totalBytesSentThroughput"))},sortFn:function(a,b,c){return compareNumbers(a.get("totalBytesSentThroughput"),b.get("totalBytesSentThroughput"),c,0)},className:"monitorServicesTotalBytesSentThroughput"}],e=new a.DataTable({columns:d,data:c,recordType:a.ServiceModel,editable:!1,highlightMode:"row",selectionMode:"row",selectionMulti:!1});e.set("strings.emptyMessage","No services meet your selected criteria"),this.set("dataTable",e),this.adjustForClusterColumn(),this.doSearch(),e.render("#monitorServicesResults"),this.set("firstTime",!1)}this.setupToolbar()},buildFilterFieldDefinitions:function(){var a=this,b=[["totalBytesReceived","Bytes Read","numeric"],["totalBytesReceivedThroughput","Bytes Read Throughput","numeric"],["totalBytesSent","Bytes Written","numeric"],["totalBytesSentThroughput","Bytes Written Throughput","numeric"],["totalCumulativeEmulatedSessions","Cumul. Emulated Sessions","numeric"],["totalCumulativeNativeSessions","Cumul. Native Sessions","numeric"],["totalCumulativeSessions","Cumul. Total Sessions","numeric"],["totalCurrentEmulatedSessions","Current Emulated Sessions","numeric"],["totalCurrentNativeSessions","Current Native Sessions","numeric"],["totalCurrentSessions","Current Total Sessions","numeric"],["serviceLabel","Service","alpha"],["startTime","Start Time","numeric"],["stopTime","Stop Time","numeric"]];return this.isCluster()&&b.push(["gatewayLabel","Cluster Member","alpha"]),b.sort(function(a,b){var c=a[1],d=b[1];return d>c?-1:c===d?0:1}),this.set("filterFieldDefinitions",b),b},adjustForClusterColumn:function(){var a=this.get("model"),b=this.get("dataTable");if(b){var c=b.get("columns");this.isCluster()?"gatewayLabel"!==c[d].key&&(c.splice(d,0,{key:"gatewayLabel",label:"Cluster<br>Member",sortable:!0,allowHTML:!0,emptyCellValue:"",width:60,formatter:function(a){var b=a.record;return b.get("gatewayLabel")},className:"monitorServicesGateway"}),b.set("columns",c)):"gatewayLabel"===c[d].key&&(c.splice(d,1),b.set("columns",c))}},initContextMenu:function(b){var c=this,d=new a.ContextMenuView({container:a.Node.create('<div id="cmenuView" class="cmenu" tabindex="1"></div>'),app:this.get("app"),menuItemTemplate:'<div class="yui3-contextmenu-menuitem" data-cmenu="{menuIndex}">{menuContent}</div>',menuItems:[{label:"Inspect",value:"i",handler:c.handleInspectService}],trigger:{node:b.get("srcNode").one("table .yui3-datatable-data"),target:"tr"}});d.after("selectedMenuChange",c.selectedContextMenuItem,c),d.after("contextTargetChange",function(a){var b=a.newVal,c=a.prevVal||null;c&&c.removeClass("selectTr"),b&&b.addClass("selectTr")}),d.on("contextMenuHide",function(){var a=this.get("contextTarget");a&&a.removeClass("selectTr")}),c.set("cmenu",d)},selectedContextMenuItem:function(a){var b=this.get("dataTable"),c=this.get("cmenu"),d=c.get("contextTarget"),e=d.getAttribute("data-yui3-record"),f=b.getRecord(e),g=+a.newVal.menuIndex,h=a.newVal.menuItem;h.handler&&setTimeout(function(){h.handler.call(this,f)},0)},handleInspectService:function(a){},setupToolbar:function(){var a=this.get("toolbar");this.setupFilters(a)},setupDisplayMax:function(a){var b=createLABEL(a,"Display max of "),c=this.get("maxRows"),d=createSELECT(a,"monitorMaxRowsSelect").set("id","servicesMaxRowsSelect");d.on("change",this.onMaxRowsChange,this);var e=createOPTION(d,null,"10","10");e=createOPTION(d,null,"50","50"),e=createOPTION(d,null,"100","100"),e=createOPTION(d,null,"500","500"),d.get("options").each(function(){var a=this.get("value");a==c&&this.set("selected","selected")}),b=createLABEL(a," rows")},setupFilters:function(a){var b=createLABEL(a,"Filter: ","filterSelector"),c=createSELECT(b,"toolbarSelect");c.on("change",this.onFilterSelectChange,this);var d=createOPTION(c,null,"Choose...","choose");d=createOPTION(c,null,"Clear all conditions","clear"),d=createOPTION(c,null,"Running Service Instances","running"),d=createOPTION(c,null,"Stopped Service Instances","stopped"),d=createOPTION(c,null,"Edit...","edit"),this.displayFilter()},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.render()},onGatewayAvailable:function(a){this.adjustForClusterColumn();var b=a.gatewayModel,c=b.getServices();if(c&&c.length>0)for(var d=this.get("filter"),e=0;e<c.length;e++){var f=c[e];(!d||d.match(f))&&this.get("dataTable").addRow(f,null)}},onAddService:function(a){var b=a.serviceModel,c=this.get("filter");(!c||c.match(b))&&this.get("dataTable").addRow(b,null)},onUpdateService:function(a){var b=a.model,c=b.get("serviceModel"),d=this.get("filter"),e=this.get("dataTable"),f=!d||d.match(c),g=e.data.indexOf(c);if(f)if(g>=0){for(var h={},i=["totalCurrentSessions","totalCurrentNativeSessions","totalCurrentEmulatedSessions","totalCumulativeSessions","totalCumulativeNativeSessions","totalCumulativeEmulatedSessions","totalBytesReceived","totalBytesSent"],j=0;j<i.length;j++){var k=i[j];h[k]=c.get(k)}e.modifyRow(g,h)}else e.addRow(c,null);else g>=0&&e.removeRow(c)},onRemoveService:function(a){var b=a.serviceModel,c=this.get("dataTable");c.data.indexOf(b)>=0&&c.removeRow(b,null)},afterStopTimeChange:function(a){this.adjustForClusterColumn();var b=a.target,c=this.get("filter"),d=this.get("dataTable"),e=!c||c.match(b),f=d.data.indexOf(b);e?f>=0?d.modifyRow(f,{stopTime:a.newVal}):d.addRow(b,null):f>=0&&d.removeRow(b)},afterFilterChange:function(){this.displayFilter(),this.doSearch()},onMaxRowsChange:function(a){var b=parseInt(a.target.get("value"),10);this.set("maxRows",b);var c=this.get("dataTable");c.data.size()>b},onFilterSelectChange:function(a){var b=a.target.get("value");switch(b){case"choose":break;case"edit":this.doFilterDisplay(),a.target.set("selectedIndex",0);break;case"clear":var c=new AndFilter;this.set("filter",c),a.target.set("selectedIndex",0);break;case"running":var c=new AndFilter;c.addFilter(new NumericFilter("stopTime","UNSET","")),this.set("filter",c);break;case"stopped":var c=new AndFilter;c.addFilter(new NumericFilter("stopTime","SET","")),this.set("filter",c)}},render:function(){return this},doFilterDisplay:function(){var a=this,b=this.get("filterFieldDefinitions");b||(b=this.buildFilterFieldDefinitions()),this.get("filterPanel").display(this.get("model"),this.get("filter"),b,function(b){a.set("filter",b)})},displayFilter:function(){var b=this.get("filter"),c=a.one("#monitorServicesCurrentFilter"),d=b?b.toString():"none";""===d&&(d="none"),c.setHTML('<span>Current Filter: </span><span class="filterValue">'+d+"</span>")},clearFilters:function(){var a=new AndFilter;this.set("filter",a)},doSearch:function(){var a=this.get("dataTable");a.data.size()>0&&a.data.reset({silent:!0});var b=this.get("model"),c=b.getGateways();if(c){var d=this.get("filter"),e=d&&d.getSubFilters();e&&0==e.length&&(e=null);a:for(var f=0;f<c.length;f++){var g=c[f];if(e)for(var h=0;h<e.length;h++){var i=e[h];if(this.isGatewayFilter(i)&&!i.match(g))continue a}var j=g.getServices();if(j)b:for(var k=0;k<j.length;k++){var l=j[k];if(e)for(var h=0;h<e.length;h++){var i=e[h];if(!this.isGatewayFilter(i)&&!i.match(l))continue b}a.addRow(l,null)}}}},isGatewayFilter:function(a){return"gatewayLabel"===a.attribute}},{ATTRS:{container:{valueFn:function(){return a.one("#monitorServicesViewContainer")}},selectionCriterion:{value:null},title:{value:"Monitoring : Services"},maxRows:{value:100},dataTable:{value:null},filterFieldDefinitions:{value:null},filter:{value:null},cmenu:{value:null},filterPanel:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","cluster-model","gateway-model","service-model","monitor-filter-panel"]}),YUI.add("monitor-sessions-view",function(a){"use strict";var b=a.Lang,c="monitorSessionsView",d=1;a.MonitorSessionsView=a.Base.create(c,a.KaazingView,[],{initializer:function(){var a=this.get("model");a&&a.addTarget(this),this.after("modelChange",this.afterModelChange,this),this.after("*:loggedInChange",this.afterLoggedInChange,this)},afterLoggedInChange:function(a){return this.isActiveView()?this.doDisplaySetup():null},showViewCallback:function(){return this.hasLoggedIn()?this.doDisplaySetup():null},doDisplaySetup:function(){var b=this;if(this.get("firstTime")){this.on(a.GatewayModel.prototype.GATEWAY_AVAILABLE_EVENT,this.onGatewayAvailable,this),this.on(a.GatewayModel.prototype.GATEWAY_UNAVAILABLE_EVENT,this.onGatewayUnavailable,this),this.on(a.ServiceModel.prototype.ADD_SESSION_EVENT,this.onAddSession,this),this.on(a.ServiceModel.prototype.REMOVE_SESSION_EVENT,this.onRemoveSession,this),this.on(a.SessionDynamicDataModel.prototype.UPDATE_EVENT,this.onUpdateSession,this),this.on(a.SessionModel.prototype.CLOSE_SESSION_EVENT,this.onCloseSession,this);var c=new AndFilter;c.addFilter(new NumericFilter("stopTime","UNSET","")),this.set("filter",c),this.after("filterChange",this.afterFilterChange,this);var d=new a.ModelList({model:a.SessionModel}),e=[{key:"action",label:"&nbsp;",sortable:!1,allowHTML:!0,width:20,className:"monitorSessionsAction"},{key:"serviceLabel",label:"Service<br>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:100,className:"monitorSessionsService"},{label:"Meta-data",children:[{key:"sessionId",label:"Id<br>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:50,className:"monitorSessionsSessionId"},{key:"startTime",label:"Start Time<BR>&nbsp;",sortable:!0,allowHTML:!0,emptyCellValue:"",width:70,formatter:function(a){return formatTableTime(a,"startTime")},sortFn:function(a,b,c){return compareNumbers(a.get("startTime"),b.get("startTime"),c,0)},className:"monitorSessionsStartTime"},{key:"stopTime",label:"Stop Time<BR>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:50,formatter:function(a){return formatTableTime(a,"stopTime")},sortFn:function(a,b,c){return compareNumbers(a.get("stopTime"),b.get("stopTime"),c,0)},className:"monitorSessionsCloseTime"},{key:"sessionTypeName",label:"Type<BR>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record,c=b.get("sessionTypeName"),d=CC.Constants.PROTOCOL_DISPLAY_INFO[c];return d=d?d.label:c},className:"monitorSessionsSessionType"},{key:"sessionDirection",label:"Direction<BR>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return b.get("sessionDirection")},className:"monitorSessionsSessionDirection"}]},{label:"Performance (bytes)",children:[{key:"readBytes",label:"Read<br>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memorySizeString(b.get("readBytes"))},sortFn:function(a,b,c){return compareNumbers(a.get("readBytes"),b.get("readBytes"),c,0)},className:"monitorSessionsBytesRead"},{key:"readBytesThroughput",label:"Read Thpt<br>(bytes/sec)",sortable:!0,allowHTML:!1,emptyCellValue:"",width:100,formatter:function(a){var b=a.record;return formatFloat(b.get("readBytesThroughput"),3)},sortFn:function(a,b,c){return compareNumbers(a.get("readBytesThroughput"),b.get("readBytesThroughput"),c,0)},className:"monitorSessionsBytesReadThpt"},{key:"writtenBytes",label:"Written<br>&nbsp;",sortable:!0,allowHTML:!1,emptyCellValue:"",width:80,formatter:function(a){var b=a.record;return memorySizeString(b.get("writtenBytes"))},sortFn:function(a,b,c){return compareNumbers(a.get("writtenBytes"),b.get("writtenBytes"),c,0)},className:"monitorSessionsBytesWritten"},{key:"writtenBytesThroughput",label:"Written Thpt<br>(bytes/sec)",sortable:!0,allowHTML:!1,emptyCellValue:"",width:100,formatter:function(a){var b=a.record;return formatFloat(b.get("writtenBytesThroughput"),3)},sortFn:function(a,b,c){return compareNumbers(a.get("writtenBytesThroughput"),b.get("writtenBytesThroughput"),c,0)},className:"monitorSessionsBytesWrittenThpt"}]},{key:"principals",label:"Principals<BR>&nbsp;",sortable:!0,allowHTML:!0,emptyCellValue:"",width:80,formatter:function(a){var b=a.record,c=b.get("principals");if(isEmptyObject(c))return"";var d="";for(var e in c)if(c.hasOwnProperty(e)){""!==d&&(d+="<BR>");var f=c[e];f.startsWith("com.kaazing.gateway.server.auth.config.parse")?(f=f.substring(f.lastIndexOf(".")+1),f.startsWith("Default")&&(f=f.substring(7)),f.endsWith("Config")&&(f=f.substring(0,f.length-6))):f=f.substring(f.lastIndexOf(".")+1),d+="<b>"+f+"</b>:&nbsp;&nbsp;"+e}return d},className:"monitorSessionsPrincipalsType"}],f=new a.DataTable({columns:e,data:d,recordType:a.SessionModel,editable:!1,highlightMode:"row",selectionMode:"row",selectionMulti:!1});f.set("strings.emptyMessage","No sessions meet your selected criteria"),a.delegate("click",this.handleActionButton,"#monitorSessionsResults","button.goButton",this),this.set("dataTable",f),this.adjustForClusterColumn(),this.doSearch(),f.render("#monitorSessionsResults"),f.set("height",this.desiredDataTableHeight()),a.one("win").on("resize",function(){if(b.isActiveView()){var a=b.desiredDataTableHeight();f.set("height",a)}}),this.set("firstTime",!1)}this.setupToolbar()},buildFilterFieldDefinitions:function(){var a=this,b=[["readBytes","Bytes Read","numeric"],["readBytesThroughput","Bytes Read Throughput","numeric"],["writtenBytes","Bytes Written","numeric"],["writtenBytesThroughput","Bytes Written Throughput","numeric"],["sessionTypeName","Session Type","alpha"],["sessionDirection","Session Direction","alpha"],["principals","Principals","alpha"],["localAddress","Local Address","alpha"],["serviceLabel","Service","alpha"],["sessionId","Session Id","numeric"],["startTime","Start Time","numeric"],["stopTime","Stop Time","numeric"]];return this.isCluster()&&b.push(["gatewayLabel","Cluster Member","alpha"]),b.sort(function(a,b){var c=a[1],d=b[1];return d>c?-1:c===d?0:1}),this.set("filterFieldDefinitions",b),b},desiredDataTableHeight:function(){var a=this.get("container").get("clientHeight");return a-95},handleActionButton:function(b){var c=this,d=a.one("#monitorSessionsMenu");if(!d){var e=a.one("html");d=createDIV(e,"popupMenu").set("id","monitorSessionsMenu"),d.on("mousedownoutside",function(){this.hide()}),d.delegate("click",this.handleSessionOperation,"a",this,d);var f=createUL(d),g=createLI(f),h=createLINK(g,"#").set("text","Close Session").setAttribute("command","close")}d.setStyle("left",b.clientX+10).setStyle("top",b.clientY),d.setAttribute("instanceKey",b.target.getAttribute("instanceKey")),d.setAttribute("serviceId",b.target.getAttribute("serviceId")),d.setAttribute("sessionId",b.target.getAttribute("sessionId")),d.show()},handleSessionOperation:function(b,c){if(b.stopPropagation(),a.one("#monitorSessionsMenu").hide(),confirm("Are you sure you want to close the selected session?")){var d=c.getAttribute("instanceKey"),e=parseInt(c.getAttribute("serviceId")),f=parseInt(c.getAttribute("sessionId")),g=b.target.getAttribute("command"),h=this.get("model"),i=h.findGatewayModelByInstanceKey(d);return i?void("close"===g?i.get("mngtApi").closeSession(e,f):alert("unknown command '"+g+"' selected")):void alert("Could not find the selected gateway!")}},adjustForClusterColumn:function(){var a=this.get("model"),b=this.get("dataTable");if(b){var c=b.get("columns");this.isCluster()?"gatewayLabel"!==c[d].key&&(c.splice(d,0,{key:"gatewayLabel",label:"Cluster<br>Member",sortable:!0,allowHTML:!0,emptyCellValue:"",width:100,formatter:function(a){var b=a.record;return b.get("gatewayLabel")
},className:"monitorSessionsGateway"}),b.set("columns",c)):"gatewayLabel"===c[d].key&&(c.splice(d,1),b.set("columns",c))}},handleCloseSession:function(a){confirm("Are you sure you want to close session ID "+a.get("sessionId")+"?")&&a.startClose()},handleInspectSession:function(a){},setupToolbar:function(){var a=this.get("toolbar");this.setupFilters(a)},setupDisplayMax:function(a){var b=createLABEL(a,"Display max of "),c=this.get("maxRows"),d=createSELECT(a,"monitorMaxRowsSelect").set("id","sessionsMaxRowsSelect");d.on("change",this.onMaxRowsChange,this);var e=createOPTION(d,null,"10","10");e=createOPTION(d,null,"50","50"),e=createOPTION(d,null,"100","100"),e=createOPTION(d,null,"500","500"),d.get("options").each(function(){var a=this.get("value");a==c&&this.set("selected","selected")}),b=createLABEL(a," rows")},setupFilters:function(a){var b=createLABEL(a,"Filter: ","filterSelector"),c=createSELECT(b,"toolbarSelect");c.on("change",this.onFilterSelectChange,this);var d=createOPTION(c,null,"Choose...","choose");d=createOPTION(c,null,"Clear all conditions","clear"),d=createOPTION(c,null,"Open Sessions","open"),d=createOPTION(c,null,"Closed Sessions","closed"),d=createOPTION(c,null,"Edit...","edit"),this.displayFilter()},afterModelChange:function(a){a.prevVal&&a.prevVal.removeTarget(this),a.newVal&&a.newVal.addTarget(this),this.render()},onGatewayAvailable:function(a){this.adjustForClusterColumn();var b=a.gatewayModel,c=b.getServices();if(c&&c.length>0)for(var d=this.get("filter"),e=0;e<c.length;e++){var f=c[e],g=f.getSessions();if(g&&g.length>0)for(var h=0;h<g.length;h++){var i=g[h];(!d||d.match(i))&&this.addRow(i,null)}}},onGatewayUnavailable:function(a){this.adjustForClusterColumn()},onAddSession:function(a){var b=a.sessionModel,c=this.get("filter");(!c||c.match(b))&&this.addRow(b,null)},onUpdateSession:function(a){var b=a.model,c=b.get("sessionModel"),d=this.get("filter"),e=this.get("dataTable"),f=!d||d.match(c),g=e.data.indexOf(c);if(f)if(g>=0){for(var h={},i=["readBytes","readBytesThroughput","writtenBytes","writtenBytesThroughput"],j=0;j<i.length;j++){var k=i[j];h[k]=c.get(k)}this.modifyRow(g,h)}else this.addRow(c,null);else g>=0&&this.removeRow(c)},onCloseSession:function(a){var b=a.sessionModel,c=this.get("filter"),d=this.get("dataTable"),e=!c||c.match(b),f=d.data.indexOf(b);e?f>=0?this.modifyRow(f,{state:b.get("state")}):this.addRow(b,null):f>=0&&this.removeRow(b)},onRemoveSession:function(a){var b=a.sessionModel,c=this.get("dataTable");c.data.indexOf(b)>=0&&this.removeRow(b,null)},afterFilterChange:function(){this.displayFilter(),this.doSearch()},onMaxRowsChange:function(a){var b=parseInt(a.target.get("value"),10);this.set("maxRows",b);var c=this.get("dataTable");c.data.size()>b},onFilterSelectChange:function(a){var b=a.target.get("value");switch(b){case"choose":break;case"edit":this.doFilterDisplay(),a.target.set("selectedIndex",0);break;case"clear":var c=new AndFilter;this.set("filter",c),a.target.set("selectedIndex",0);break;case"open":var c=new AndFilter;c.addFilter(new NumericFilter("stopTime","UNSET","")),this.set("filter",c);break;case"closed":var c=new AndFilter;c.addFilter(new NumericFilter("stopTime","SET","")),this.set("filter",c)}},render:function(){return this},doFilterDisplay:function(){var a=this,b=this.get("fieldFieldDefinitions");b||(b=this.buildFilterFieldDefinitions()),this.get("filterPanel").display(this.get("model"),this.get("filter"),b,function(b){a.set("filter",b)})},displayFilter:function(){var b=this.get("filter"),c=a.one("#monitorSessionsCurrentFilter"),d=b?b.toString():"none";""===d&&(d="none"),c.setHTML('<span>Current Filter: </span><span class="filterValue">'+d+"</span>")},clearFilters:function(){var a=new AndFilter;this.set("filter",a)},doSearch:function(){var a=this.get("dataTable");a.data.size()>0&&a.data.reset({silent:!0});var b=this.get("model"),c=b.getGateways();if(c){var d=this.get("filter"),e=d&&d.getSubFilters();e&&0==e.length&&(e=null);a:for(var f=0;f<c.length;f++){var g=c[f];if(e)for(var h=0;h<e.length;h++){var i=e[h];if(this.isGatewayFilter(i)&&!i.match(g))continue a}var j=g.getServices();if(j)b:for(var k=0;k<j.length;k++){var l=j[k];if(e)for(var h=0;h<e.length;h++){var i=e[h];if(this.isServiceFilter(i)&&!i.match(l))continue b}var m=l.getSessions();if(m)c:for(var n=0;n<m.length;n++){var o=m[n];if(e)for(var h=0;h<e.length;h++){var i=e[h];if(!this.isGatewayFilter(i)&&!this.isServiceFilter(i)&&!i.match(o))continue c}this.addRow(o,null)}}}}},addRow:function(a,b){this.get("dataTable").addRow(a,b);var c=0},modifyRow:function(a,b){this.get("dataTable").modifyRow(a,b)},removeRow:function(a){this.get("dataTable").removeRow(a)},isGatewayFilter:function(a){return"gatewayLabel"===a.attribute},isServiceFilter:function(a){return"serviceLabel"===a.attribute}},{ATTRS:{container:{valueFn:function(){return a.one("#monitorSessionsViewContainer")}},selectionCriterion:{value:null},title:{value:"Monitoring : Sessions"},maxRows:{value:100},dataTable:{value:null},filterFieldDefinitions:{value:null},filter:{value:null},filterPanel:{value:null},firstTime:{value:!0}}})},"0.99",{requires:["kaazing-view","cluster-model","gateway-model","service-model","session-model","monitor-filter-panel"]});